<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Rotobo Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Zhubingbing" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Zhubingbing">
<meta property="og:url" content="http://yoursite.com/child/page/2/index.html">
<meta property="og:site_name" content="Zhubingbing">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zhubingbing">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/child/page/2/"/>





  <title>Zhubingbing</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zhubingbing</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/09/21/openstack/magnum/magnum-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/21/openstack/magnum/magnum-02/" itemprop="url">magnum调研02</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-21T19:30:00+08:00">
                2017-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openstack/" itemprop="url" rel="index">
                    <span itemprop="name">openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/09/21/openstack/magnum/magnum-02/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/09/21/openstack/magnum/magnum-02/" class="cy_cmt_count" data-xid="2017/09/21/openstack/magnum/magnum-02/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>通过之前初步调研，magnum确实能把k8s启动起来。但是k8s一些组件都需要自己手动安装，这点很不好。<br>然后我查看代码，发现最新的ocata代码已经支持heat 部署k8s的dns、dashboard等。monitor在pike版本代码也已经支持。</p>
<img title="magnum01" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/magnum/magnum01.png">
<p>看到这里有点小激动啊，那说明我用magnum一键能部署一个带高级功能的k8s平台。</p>
<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>这些内容在 magnum-调研01可以查看</p>
<p>1、 准备registry，因为要离线安装（主要gcr.io被墙了），所有搭建自己的registry</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">## 启动私有的registry</div><div class="line">docker run -d -p 4000:5000 -v /opt/registry:/var/lib/registry --restart=always --name registry registry:2</div><div class="line"></div><div class="line">## 所需镜像</div><div class="line">google_containers/kube-ui:v4</div><div class="line">google_containers/pause-amd64:3.0</div><div class="line">google_containers/hyperkube:v1.5.3</div><div class="line">google_containers/pause:0.8.0</div><div class="line">google_containers/kubedns-amd64:1.9</div><div class="line">google_containers/dnsmasq-metrics-amd64:1.0</div><div class="line">google_containers/kube-dnsmasq-amd64:1.4</div><div class="line">google_containers/exechealthz-amd64:1.2</div><div class="line">google_containers/defaultbackend:1.0</div><div class="line">google_containers/nginx-ingress-controller:0.9.0-beta.11</div><div class="line"></div><div class="line">## 上传镜像（可以简单写个shell脚本自动去做）</div><div class="line">registry_url=192.168.21.10:5000</div><div class="line">docker tag gcr.io/google_containers/kube-ui:v4 $registry_url/google_containers/kube-ui:v4</div><div class="line">docker push $registry_url/google_containers/kube-ui:v4</div></pre></td></tr></table></figure>
<p>2、fedora镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">## 下载fedora镜像</div><div class="line"></div><div class="line">wget https://fedorapeople.org/groups/magnum/fedora-atomic-latest.qcow2</div><div class="line"></div><div class="line">## 上传镜像</div><div class="line"></div><div class="line">openstack image create \</div><div class="line">                      --disk-format=qcow2 \</div><div class="line">                      --container-format=bare \</div><div class="line">                      --file=fedora-atomic-latest.qcow2 \</div><div class="line">                      --property os_distro=&apos;fedora-atomic&apos; \</div><div class="line">                      fedora-atomic-latest</div></pre></td></tr></table></figure>
<h3 id="使用kolla部署magnum"><a href="#使用kolla部署magnum" class="headerlink" title="使用kolla部署magnum"></a>使用kolla部署magnum</h3><p>注: 这里不详细介绍如何使用kolla部署magnum了,kolla-ansible使用可以参考官网文档（<a href="https://github.com/openstack/kolla-ansible）" target="_blank" rel="external">https://github.com/openstack/kolla-ansible）</a></p>
<p>在/etc/kolla/globals.yml 打开magnum、neutron-lbass(因为要使用lb功能)，存储使用ceph,基础组件都打开<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@master ~]# cat /etc/kolla/globals.yml</div><div class="line">enable_horizon_magnum: &quot;&#123;&#123; enable_magnum | bool &#125;&#125;&quot;</div><div class="line">enable_magnum: &quot;yes&quot;</div><div class="line">enable_neutron_lbaas: &quot;yes&quot;</div><div class="line">[root@master ~]# kolla-ansible deploy</div></pre></td></tr></table></figure></p>
<h3 id="创建magnum-k8s-template"><a href="#创建magnum-k8s-template" class="headerlink" title="创建magnum k8s template"></a>创建magnum k8s template</h3><p>参数根据自己的实际情况进行调整<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"> magnum cluster-template-create kubernetes-cluster-template-1 \</div><div class="line">                     --image fedora-atomic-latest \</div><div class="line">                     --keypair mykey \</div><div class="line">                     --external-network public1 \</div><div class="line">                     --dns-nameserver 8.8.8.8 \</div><div class="line">                     --master-flavor 4C.4G \</div><div class="line">                     --flavor 4C.4G \</div><div class="line">                     --labels kube_dashboard_enabled=True,flannel_backend=host-gw \</div><div class="line">                     --coe kubernetes \</div><div class="line">                     --docker-volume-size 40 \</div><div class="line">                     --floating-ip-enabled \</div><div class="line">                     --volume-driver cinder \</div><div class="line">                     --insecure-registry 172.16.130.151:4000</div><div class="line"></div><div class="line">## 参数说明</div><div class="line">这里的参数需要注意的就是 --labels这个参数，因为文档里面没有详细介绍，像</div><div class="line">kube_dashboard_enabled，后面的监控啊，调整flannel的参数等等都需要使用这个参数</div><div class="line"></div><div class="line">## 相关代码</div><div class="line">代码路径 magnum/magnum/drivers/heat/k8s_template_def.py</div><div class="line">![](leanote://file/getImage?fileId=59c2490959398d3414000004)</div><div class="line"></div><div class="line">## 创建成功如下显示</div><div class="line">[root@master ~]# magnum cluster-template-show kubernetes-cluster-template-1</div><div class="line">+-----------------------+------------------------------------------------------------------+</div><div class="line">| Property              | Value                                                            |</div><div class="line">+-----------------------+------------------------------------------------------------------+</div><div class="line">| insecure_registry     | 172.16.130.151:4000                                              |</div><div class="line">| labels                | &#123;&apos;flannel_backend&apos;: &apos;host-gw&apos;, &apos;kube_dashboard_enabled&apos;: &apos;True&apos;&#125; |</div><div class="line">| updated_at            | -                                                                |</div><div class="line">| floating_ip_enabled   | True                                                             |</div><div class="line">| fixed_subnet          | -                                                                |</div><div class="line">| master_flavor_id      | 4C.4G                                                            |</div><div class="line">| uuid                  | 669e5b3a-2cdf-42c1-9b8c-656b0f3bba6a                             |</div><div class="line">| no_proxy              | -                                                                |</div><div class="line">| https_proxy           | -                                                                |</div><div class="line">| tls_disabled          | False                                                            |</div><div class="line">| keypair_id            | mykey                                                            |</div><div class="line">| public                | False                                                            |</div><div class="line">| http_proxy            | -                                                                |</div><div class="line">| docker_volume_size    | 40                                                               |</div><div class="line">| server_type           | vm                                                               |</div><div class="line">| external_network_id   | public1                                                          |</div><div class="line">| cluster_distro        | fedora-atomic                                                    |</div><div class="line">| image_id              | fedora-atomic-latest                                             |</div><div class="line">| volume_driver         | cinder                                                           |</div><div class="line">| registry_enabled      | False                                                            |</div><div class="line">| docker_storage_driver | devicemapper                                                     |</div><div class="line">| apiserver_port        | -                                                                |</div><div class="line">| name                  | kubernetes-cluster-template-1                                    |</div><div class="line">| created_at            | 2017-09-20T03:09:26+00:00                                        |</div><div class="line">| network_driver        | flannel                                                          |</div><div class="line">| fixed_network         | -                                                                |</div><div class="line">| coe                   | kubernetes                                                       |</div><div class="line">| flavor_id             | 4C.4G                                                            |</div><div class="line">| master_lb_enabled     | False                                                            |</div><div class="line">| dns_nameserver        | 8.8.8.8                                                          |</div><div class="line">+-----------------------+------------------------------------------------------------------+</div></pre></td></tr></table></figure></p>
<h3 id="创建k8s-集群"><a href="#创建k8s-集群" class="headerlink" title="创建k8s 集群"></a>创建k8s 集群</h3><p>创建1个master节点和2个node节点的k8s集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">magnum cluster-create --node-count 2 --master-count 1 --cluster-template k8s-cluster-template</div><div class="line"></div><div class="line">## 创建成功如下</div><div class="line">[root@master ~]# magnum cluster-show test-3</div><div class="line">+---------------------+------------------------------------------------------------+</div><div class="line">| Property            | Value                                                      |</div><div class="line">+---------------------+------------------------------------------------------------+</div><div class="line">| status              | CREATE_COMPLETE                                            |</div><div class="line">| cluster_template_id | 4886c5b3-2f0f-4b1a-94a4-7f7c4f6eb0d9                       |</div><div class="line">| node_addresses      | [&apos;172.16.150.164&apos;, &apos;172.16.150.169&apos;]                       |</div><div class="line">| uuid                | 65c95601-8871-48de-8ebc-e2efe848111c                       |</div><div class="line">| stack_id            | 2ba19cad-8ed9-47ab-8340-a4f26b57e333                       |</div><div class="line">| status_reason       | Stack CREATE completed successfully                        |</div><div class="line">| created_at          | 2017-09-20T07:20:29+00:00                                  |</div><div class="line">| updated_at          | 2017-09-20T07:24:03+00:00                                  |</div><div class="line">| coe_version         | v1.5.3                                                     |</div><div class="line">| keypair             | mykey                                                      |</div><div class="line">| api_address         | https://172.16.150.154:6443                                |</div><div class="line">| master_addresses    | [&apos;172.16.150.154&apos;]                                         |</div><div class="line">| create_timeout      | 60                                                         |</div><div class="line">| node_count          | 2                                                          |</div><div class="line">| discovery_url       | https://discovery.etcd.io/d88395d69fa826a349ad7c7323977cec |</div><div class="line">| master_count        | 1                                                          |</div><div class="line">| container_version   | 1.12.6                                                     |</div><div class="line">| name                | test-3                                                     |</div><div class="line">+---------------------+------------------------------------------------------------+</div></pre></td></tr></table></figure>
<h3 id="访问k8s集群"><a href="#访问k8s集群" class="headerlink" title="访问k8s集群"></a>访问k8s集群</h3><p>访问k8s集群有2种方式<br>1、 登入k8s master节点能够直接使用k8s命令<br>2、 远程访问可以使用 magnum cluster-config 生成所需的ca文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">## 直接登陆master节点访问</div><div class="line"></div><div class="line">[root@master ~]# nova list</div><div class="line">/usr/lib/python2.7/site-packages/novaclient/client.py:278: UserWarning: The &apos;tenant_id&apos; argument is deprecated in Ocata and its use may result in errors in future releases. As &apos;project_id&apos; is provided, the &apos;tenant_id&apos; argument will be ignored.</div><div class="line">  warnings.warn(msg)</div><div class="line">+--------------------------------------+-------------------------------------------------------+--------+------------+-------------+-----------------------------------+</div><div class="line">| ID                                   | Name                                                  | Status | Task State | Power State | Networks                          |</div><div class="line">+--------------------------------------+-------------------------------------------------------+--------+------------+-------------+-----------------------------------+</div><div class="line">| dd8d6bf1-882c-4132-b90e-fbf251a04351 | te-ipopai2hb7-0-edce6decnmfd-kube-minion-guvv4egh2oeo | ACTIVE | -          | Running     | private=10.0.0.9, 172.16.150.164  |</div><div class="line">| 215e1f59-8270-488b-b02a-1f83f0ad8fae | te-ipopai2hb7-1-5z3wzug3hsjg-kube-minion-ktzk5ugdsclg | ACTIVE | -          | Running     | private=10.0.0.12, 172.16.150.169 |</div><div class="line">| e45e4f94-d9d3-4b6b-8632-9437d7fa7101 | te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f | ACTIVE | -          | Running     | private=10.0.0.7, 172.16.150.154  |</div><div class="line">| a435bda3-dbfb-4df1-b426-42f4142f1b4d | te-tcrckexviy-0-66y6o7a76osg-kube-master-yozurhnfidfw | ACTIVE | -          | Running     | private=10.0.0.12, 172.16.150.158 |</div><div class="line">+--------------------------------------+-------------------------------------------------------+--------+------------+-------------+-----------------------------------+</div><div class="line">[root@master ~]# ssh fedora@172.16.150.154</div><div class="line">Warning: Permanently added &apos;172.16.150.154&apos; (ECDSA) to the list of known hosts.</div><div class="line">Last login: Wed Sep 20 09:34:09 2017 from 172.16.150.163</div><div class="line">[fedora@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f ~]$</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f fedora]# kubectl get node</div><div class="line">NAME                                                    STATUS                     AGE</div><div class="line">te-ipopai2hb7-0-edce6decnmfd-kube-minion-guvv4egh2oeo   Ready                      3h</div><div class="line">te-ipopai2hb7-1-5z3wzug3hsjg-kube-minion-ktzk5ugdsclg   Ready                      3h</div><div class="line">te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f   Ready,SchedulingDisabled   3h</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f fedora]# kubectl get pods --all-namespaces</div><div class="line">NAMESPACE     NAME                                                                            READY     STATUS    RESTARTS   AGE</div><div class="line">default       nginx                                                                           1/1       Running   0          1h</div><div class="line">kube-system   coredns-2417336708-gv1df                                                        1/1       Running   0          3h</div><div class="line">kube-system   kube-controller-manager-te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f   1/1       Running   0          3h</div><div class="line">kube-system   kube-proxy-te-ipopai2hb7-0-edce6decnmfd-kube-minion-guvv4egh2oeo                1/1       Running   0          3h</div><div class="line">kube-system   kube-proxy-te-ipopai2hb7-1-5z3wzug3hsjg-kube-minion-ktzk5ugdsclg                1/1       Running   0          3h</div><div class="line">kube-system   kube-proxy-te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f                1/1       Running   0          3h</div><div class="line">kube-system   kube-scheduler-te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f            1/1       Running   0          3h</div><div class="line">kube-system   kubernetes-dashboard-953129222-2m1fl                                            1/1       Running   0          3h</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f fedora]#</div><div class="line"></div><div class="line">## 使用magnum cluster-config</div><div class="line">[root@master ~]# mkdir -p ~/clusters/kubernetes-cluster</div><div class="line">[root@master ~]# $(magnum cluster-config test-3 --dir ~/clusters/kubernetes-cluster)</div><div class="line">export KUBECONFIG=/home/user/clusters/kubernetes-cluster/config</div><div class="line">[root@master ~]# kubectl -n kube-system get pod --all-namespaces</div><div class="line">NAMESPACE     NAME                                                                            READY     STATUS    RESTARTS   AGE</div><div class="line">default       nginx                                                                           1/1       Running   0          1h</div><div class="line">kube-system   coredns-2417336708-gv1df                                                        1/1       Running   0          3h</div><div class="line">kube-system   kube-controller-manager-te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f   1/1       Running   0          3h</div><div class="line">kube-system   kube-proxy-te-ipopai2hb7-0-edce6decnmfd-kube-minion-guvv4egh2oeo                1/1       Running   0          3h</div><div class="line">kube-system   kube-proxy-te-ipopai2hb7-1-5z3wzug3hsjg-kube-minion-ktzk5ugdsclg                1/1       Running   0          3h</div><div class="line">kube-system   kube-proxy-te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f                1/1       Running   0          3h</div><div class="line">kube-system   kube-scheduler-te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f            1/1       Running   0          3h</div><div class="line">kube-system   kubernetes-dashboard-953129222-2m1fl                                            1/1       Running   0          3h</div></pre></td></tr></table></figure></p>
<h3 id="验证k8s功能"><a href="#验证k8s功能" class="headerlink" title="验证k8s功能"></a>验证k8s功能</h3><h4 id="dashboard"><a href="#dashboard" class="headerlink" title="dashboard"></a>dashboard</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">## 查看dashboard svc</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f fedora]# kubectl get svc -n kube-system</div><div class="line">NAME                   CLUSTER-IP    EXTERNAL-IP   PORT(S)         AGE</div><div class="line">kube-dns               10.254.0.10   &lt;none&gt;        53/UDP,53/TCP   3h</div><div class="line">kubernetes-dashboard   10.254.14.9   &lt;nodes&gt;       80:30029/TCP    3h</div><div class="line"></div><div class="line">## 查看dashboard svc的定义</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f fedora]# kubectl get svc kubernetes-dashboard -n kube-system -o yaml</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  creationTimestamp: 2017-09-20T07:22:11Z</div><div class="line">  labels:</div><div class="line">    app: kubernetes-dashboard</div><div class="line">  name: kubernetes-dashboard</div><div class="line">  namespace: kube-system</div><div class="line">  resourceVersion: &quot;40&quot;</div><div class="line">  selfLink: /api/v1/namespaces/kube-system/services/kubernetes-dashboard</div><div class="line">  uid: 6af71858-9dd4-11e7-b8fc-fa163e86cfba</div><div class="line">spec:</div><div class="line">  clusterIP: 10.254.14.9</div><div class="line">  ports:</div><div class="line">  - nodePort: 30029</div><div class="line">    port: 80</div><div class="line">    protocol: TCP</div><div class="line">    targetPort: 9090</div><div class="line">  selector:</div><div class="line">    app: kubernetes-dashboard</div><div class="line">  sessionAffinity: None</div><div class="line">  type: NodePort</div><div class="line">status:</div><div class="line">  loadBalancer: &#123;&#125;</div><div class="line"></div><div class="line">从上面可以看出，dashboard service使用的是nodeport方式，那我们可以使用</div><div class="line">http://node_ip:30029 进行愉快的访问了</div></pre></td></tr></table></figure>
<p>这就是我们k8s 的dashboard了</p>
<img title="k8s-dashboard" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/magnum/k8s-dashboard.png">
<h4 id="dns"><a href="#dns" class="headerlink" title="dns"></a>dns</h4><p>magnum k8s的dns服务默认使用<a href="https://github.com/coredns/deployment/blob/master/kubernetes/coredns.yaml.sed#L12" target="_blank" rel="external">coredns</a><br>具体实现可以参看<a href="https://github.com/coredns/deployment/blob/master/kubernetes/coredns.yaml.sed#L12" target="_blank" rel="external">coredns</a>的官网文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">创建一个buybox pod</div><div class="line">[root@master example]# cat busybox.yaml</div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  name: busybox</div><div class="line">  namespace: default</div><div class="line">spec:</div><div class="line">  containers:</div><div class="line">  - image: 172.16.130.151:4000/busybox</div><div class="line">    command:</div><div class="line">      - sleep</div><div class="line">      - &quot;3600&quot;</div><div class="line">    imagePullPolicy: IfNotPresent</div><div class="line">    name: busybox</div><div class="line">  restartPolicy: Alway</div><div class="line">[root@master example]# kubectl create -f busybox.yaml</div><div class="line"></div><div class="line">## 完美解析, nice</div><div class="line">[root@master example]# kubectl exec busybox nslookup kubernetes</div><div class="line">Server:    10.254.0.10</div><div class="line">Address 1: 10.254.0.10 kube-dns.kube-system.svc.cluster.local</div><div class="line">Name:      kubernetes</div><div class="line">Address 1: 10.254.0.1 kubernetes.default.svc.cluster.local</div></pre></td></tr></table></figure>
<h3 id="k8s使用neutron-lb功能"><a href="#k8s使用neutron-lb功能" class="headerlink" title="k8s使用neutron lb功能"></a>k8s使用neutron lb功能</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">## 启动一个test-nginx-pod</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f examples]# cat test-pod.yaml</div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  name: nginx</div><div class="line">  labels:</div><div class="line">   app: nginx</div><div class="line">spec:</div><div class="line">  containers:</div><div class="line">  - name: nginx</div><div class="line">    image: 172.16.130.151:4000/nginx</div><div class="line">    ports:</div><div class="line">    - containerPort: 80</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f examples]# kubectl create -f test-pod.yaml</div><div class="line">pod &quot;nginx&quot; created</div><div class="line"></div><div class="line">## 启动test-service</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f examples]# cat test-service.yaml</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  name: nginxservice</div><div class="line">  labels:</div><div class="line">    app: nginx</div><div class="line">spec:</div><div class="line">  ports:</div><div class="line">  - port: 80</div><div class="line">    targetPort: 80</div><div class="line">    protocol: TCP</div><div class="line">  selector:</div><div class="line">    app: nginx</div><div class="line">  type: LoadBalancer</div><div class="line"></div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f examples]# kubectl create -f test-service.yaml</div><div class="line">service &quot;nginxservice&quot; created</div><div class="line"></div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f examples]# kubectl get svc</div><div class="line">NAME           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</div><div class="line">kubernetes     10.254.0.1      &lt;none&gt;        443/TCP        4h</div><div class="line">nginxservice   10.254.84.116   10.0.0.15     80:30443/TCP   2m</div><div class="line"></div><div class="line">## 使用EXTERNAL-IP 访问服务</div><div class="line">[root@te-lgs3rgroc5-0-dvcxdlqunz3h-kube-master-sespgox2v33f examples]# curl 10.0.0.15</div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</div><div class="line">&lt;style&gt;</div><div class="line">    body &#123;</div><div class="line">        width: 35em;</div><div class="line">        margin: 0 auto;</div><div class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</div><div class="line">    &#125;</div><div class="line">&lt;/style&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</div><div class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</div><div class="line">working. Further configuration is required.&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;p&gt;For online documentation and support please refer to</div><div class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</div><div class="line">Commercial support is available at</div><div class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html</div></pre></td></tr></table></figure>
<p>这时候我们可以去界面（horizon）上查看下lb创建情况</p>
<img title="horizon-lb" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/magnum/magnum-lb.png">
<p>创建成功我们给他分配一个浮动ip<br><img title="horizon-lb" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/magnum/magnum-lb-2.png"><br>通过浮动ip访问应用<br><img title="nginx-app" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/magnum/magnum-app.png"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/09/21/macos/zsh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/21/macos/zsh/" itemprop="url">zsh no_nomatch *</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-21T12:30:00+08:00">
                2017-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/macos/" itemprop="url" rel="index">
                    <span itemprop="name">macos</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/09/21/macos/zsh/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/09/21/macos/zsh/" class="cy_cmt_count" data-xid="2017/09/21/macos/zsh/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在 zsh 下使用 find 命令查找指定目录下所有头文件时出现问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">## example-01</div><div class="line">find . -name *.h</div><div class="line">no matches found: *.h</div><div class="line"></div><div class="line">## eexample-02</div><div class="line">git rm -rf *</div><div class="line">no matches found: *</div></pre></td></tr></table></figure>
<p>后来查看了一些资料才知道，这是由于zsh导致的。</p>
<p>具体原因：</p>
<p>因为zsh缺省情况下始终自己解释这个 *.h，而不会传递给 find 来解释。</p>
<p>解决办法：</p>
<p>在~/.zshrc中加入:<br>setopt no_nomatch, 然后进行source .zshrc命令</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/08/16/openstack/tempest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/16/openstack/tempest/" itemprop="url">How to use tempest in kolla</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-16T12:30:00+08:00">
                2017-08-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openstack/" itemprop="url" rel="index">
                    <span itemprop="name">openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/08/16/openstack/tempest/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/08/16/openstack/tempest/" class="cy_cmt_count" data-xid="2017/08/16/openstack/tempest/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Tempest-介绍"><a href="#Tempest-介绍" class="headerlink" title="Tempest 介绍"></a>Tempest 介绍</h3><p>在接触tempest之前我们应该有如下疑问。</p>
<p><img src="/images/tempest.png" alt=""></p>
<h4 id="Tempest是什么"><a href="#Tempest是什么" class="headerlink" title="Tempest是什么"></a>Tempest是什么</h4><p>Tempest为OpenStack的功能测试、集成测试项目，它被设计为可在各种不同项目中使用。在OpenStack核心项目中的单元测试代码中经常可以看到它的身影，在一些孵化项目中也会使用Tempest去测试。它可以验证代码的正确性，已经成为OpenStack项目中不可或缺的组成部分.</p>
<h4 id="主要用于什么测试？"><a href="#主要用于什么测试？" class="headerlink" title="主要用于什么测试？"></a>主要用于什么测试？</h4><p>（1）API接口测试</p>
<p>（2）复杂场景测试</p>
<p>（3）单元测试</p>
<h3 id="使用kolla部署tempest"><a href="#使用kolla部署tempest" class="headerlink" title="使用kolla部署tempest"></a>使用kolla部署tempest</h3><ol>
<li><p>在/etc/kolla/globals.yml开启tempest同时设置tempest相应的配置参数（image_id等）</p>
<p><strong>注: 我是使用cirros镜像进行测试，按照实际情况替换相应参数</strong></p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# vim /etc/kolla/globals.yml</div><div class="line">enable_tempest: &quot;yes&quot;</div><div class="line">tempest_image_id: &quot;570cab5e-4609-43cc-8c1e-3f7d7217ed30&quot;</div><div class="line">tempest_flavor_ref_id: &quot;1&quot;</div><div class="line">tempest_public_network_id: &quot;4c5928f2-6ade-498f-a692-98a775a7183a&quot;</div><div class="line">tempest_floating_network_name: &quot;public1&quot;</div></pre></td></tr></table></figure>
<p>参数以如下命令获得</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"># image id</div><div class="line">[root@control01 ~]# openstack image show cirros -c id -f value</div><div class="line">570cab5e-4609-43cc-8c1e-3f7d7217ed30</div><div class="line"></div><div class="line"># flavor_ref_id</div><div class="line">[root@control01 ~]# nova flavor-list</div><div class="line">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</div><div class="line">| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |</div><div class="line">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</div><div class="line">| 1  | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |</div><div class="line">| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |</div><div class="line">| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |</div><div class="line">| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |</div><div class="line">| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True</div><div class="line"></div><div class="line"># public_network_id</div><div class="line">[root@control01 ~]# openstack network show public1 -c id -f value</div><div class="line">4c5928f2-6ade-498f-a692-98a775a7183a</div><div class="line"></div><div class="line"># floating_network_name</div><div class="line">[root@control01 ~]# openstack network list</div><div class="line">+--------------------------------------+----------+--------------------------------------+</div><div class="line">| ID                                   | Name     | Subnets                              |</div><div class="line">+--------------------------------------+----------+--------------------------------------+</div><div class="line">| 0474116d-0fbd-41a3-ab0c-2c2d11545937 | demo-net | 7366e03d-027b-4a44-b270-d0478584f3e8 |</div><div class="line">| 4c5928f2-6ade-498f-a692-98a775a7183a | public1  | 2c47f34c-f55a-4739-a677-2cbfa56b6312 |</div><div class="line">+--------------------------------------+----------+--------------------------------------+</div></pre></td></tr></table></figure>
<ol>
<li>使用kolla-ansible deploy部署tempest</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">root@control01 ~]# kolla-ansible deploy -t tempest</div><div class="line">## 看到tempest容器运行部署就算成功</div><div class="line">root@control01 ~]# docker ps | grep tempest</div><div class="line">95b57e77b006        kolla/centos-source-tempest:5.0.0                     &quot;kolla_start&quot;            46 hours ago        Up 21 hours</div></pre></td></tr></table></figure>
<h3 id="Tempest使用"><a href="#Tempest使用" class="headerlink" title="Tempest使用"></a>Tempest使用</h3><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><h5 id="了解tempest-cmd基本使用"><a href="#了解tempest-cmd基本使用" class="headerlink" title="了解tempest cmd基本使用"></a>了解tempest cmd基本使用</h5><p><a href="https://specs.openstack.org/openstack/qa-specs/specs/tempest/tempest-run-cmd.html" target="_blank" rel="external">官网文档</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# tempest --help</div><div class="line">usage: tempest [--version] [-v | -q] [--log-file LOG_FILE] [-h] [--debug]</div><div class="line"></div><div class="line">Tempest cli application</div><div class="line"></div><div class="line">optional arguments:</div><div class="line">  --version            show program&apos;s version number and exit</div><div class="line">  -v, --verbose        Increase verbosity of output. Can be repeated.</div><div class="line">  -q, --quiet          Suppress output except warnings and errors.</div><div class="line">  --log-file LOG_FILE  Specify a file to log output. Disabled by default.</div><div class="line">  -h, --help           Show help message and exit.</div><div class="line">  --debug              Show tracebacks on errors.</div><div class="line"></div><div class="line">Commands:</div><div class="line">  account-generator  Create accounts.yaml file for concurrent test runs.</div><div class="line">  cleanup        Cleanup after tempest run</div><div class="line">  complete       print bash completion command</div><div class="line">  help           print detailed help for another command</div><div class="line">  init           Setup a local working environment for running tempest</div><div class="line">  list-plugins   List all tempest plugins</div><div class="line">  run            Run tempest</div><div class="line">  verify-config  Verify your current tempest configuration</div><div class="line">  workspace list  Outputs the name and path of all known tempest workspaces</div><div class="line">  workspace move  Changes the path of a given tempest workspace --name to --path</div><div class="line">  workspace register  Registers a new tempest workspace via a given --name and --path</div><div class="line">  workspace remove  Deletes the entry for a given tempest workspace --name</div><div class="line">  workspace rename  Renames a tempest workspace from --old-name to --new-name</div></pre></td></tr></table></figure>
<p>常用的命令有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 为tempest初始化working environment</div><div class="line">tempest init</div><div class="line"></div><div class="line"># 验证配置是否正确</div><div class="line">tempest verify-config</div><div class="line"></div><div class="line"># 执行tempest测试</div><div class="line">tempest run</div></pre></td></tr></table></figure>
<h5 id="配置tempest-conf"><a href="#配置tempest-conf" class="headerlink" title="配置tempest.conf"></a>配置tempest.conf</h5><p>下面是kolla tempest.conf的模版</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">[DEFAULT]</div><div class="line">debug = &#123;&#123; openstack_logging_debug &#125;&#125;</div><div class="line">log_file = tempest.log</div><div class="line">use_stderr = False</div><div class="line">log_dir = /var/log/kolla/tempest/</div><div class="line"></div><div class="line">[auth]</div><div class="line">admin_username = &#123;&#123; openstack_auth.username &#125;&#125;</div><div class="line">admin_password = &#123;&#123; keystone_admin_password &#125;&#125;</div><div class="line">admin_project_name = &#123;&#123; openstack_auth.project_name &#125;&#125;</div><div class="line">admin_domain_name = &#123;&#123; openstack_auth.domain_name &#125;&#125;</div><div class="line"></div><div class="line"></div><div class="line">[dashboard]</div><div class="line">dashboard_url = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;</div><div class="line">login_url = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;/auth/login/</div><div class="line"></div><div class="line">[service_available]</div><div class="line">cinder = &#123;&#123; enable_cinder &#125;&#125;</div><div class="line">neutron = &#123;&#123; enable_neutron &#125;&#125;</div><div class="line">glance = &#123;&#123; enable_glance &#125;&#125;</div><div class="line">swift = &#123;&#123; enable_swift &#125;&#125;</div><div class="line">nova = &#123;&#123; enable_nova &#125;&#125;</div><div class="line">heat = &#123;&#123; enable_heat &#125;&#125;</div><div class="line">horizon = &#123;&#123; enable_horizon &#125;&#125;</div><div class="line">ceilometer = &#123;&#123; enable_ceilometer &#125;&#125;</div><div class="line"></div><div class="line">[compute]</div><div class="line">max_microversion = latest</div><div class="line">image_ref = &#123;&#123; tempest_image_id &#125;&#125;</div><div class="line">image_ref_alt = &#123;&#123; tempest_image_alt_id &#125;&#125;</div><div class="line">flavor_ref = &#123;&#123; tempest_flavor_ref_id &#125;&#125;</div><div class="line">flavor_ref_alt = &#123;&#123; tempest_flavor_ref_alt_id &#125;&#125;</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line"></div><div class="line">[dashboard]</div><div class="line">dashboard_url = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;/</div><div class="line">login_url = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;/auth/login</div><div class="line"></div><div class="line">[identity]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line">auth_version = v3</div><div class="line">uri = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;:&#123;&#123; keystone_admin_port &#125;&#125;/v2.0</div><div class="line">uri_v3 = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;:&#123;&#123; keystone_admin_port &#125;&#125;/v3</div><div class="line"></div><div class="line">[image]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line">http_image = &#123;&#123; image_url &#125;&#125;</div><div class="line"></div><div class="line">[network]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line">public_network_id =  &#123;&#123; tempest_public_network_id &#125;&#125;</div><div class="line">floating_network_name = &#123;&#123; tempest_floating_network_name &#125;&#125;</div><div class="line">project_networks_reachable = false</div><div class="line"></div><div class="line">[network-feature-enabled]</div><div class="line">ipv6 = false</div><div class="line"></div><div class="line">[object-storage]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line"></div><div class="line">[orchestration]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line"></div><div class="line">[volume]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line"></div><div class="line">[volume-feature-enabled]</div><div class="line">api_v1 = False</div><div class="line"></div><div class="line">[validation]</div><div class="line">image_ssh_user = &#123;&#123; tempest_image_ssh_user &#125;&#125;</div><div class="line">image_ssh_password = &#123;&#123; tempest_image_ssh_password &#125;&#125;</div></pre></td></tr></table></figure>
<h4 id="使用tempest测试api接口"><a href="#使用tempest测试api接口" class="headerlink" title="使用tempest测试api接口"></a>使用tempest测试api接口</h4><p><strong><em>明确需求</em></strong>：</p>
<ul>
<li>指定某些api进行测试；例如我只想测试 compute的相关api</li>
<li>执行所有的测试</li>
<li>单项api测试</li>
<li>去掉某些我不想测试的api</li>
</ul>
<h5 id="执行所有测试"><a href="#执行所有测试" class="headerlink" title="执行所有测试"></a>执行所有测试</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 验证你的配置是否正确</div><div class="line">tempest verify-config</div><div class="line"></div><div class="line"># 执行所有测试</div><div class="line">tempest run --subunit &gt; result.subunit</div><div class="line"></div><div class="line"># 生成测试报告result.html</div><div class="line">subunit2html result.subunit</div></pre></td></tr></table></figure>
<h5 id="黑名单–blacklist-file的使用"><a href="#黑名单–blacklist-file的使用" class="headerlink" title="黑名单–blacklist-file的使用"></a>黑名单–blacklist-file的使用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">--blacklist-file &lt;file name&gt;</div><div class="line">  Sample regex file:</div><div class="line"></div><div class="line">      (^tempest\.api) # Comments about this regex</div><div class="line">      tempest.scenario.test_server_basic_ops # Matches this test explicitly</div></pre></td></tr></table></figure>
<p>例如除了tempest.scenario不测，其他的都测</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# cat blacklist</div><div class="line">tempest.scenario.*</div><div class="line"></div><div class="line">tempest run --blacklist-file blacklist</div></pre></td></tr></table></figure>
<h5 id="白名单–whitelist-file的使用"><a href="#白名单–whitelist-file的使用" class="headerlink" title="白名单–whitelist-file的使用"></a>白名单–whitelist-file的使用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># 只测试tempest.api.compute</div><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# cat whitefile</div><div class="line">tempest.api.compute.*</div><div class="line"></div><div class="line">tempest run --whitelist-file whitefile</div><div class="line"></div><div class="line"># 测试一个api接口</div><div class="line"></div><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# cat one_whitefile</div><div class="line">tempest.api.compute.images.test_list_image_filters.ListImageFiltersTestJSON.test_list_images_filter_by_changes_since</div><div class="line"></div><div class="line">tempest run --whitelist-file one_whitefile</div></pre></td></tr></table></figure>
<h5 id="使用ipdb调试tempest-api"><a href="#使用ipdb调试tempest-api" class="headerlink" title="使用ipdb调试tempest api"></a>使用ipdb调试tempest api</h5><p>安装ipdb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install ipdb</div></pre></td></tr></table></figure>
<p>在程序需要中断的地方插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import ipdb; ipdb.set_trace()</div></pre></td></tr></table></figure>
<p>运行程序后, 会在执行到set_trace()的时候中断程序 并出现提示符</p>
<p>(ipdb) …</p>
<p>这时输入help即可看到ipdb下常用的命令啦</p>
<p>比较常用的是看看当前的变量 a 以及下一步 n</p>
<p>还有就是 dir() 方法 可以查看一个对象有那些方法可以调用</p>
<p>ipdb比pdb的强大在于 他包含啦 ipython 特性. 可以支持tab补全</p>
<p>下面ipdb调试tempest api接口的一个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">vim tempest/api/compute/images/test_list_image_filters.py</div><div class="line">    @decorators.idempotent_id(&apos;a3f5b513-aeb3-42a9-b18e-f091ef73254d&apos;)</div><div class="line">    def test_list_images_filter_by_status(self):</div><div class="line">        # The list of images should contain only images with the</div><div class="line">        # provided status</div><div class="line">        import ipdb; ipdb.set_trace()</div><div class="line">        params = &#123;&apos;status&apos;: &apos;ACTIVE&apos;&#125;</div><div class="line">        images = self.client.list_images(**params)[&apos;images&apos;]</div><div class="line"></div><div class="line">        self.assertNotEmpty([i for i in images if i[&apos;id&apos;] == self.image1_id])</div><div class="line">        self.assertNotEmpty([i for i in images if i[&apos;id&apos;] == self.image2_id])</div><div class="line">        self.assertNotEmpty([i for i in images if i[&apos;id&apos;] == self.image3_id])</div><div class="line"></div><div class="line">## 进行调试</div><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# python -m testtools.run tempest.api.compute.images.test_list_image_filters.ListImageFiltersTestJSON.test_list_images_filter_by_changes_since</div><div class="line">Tests running...</div><div class="line">/var/lib/kolla/venv/lib/python2.7/site-packages/IPython/core/debugger.py:243: DeprecationWarning: The `color_scheme` argument is deprecated since version 5.1</div><div class="line">  DeprecationWarning)</div><div class="line">&gt; /tempest-source/tempest-16.0.1.dev380/tempest/api/compute/images/test_list_image_filters.py(100)resource_setup()</div><div class="line">     99         # Create instances and snapshots via nova</div><div class="line">--&gt; 100         cls.server1 = cls.create_test_server()</div><div class="line">    101</div><div class="line"></div><div class="line">ipdb&gt;</div></pre></td></tr></table></figure>
<h5 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h5><p>下面是一个简单的测试脚本，测试基本都是通过的，在控制节点执行这个脚本就ok；</p>
<p>报告生成在 ／tmp/tempest目录下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">[root@control01 kolla-test]# cat run_tempest.sh</div><div class="line">#!bin/bash</div><div class="line"></div><div class="line">TEMPEST_PATH=&quot;/tmp/tempest&quot;</div><div class="line">TEMPEST_FILE=&quot;/tmp/tempest/results.html&quot;</div><div class="line"></div><div class="line">if [ ! -d &quot;$TEMPEST_PATH&quot; ]; then</div><div class="line">  mkdir &quot;$TEMPEST_PATH&quot;</div><div class="line">fi</div><div class="line"></div><div class="line">if [ -f &quot;$TEMPEST_FILE&quot; ]; then</div><div class="line">  rm -f  &quot;$TEMPEST_FILE&quot;</div><div class="line">fi</div><div class="line"></div><div class="line">cat &lt;&lt; EOF &gt; &quot;blacklist&quot;</div><div class="line">tempest.api.compute.images.test_list_image_filters.ListImageFiltersTestJSON</div><div class="line">tempest.api.network.admin.test_metering_extensions.MeteringTestJSON</div><div class="line">tempest.api.network.test_extensions.ExtensionsTestJSON</div><div class="line">tempest.api.volume.test_volume_delete_cascade.VolumesDeleteCascade</div><div class="line">tempest.api.compute.admin.test_auto_allocate_network.AutoAllocateNetworkTest</div><div class="line">tempest.api.compute.servers.test_list_server_filters.ListServerFiltersTestJSON</div><div class="line">tempest.api.compute.admin.test_server_diagnostics.ServerDiagnosticsV248Test</div><div class="line">tempest.api.compute.images.test_images.ImagesTestJSON</div><div class="line">tempest.api.compute.servers.test_delete_server.DeleteServersTestJSON</div><div class="line">tempest.api.compute.volumes.test_attach_volume.AttachVolumeShelveTestJSON</div><div class="line">tempest.api.compute.images.test_images_oneserver.ImagesOneServerTestJSON</div><div class="line">tempest.api.compute.servers.test_server_actions.ServerActionsTestJSON</div><div class="line">tempest.api.compute.servers.test_servers_negative.ServersNegativeTestJSON</div><div class="line">tempest.api.volume.admin.test_volume_types.VolumeTypesTest</div><div class="line">tempest.api.volume.admin.test_volumes_backup.VolumesBackupsAdminTest</div><div class="line">tempest.api.volume.test_volume_delete_cascade.VolumesDeleteCascade</div><div class="line">tempest.api.volume.test_volumes_backup.VolumesBackupsTest</div><div class="line">tempest.api.volume.test_volumes_snapshots.VolumesSnapshotTestJSON</div><div class="line">tempest.scenario.test_minimum_basic.TestMinimumBasicScenario</div><div class="line">tempest.scenario.test_shelve_instance.TestShelveInstance</div><div class="line">tempest.scenario.test_snapshot_pattern.TestSnapshotPattern</div><div class="line">tempest.scenario.test_volume_boot_pattern.TestVolumeBootPattern</div><div class="line">tempest.scenario.test_security_groups_basic_ops.TestSecurityGroupsBasicOps</div><div class="line">tempest.scenario.test_encrypted_cinder_volumes.TestEncryptedCinderVolumes</div><div class="line">EOF</div><div class="line"></div><div class="line">docker cp blacklist tempest:/tempest/blacklist</div><div class="line">docker exec tempest bash -c &apos;tempest run --config-file /etc/tempest/tempest.conf --blacklist-file /tempest/blacklist --subunit &gt; /tmp/results.subunit&apos;</div><div class="line">docker exec tempest bash -c &apos;subunit2html /tmp/results.subunit /tmp/results.html&apos;</div><div class="line">docker cp tempest:/tmp/results.html  $TEMPEST_FIL</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/08/01/openshift/openshift-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/01/openshift/openshift-02/" itemprop="url">opneshift 多节点测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-01T12:02:00+08:00">
                2017-08-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openshift/" itemprop="url" rel="index">
                    <span itemprop="name">openshift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/08/01/openshift/openshift-02/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/08/01/openshift/openshift-02/" class="cy_cmt_count" data-xid="2017/08/01/openshift/openshift-02/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Openshift-多节点测试"><a href="#Openshift-多节点测试" class="headerlink" title="Openshift 多节点测试"></a>Openshift 多节点测试</h3><h4 id="部署设置inventory"><a href="#部署设置inventory" class="headerlink" title="部署设置inventory"></a>部署设置inventory</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">vim mul-inventory</div><div class="line"></div><div class="line">[OSEv3:children]</div><div class="line">masters</div><div class="line">nodes</div><div class="line">etcd</div><div class="line"></div><div class="line">[OSEv3:vars]</div><div class="line">ansible_ssh_user=root</div><div class="line">openshift_deployment_type=origin</div><div class="line">openshif_release=v1.5</div><div class="line">openshift_master_identity_providers=[&#123;&apos;name&apos;: &apos;keystone_provider&apos;, &apos;login&apos;: &apos;true&apos;, &apos;challenge&apos;: &apos;true&apos;, &apos;kind&apos;: &apos;KeystonePasswordIdentityProvider&apos;, &apos;domainName&apos;: &apos;default&apos;, &apos;url&apos;: &apos;http://172.16.130.214:5000&apos; &#125;]</div><div class="line">openshift_docker_options=&quot;-l warn --ipv6=false&quot;</div><div class="line">openshift_master_cluster_method=native</div><div class="line">openshift_master_cluster_hostname=node1.99cloud.com</div><div class="line">openshift_master_cluster_public_hostname=172.16.50.43</div><div class="line">openshift_additional_repos=[&#123;&apos;id&apos;: &apos;openshift-origin-local&apos;, &apos;name&apos;: &apos;OpenShift Origin&apos;, &apos;baseurl&apos;: &apos;http://172.16.50.43:8040/centos-openshift-origin&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;,&#123;&apos;id&apos;: &apos;openshift-bse-local&apos;, &apos;name&apos;: &apos;OpenShift Base&apos;, &apos;baseurl&apos;: &apos;http://172.16.50.43:8040/base&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;]</div><div class="line">openshift_docker_additional_registries=172.16.50.43:5000</div><div class="line">openshift_docker_insecure_registries=0.0.0.0/0</div><div class="line">openshift_examples_modify_imagestreams=true</div><div class="line">openshift_cockpit_deployer_prefix=172.16.50.43:5000/openshift/</div><div class="line">openshift_cockpit=172.16.50.43:5000/openshift/cockpit/kubernetes</div><div class="line">openshift_disable_check=memory_availability,disk_availability,package_availability,package_update,docker_image_availability,docker_storage_driver,docker_storage</div><div class="line"></div><div class="line">[masters]</div><div class="line">openshif-2</div><div class="line"></div><div class="line"></div><div class="line">[etcd]</div><div class="line">openshif-2</div><div class="line">openshif-3</div><div class="line">openshif-4</div><div class="line"></div><div class="line"></div><div class="line">[nodes]</div><div class="line">openshif-3 openshift_schedulable=true openshift_node_labels=&quot;&#123;&apos;region&apos;: &apos;infra&apos;, &apos;zone&apos;: &apos;default&apos;&#125;&quot;</div><div class="line">openshif-2 openshift_schedulable=true</div><div class="line">openshif-4 openshift_schedulable=true</div></pre></td></tr></table></figure>
<p>执行部署命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@openshif-2 ~]# ansible-playbook ~/zhu/openshift-ansible/playbooks/byo/config.yml -i mul-inventory</div><div class="line">[root@openshif-2 ~]# kubectl get node</div><div class="line">NAME           STATUS    AGE</div><div class="line">172.16.50.33   Ready     16h</div><div class="line">172.16.50.37   Ready     16h</div><div class="line">172.16.50.54   Ready     16h</div></pre></td></tr></table></figure>
<h3 id="部署Openshift-ha多节点测试"><a href="#部署Openshift-ha多节点测试" class="headerlink" title="部署Openshift ha多节点测试"></a>部署Openshift ha多节点测试</h3><p>默认master节点负载均衡是haproxy，编写inventory</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">vim ha-inventory</div><div class="line"></div><div class="line">[OSEv3:children]</div><div class="line">masters</div><div class="line">nodes</div><div class="line">etcd</div><div class="line">lb</div><div class="line"></div><div class="line">[OSEv3:vars]</div><div class="line">ansible_ssh_user=root</div><div class="line">openshift_deployment_type=origin</div><div class="line">openshif_release=v1.5</div><div class="line">openshift_master_identity_providers=[&#123;&apos;name&apos;: &apos;keystone_provider&apos;, &apos;login&apos;: &apos;true&apos;, &apos;challenge&apos;: &apos;true&apos;, &apos;kind&apos;: &apos;KeystonePasswordIdentityProvider&apos;, &apos;domainName&apos;: &apos;default&apos;, &apos;url&apos;: &apos;http://172.16.130.214:5000&apos; &#125;]</div><div class="line">openshift_docker_options=&quot;-l warn --ipv6=false&quot;</div><div class="line">### ha要打开native这个选项</div><div class="line">openshift_master_cluster_method=native</div><div class="line">openshift_master_cluster_hostname=node1.99cloud.com</div><div class="line">openshift_master_cluster_public_hostname=172.16.50.43</div><div class="line">openshift_additional_repos=[&#123;&apos;id&apos;: &apos;openshift-origin-local&apos;, &apos;name&apos;: &apos;OpenShift Origin&apos;, &apos;baseurl&apos;: &apos;http://172.16.50.43:8040/centos-openshift-origin&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;,&#123;&apos;id&apos;: &apos;openshift-bse-local&apos;, &apos;name&apos;: &apos;OpenShift Base&apos;, &apos;baseurl&apos;: &apos;http://172.16.50.43:8040/base&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;]</div><div class="line">openshift_docker_additional_registries=172.16.50.43:5000</div><div class="line">openshift_docker_insecure_registries=0.0.0.0/0</div><div class="line">openshift_examples_modify_imagestreams=true</div><div class="line">openshift_cockpit_deployer_prefix=172.16.50.43:5000/openshift/</div><div class="line">openshift_cockpit=172.16.50.43:5000/openshift/cockpit/kubernetes</div><div class="line">openshift_disable_check=memory_availability,disk_availability,package_availability,package_update,docker_image_availability,docker_storage_driver,docker_storage</div><div class="line"></div><div class="line">[etcd]</div><div class="line">openshif-2</div><div class="line">openshif-3</div><div class="line">openshif-4</div><div class="line"></div><div class="line">[lb]</div><div class="line">openshif-1</div><div class="line"></div><div class="line">[nodes]</div><div class="line">openshif-3 openshift_schedulable=true openshift_node_labels=&quot;&#123;&apos;region&apos;: &apos;infra&apos;, &apos;zone&apos;: &apos;default&apos;&#125;&quot;</div><div class="line">openshif-2 openshift_schedulable=true</div><div class="line">openshif-4 openshift_schedulable=true</div></pre></td></tr></table></figure>
<p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@openshif-2 ~]# ansible-playbook ~/zhu/openshift-ansible/playbooks/byo/config.yml -i mul-inventory</div><div class="line">[root@openshif-2 ~]# kubectl get node</div><div class="line">NAME           STATUS    AGE</div><div class="line">172.16.50.33   Ready     16h</div><div class="line">172.16.50.37   Ready     16h</div><div class="line">172.16.50.54   Ready     16h</div></pre></td></tr></table></figure>
<p><strong>参考文档</strong>：<a href="https://docs.openshift.org/latest/install_config/install/advanced_install.html" target="_blank" rel="external">https://docs.openshift.org/latest/install_config/install/advanced_install.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/07/24/openstack/kolla-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/24/openstack/kolla-01/" itemprop="url">kolla 介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-24T06:30:00+08:00">
                2017-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openstack/" itemprop="url" rel="index">
                    <span itemprop="name">openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/24/openstack/kolla-01/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/07/24/openstack/kolla-01/" class="cy_cmt_count" data-xid="2017/07/24/openstack/kolla-01/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="kolla总结"><a href="#kolla总结" class="headerlink" title="kolla总结"></a>kolla总结</h3><p>在kolla项目下也快1年啦，也该总结下, 文笔不好权当记录。</p>
<h4 id="kolla的定位"><a href="#kolla的定位" class="headerlink" title="kolla的定位"></a>kolla的定位</h4><p>实现生产级别容器化openstack平台，做到开箱即用</p>
<h4 id="kolla的实现"><a href="#kolla的实现" class="headerlink" title="kolla的实现"></a>kolla的实现</h4><p>kolla实现主要以docker和ansible实现的。<br>ansible实现编排和远程推送<br>docker实现openstack服务容器化</p>
<h4 id="kolla的实现带来什么变化"><a href="#kolla的实现带来什么变化" class="headerlink" title="kolla的实现带来什么变化"></a>kolla的实现带来什么变化</h4><p>1.让安装变得更加简单</p>
<p>2.环境一致性</p>
<p>3.让openstack升级不是困难</p>
<p>4.灵活性大大加强</p>
<p>5.openstack服务微服务化</p>
<h4 id="kolla代码目录"><a href="#kolla代码目录" class="headerlink" title="kolla代码目录"></a>kolla代码目录</h4><p><img src="/images/kolla-ansible.png" alt=""></p>
<p>从顶层文件目录结构来看，各个目录所包含的内容为：</p>
<p>ansible</p>
<p>ansible 配置目录里面包含了openstack service ansible role的实现， Kolla - Kolla with ansible!，是kolla-ansible最为重要的一部分。</p>
<p>contrib</p>
<p>示例目录。里面包含了 heat 的编排配置和magnum的一些例子 ；</p>
<p>docs</p>
<p>文档目录。也是非常重要的目录，里面包括开发环境设置、镜像编译、Kolla 环境变量等说明，建议把文档都认真读一遍 ；</p>
<p>LICENSE</p>
<p>LICENSE文件。Apache License Version 2 的 License 文件，没什么好说的。</p>
<p>README.md</p>
<p>说明文件。</p>
<p>specs</p>
<p>spec目录。目前只有一个 spec，说明使用容器安装 OpenStack 的理念和优势。</p>
<p>test-requirements.txt</p>
<p>python 的 requirements 文件。用于说明测试时所需要的 python 包，目前只有一个 PyYAML。</p>
<p>tests</p>
<p>测试目录。这个目录应该包含 Kolla 的测试套件，但目前只有一个 setup_docker.sh 用于安装 docker。</p>
<p>tools</p>
<p>工具脚本目录。目录包含编译 docker 镜像、清理 docker 环境、生成 Kolla 环境变量、Kolla 启动脚本、json/yaml文件检验等脚本。建议把这个目录的脚本都看一遍，需要点 Shell、python的知识。</p>
<p>tox.ini</p>
<p>tox配置文件。tox是一个标准自动化测试工具，python里的。目前这个文件很简单，只包含了 virtualenv 设置和一些简单的检查。</p>
<p>现在 Kolla 还小，不像 nova / neutron 这些庞然大物，因此很值得把 Kolla 的代码认真看看，整理 Kolla 的设计思路，对以后把握 Kolla 的发展很有帮助，也希望大家能参与到 Kolla 的社区中，无论是贡献代码、写写 Blog、找茬，都能帮助到 Kolla</p>
<p>关于kolla方面的文章沙克写的很好，大家可以看看。<br>这个他的博客链接：<a href="http://www.chenshake.com/cloud-computing/" target="_blank" rel="external">http://www.chenshake.com/cloud-computing/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/07/17/openshift/openshift-env-reday/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/17/openshift/openshift-env-reday/" itemprop="url">openshift部署之前环境准备</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-17T06:30:00+08:00">
                2017-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openshift/" itemprop="url" rel="index">
                    <span itemprop="name">openshift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/17/openshift/openshift-env-reday/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/07/17/openshift/openshift-env-reday/" class="cy_cmt_count" data-xid="2017/07/17/openshift/openshift-env-reday/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="openshift部署之前环境准备"><a href="#openshift部署之前环境准备" class="headerlink" title="openshift部署之前环境准备"></a>openshift部署之前环境准备</h3><h4 id="准备工作-Prerequisites"><a href="#准备工作-Prerequisites" class="headerlink" title="准备工作(Prerequisites)"></a>准备工作(Prerequisites)</h4><h5 id="Install-stand-alone-registry"><a href="#Install-stand-alone-registry" class="headerlink" title="Install stand-alone registry"></a>Install stand-alone registry</h5><p> To install OpenShift Origin as a stand-alone registry, see Installing a <a href="https://docs.openshift.org/latest/install_config/install/stand_alone_registry.html#install-config-installing-stand-alone-registry" target="_blank" rel="external">Stand-alone Registry</a>.</p>
<h5 id="System-Requirements"><a href="#System-Requirements" class="headerlink" title="System Requirements"></a>System Requirements</h5><blockquote>
<p>Master</p>
</blockquote>
<pre><code>1. base os: Fedora 21, CentOS 7.3, or RHEL 7.3 with the &quot;Minimal&quot; installation option and the latest packages from the Extras channel, or RHEL Atomic Host 7.3.2 or later. RHEL 7.2 is also supported using Docker 1.12 and its dependencies.

2. 2vcpu

3. Minimum 16 GB RAM

4. Minimum 40 GB hard disk space for the file system containing /var/.
</code></pre><blockquote>
<p>Nodes</p>
</blockquote>
<pre><code>1. Physical or virtual system, or an instance running on a public or private IaaS.

2. Base OS: Fedora 21, CentOS 7.3, or RHEL 7.3 or later with &quot;Minimal&quot; installation option, or RHEL Atomic Host 7.3.2 or later. RHEL 7.2 is also supported using Docker 1.12 and its dependencies.

3. NetworkManager 1.0 or later.

4. 1 vCPU.

5. Minimum 8 GB RAM.

6. Minimum 15 GB hard disk space for the file system containing /var/.

7. An additional minimum 15 GB unallocated space to be used for Docker’s storage back end; see Configuring Docker Storage.
</code></pre><blockquote>
<p>External etcd Nodes</p>
</blockquote>
<pre><code>1. Minimum 20 GB hard disk space for etcd data.

2. Consult Hardware Recommendations to properly size your etcd nodes.

3. Currently, OpenShift Origin stores image, build, and deployment metadata in etcd. You must periodically prune old resources. If you are planning to leverage a large number of images/builds/deployments, place etcd on machines with large amounts of memory and fast SSD drives.
</code></pre><h5 id="openshift设置缓存"><a href="#openshift设置缓存" class="headerlink" title="openshift设置缓存"></a>openshift设置缓存</h5><p>openshift master 主机节点高速缓存目的是为了缓解CPU负载。然而，在小于1000pod的较小集群中，该缓存可能会浪费大量内存，从而忽略CPU负载的降低。</p>
<p>默认缓存大小为50000个条目，根据资源大小，可以增加到1到2Gb的内存。可以使用／etc/origin/master/master-config.yaml中的以下设置来减少此缓存大小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">kubernetesMasterConfig:</div><div class="line">  apiServerArguments:</div><div class="line">    deserialization-cache-size:</div><div class="line">    - &quot;1000&quot;</div></pre></td></tr></table></figure>
<h5 id="设置core使用"><a href="#设置core使用" class="headerlink" title="设置core使用"></a>设置core使用</h5><p>默认情况下，openshift origin master和node节点使用他们运行系统中的所有内核，你可以通过设置GOMAXPROCS环境变量来选择</p>
<p>我们所希望openshfit使用的内核数；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># openshift使用1个内核</div><div class="line">export GOMAXPROCS=1</div></pre></td></tr></table></figure></p>
<h5 id="SELinux"><a href="#SELinux" class="headerlink" title="SELinux"></a>SELinux</h5><p>Security-Enhanced Linux (SELinux)在安装openshit之前必须在所以节点打开（这点好怪，其他的例如openstack要关闭）不然会安装失败。<br>在 /etc/selinux/config 文件中配置SELINUXTYPE=targeted</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># This file controls the state of SELinux on the system.</div><div class="line"># SELINUX= can take one of these three values:</div><div class="line">#     enforcing - SELinux security policy is enforced.</div><div class="line">#     permissive - SELinux prints warnings instead of enforcing.</div><div class="line">#     disabled - No SELinux policy is loaded.</div><div class="line">SELINUX=enforcing</div><div class="line"># SELINUXTYPE= can take one of these three values:</div><div class="line">#     targeted - Targeted processes are protected,</div><div class="line">#     minimum - Modification of targeted policy. Only selected processes are protected.</div><div class="line">#     mls - Multi Level Security protection.</div><div class="line">SELINUXTYPE=targeted</div></pre></td></tr></table></figure>
<h5 id="NTP"><a href="#NTP" class="headerlink" title="NTP"></a>NTP</h5><p>时间同步不用多说，设置openshift_clock_enabled to true打开<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openshift_clock_enabled to true</div></pre></td></tr></table></figure></p>
<h5 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h5><p>OpenShift Origin在环境中需要一个功能齐全的DNS服务器。 这是理想的运行DNS软件的独立主机，可以为在平台上运行的主机和容器提供名称解析。</p>
<ul>
<li><ol>
<li>默认情况下，容器从主机收到dns配置文件进行解析(/etc/reslov.conf) <a href="https://docs.docker.com/engine/userguide/networking/default_network/configure-dns/" target="_blank" rel="external">contaier dns</a></li>
</ol>
</li>
<li><ol>
<li>openshift origin 将dns值插入到pods（节点的命名空间里面），这个值在/etc/orgin/node/node-config.yaml文件中由<br>dnsIP参数定义，dnsIP参数默认设置为主机节点的地址，因为主机使用dnsmasq.</li>
</ol>
</li>
<li><ol>
<li>如果在node-config.yaml文件中忽略dnpIP这个参数，就会默认为kubernetes service ip， 它是该pod的/etc/resolv.conf文件中的第一个名称服务器。</li>
</ol>
</li>
</ul>
<p>从OpenShift origin 1.2开始， dnsmasq自动配置到所以主节点（master）和节点（node）上。pod使用节点作为它的dns，然后节点接受所有转发请求。<br>默认情况下，dnsmasq在节点上进行配置监听 53端口， 所以节点不能运行其他的类型的dns应用程序。</p>
<p>节点上需要NetworkManager才能使用DNS IP地址填充dnsmasq.</p>
<p>下面是一个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">master    A   10.64.33.100</div><div class="line">node1     A   10.64.33.101</div><div class="line">node2     A   10.64.33.102</div></pre></td></tr></table></figure>
<p>如果你没有正常运行dns缓解，你下面的操作可能会失败：</p>
<ul>
<li>通过ansible脚本去安装产品</li>
<li>基础设施容器的部署（registry， routers）</li>
<li>访问OpenShif Origin Web 控制台， 因为它不能通过ip地址单独访问。</li>
</ul>
<h5 id="配置hosts使用dns"><a href="#配置hosts使用dns" class="headerlink" title="配置hosts使用dns"></a>配置hosts使用dns</h5><blockquote>
<p>确保您的环境中的每个主机都配置为从DNS服务器解析主机名。主机DNS解析的配置取决于是否启用DHCP。</p>
</blockquote>
<ul>
<li><p>如果dhcp服务器是禁用的， 应该将您的网络接口配置为静态，并将DNS名称服务器添加到NetworkManager。</p>
</li>
<li><p>如果dhcp服务器是启用的，NetworkManager调度脚本将根据DHCP配置自动配置DNS。或者，您可以在node-config.yaml文件中的dnsIP中添加一个值，以将pod的resolv.conf文件添加到前面。然后，第二个名称服务器由主机的第一个名称服务器定义。默认情况下，这将是节点主机的IP地址。</p>
</li>
</ul>
<p>对于大多数配置，请勿在OpenShift Origin（使用Ansible）高级安装期间设置openshift_dns_ip选项，因为此选项将覆盖由dnsIP设置的默认IP地址。</p>
<p>相反，允许安装程序配置每个节点使用dnsmasq并将请求转发给SkyDNS或外部DNS提供程序。如果您设置了openshift_dns_ip选项，则应该使用首先查询SkyDNS的DNS IP或SkyDNS服务或端点IP（Kubernetes服务IP）进行设置。</p>
<p>验证dns 服务器能够解析hosts</p>
<ul>
<li><ol>
<li>检查/etc/resolv.conf内容</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/resolv.conf</div><div class="line"># Generated by NetworkManager</div><div class="line">search example.com</div><div class="line">nameserver 10.64.33.1</div><div class="line"># nameserver updated by /etc/NetworkManager/dispatcher.d/99-origin-dns.sh</div></pre></td></tr></table></figure>
<p>在这个例子中， 10.64.33.1 就是我们的DNS server.</p>
<ul>
<li>2.测试/etc/resolv.conf中列出的DNS服务器是否可以将主机名解析为OpenShift Origin环境中所有主节点和IP节点的IP地址</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># dig &lt;node_hostname&gt; @&lt;IP_address&gt; +short</div><div class="line"></div><div class="line">$ dig master.example.com @10.64.33.1 +short</div><div class="line">10.64.33.100</div><div class="line">$ dig node1.example.com @10.64.33.1 +short</div><div class="line">10.64.33.101</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/07/16/openstack/rally/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/16/openstack/rally/" itemprop="url">rally-01</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-16T12:30:00+08:00">
                2017-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openstack/" itemprop="url" rel="index">
                    <span itemprop="name">openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/16/openstack/rally/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/07/16/openstack/rally/" class="cy_cmt_count" data-xid="2017/07/16/openstack/rally/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="openstack-测试介绍"><a href="#openstack-测试介绍" class="headerlink" title="openstack 测试介绍"></a>openstack 测试介绍</h3><h3 id="Rally-介绍"><a href="#Rally-介绍" class="headerlink" title="Rally 介绍"></a>Rally 介绍</h3><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>贴图：<br>文字介绍</p>
<h3 id="使用kolla部署rally"><a href="#使用kolla部署rally" class="headerlink" title="使用kolla部署rally"></a>使用kolla部署rally</h3><h3 id="rally的功能介绍"><a href="#rally的功能介绍" class="headerlink" title="rally的功能介绍"></a>rally的功能介绍</h3><h3 id="rally的基本使用"><a href="#rally的基本使用" class="headerlink" title="rally的基本使用"></a>rally的基本使用</h3><h3 id="rally调用tempest"><a href="#rally调用tempest" class="headerlink" title="rally调用tempest"></a>rally调用tempest</h3><h3 id="rally的局限性"><a href="#rally的局限性" class="headerlink" title="rally的局限性"></a>rally的局限性</h3><p>OpenStack，毫无疑问是各种服务联合的一个庞大的生态系统。</p>
<p>Rally 作为一个标准测试工具，回答了 “OpenStack 如何大规模运作？” 的问题。</p>
<p>为了使其成为可能，Rally 自动化并统一了多个节点的 OpenStack 部署、云的验证、标准测试和分析。Rally 使用一个通用的方法，使得我们能够检查 OpenStack 是否正常运作，也即，在高负荷下 1K 服务器的安装是否成功。因此，它可以作为 OpenStack CI/CD 系统的基本工具来使用，可以持续改进其 SLA、运作和稳定性。</p>
<p>Rally 的操作如下图所示：<br><a href="http://coffeechou.github.io/public/imgs/rally_actions.png" target="_blank" rel="external">http://coffeechou.github.io/public/imgs/rally_actions.png</a></p>
<h3 id="在kolla中使用rally"><a href="#在kolla中使用rally" class="headerlink" title="在kolla中使用rally"></a>在kolla中使用rally</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#在配置文件打开rally</div><div class="line">vim /etc/kolla/globals.yml</div><div class="line"></div><div class="line">enable_rally: &quot;yes&quot;</div><div class="line"></div><div class="line">#部署环境</div><div class="line">kolla-ansible deploy</div><div class="line"></div><div class="line">#生成openrc环境变量</div><div class="line">kolla-ansible post-deploy</div></pre></td></tr></table></figure>
<h3 id="初始化rally"><a href="#初始化rally" class="headerlink" title="初始化rally"></a>初始化rally</h3><h4 id="Registering-an-OpenStack-deployment-in-Rally"><a href="#Registering-an-OpenStack-deployment-in-Rally" class="headerlink" title="Registering an OpenStack deployment in Rally"></a>Registering an OpenStack deployment in Rally</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line"># 进入rally 容器</div><div class="line">[root@control01 ~]# docker exec -it -u root rally bash</div><div class="line">(rally)[root@control01 /]#</div><div class="line"></div><div class="line">(rally)[root@control01 deployments]# vim existing-keystone-v3.json</div><div class="line">&#123;</div><div class="line">    &quot;type&quot;: &quot;ExistingCloud&quot;,</div><div class="line">    &quot;auth_url&quot;: &quot;http://172.16.130.210:5000/v3&quot;,</div><div class="line">    &quot;region_name&quot;: &quot;RegionOne&quot;,</div><div class="line">    &quot;endpoint_type&quot;: &quot;public&quot;,</div><div class="line">    &quot;admin&quot;: &#123;</div><div class="line">        &quot;username&quot;: &quot;admin&quot;,</div><div class="line">        &quot;password&quot;: &quot;99cloud&quot;,</div><div class="line">        &quot;user_domain_name&quot;: &quot;deault&quot;,</div><div class="line">        &quot;project_name&quot;: &quot;admin&quot;,</div><div class="line">        &quot;project_domain_name&quot;: &quot;deault&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;https_insecure&quot;: false,</div><div class="line">    &quot;https_cacert&quot;: &quot;&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#123;% qnimg test/test.png title:test alt:test %&#125;</div><div class="line"></div><div class="line">### 创建deployments</div><div class="line">(rally)[root@control01 deployments]#rally deployment create --file existing-keystone-v3.json --name 99cloud-regionOne</div><div class="line">+--------------------------------------+---------------------+-------------------+------------------+--------+</div><div class="line">| uuid                                 | created_at          | name              | status           | active |</div><div class="line">+--------------------------------------+---------------------+-------------------+------------------+--------+</div><div class="line">| e36d802c-2211-4bac-a8ea-2f3b967568b9 | 2017-05-08 03:07:46 | 99cloud-regionOne | deploy-&gt;finished |        |</div><div class="line">+--------------------------------------+---------------------+-------------------+------------------+--------+</div><div class="line">Using deployment: e36d802c-2211-4bac-a8ea-2f3b967568b9</div><div class="line">~/.rally/openrc was updated</div><div class="line"></div><div class="line">HINTS:</div><div class="line"></div><div class="line">* To use standard OpenStack clients, set up your env by running:</div><div class="line">	source ~/.rally/openrc</div><div class="line">  OpenStack clients are now configured, e.g run:</div><div class="line">	openstack image list</div><div class="line">(rally)[root@control01 deployments]# rally deployment list</div><div class="line">+--------------------------------------+---------------------+-------------------+-------------------+--------+</div><div class="line">| uuid                                 | created_at          | name              | status            | active |</div><div class="line">+--------------------------------------+---------------------+-------------------+-------------------+--------+</div><div class="line">| af993ae9-363e-4701-b343-626063eaf715 | 2017-04-26 07:13:50 | existing          | cleanup-&gt;finished |        |</div><div class="line">| e36d802c-2211-4bac-a8ea-2f3b967568b9 | 2017-05-08 03:07:46 | 99cloud-regionOne | deploy-&gt;finished  | *      |</div><div class="line">+--------------------------------------+---------------------+-------------------+-------------------+--</div><div class="line">### 还有一种创建方法，就是使用环境变量去创建</div><div class="line">### 我们先删除之前创建的</div><div class="line">(rally)[root@control01 deployments]# rally deployment destroy 99cloud-regionOne</div><div class="line">(rally)[root@control01 deployments]# rally deployment list</div><div class="line">+--------------------------------------+---------------------+----------+-------------------+--------+</div><div class="line">| uuid                                 | created_at          | name     | status            | active |</div><div class="line">+--------------------------------------+---------------------+----------+-------------------+--------+</div><div class="line">| af993ae9-363e-4701-b343-626063eaf715 | 2017-04-26 07:13:50 | existing | cleanup-&gt;finished |        |</div><div class="line">+--------------------------------------+---------------------+----------+-------------------+--------+</div><div class="line">### (rally)[root@control01 /]# cat openrc</div><div class="line">export OS_REGION_NAME=RegionOne</div><div class="line">export OS_PROJECT_DOMAIN_NAME=default</div><div class="line">export OS_USER_DOMAIN_NAME=default</div><div class="line">export OS_PROJECT_NAME=admin</div><div class="line">export OS_TENANT_NAME=admin</div><div class="line">export OS_USERNAME=admin</div><div class="line">export OS_PASSWORD=99cloud</div><div class="line">export OS_AUTH_URL=http://172.16.130.210:35357/v3</div><div class="line">export OS_INTERFACE=internal</div><div class="line">export OS_IDENTITY_API_VERSION=3</div><div class="line"></div><div class="line">(rally)[root@control01 /]# source openrc</div><div class="line">## 测试下环境变量是否可用</div><div class="line">(rally)[root@control01 deployments]# openstack image list</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">| ID                                   | Name                              | Status |</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">| 83dc79c8-c6df-4e23-808c-0209778be1b2 | 123                               | active |</div><div class="line">| 9d4cc662-bdfb-46cb-996d-3b773ee161d5 | a1                                | active |</div><div class="line">| 255cc63c-f635-4bbb-850c-e319d2e4c17d | cenos-raw                         | active |</div><div class="line">| 63c5d475-e96a-4c1f-985b-12685aa2a95b | centos6.5                         | active |</div><div class="line">| 15ed4618-4b3b-4cc3-a9ef-6967e3a3091d | centos7                           | active |</div><div class="line">| 15f04241-38cc-482d-b6a3-42ba9d29f47a | cirros                            | active |</div><div class="line">| 6491747b-2fea-4d7c-b034-b3fe5089df2c | d1                                | active |</div><div class="line">| 4f99d882-04af-47bc-9e2d-a12aaecbf753 | s_rally_e4dbf0c1_LdpjrVlZ-shelved | active |</div><div class="line">| 6a45e590-08fc-471f-b4d8-9a6195e88d07 | s_rally_e4dbf0c1_f3TP5nP4-shelved | active |</div><div class="line">| a166585b-fb88-4c0a-a0c9-47443e9ca8be | s_rally_e4dbf0c1_lEthjCi9-shelved | active |</div><div class="line">| fa680415-4448-4564-9b22-bdf2b86b6cd2 | s_rally_e4dbf0c1_nuqTKzuQ-shelved | active |</div><div class="line">| 6eec3597-ee52-436c-9970-ec11415cbb4e | sdf1                              | active |</div><div class="line">| 1e84937a-a700-447b-8ffc-3f162127300d | snap1                             | active |</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">(rally)[root@control01 deployments]# rally deployment create --fromenv --name regiOne-99cloud</div><div class="line">+--------------------------------------+---------------------+-----------------+------------------+--------+</div><div class="line">| uuid                                 | created_at          | name            | status           | active |</div><div class="line">+--------------------------------------+---------------------+-----------------+------------------+--------+</div><div class="line">| 6682d272-5d99-400b-9de9-c4d46a705ba6 | 2017-05-08 03:21:46 | regiOne-99cloud | deploy-&gt;finished |        |</div><div class="line">+--------------------------------------+---------------------+-----------------+------------------+--------+</div><div class="line">Using deployment: 6682d272-5d99-400b-9de9-c4d46a705ba6</div><div class="line">~/.rally/openrc was updated</div><div class="line"></div><div class="line">HINTS:</div><div class="line"></div><div class="line">* To use standard OpenStack clients, set up your env by running:</div><div class="line">	source ~/.rally/openrc</div><div class="line">  OpenStack clients are now configured, e.g run:</div><div class="line">	openstack image list</div><div class="line">(rally)[root@control01 deployments]# source ~/.rally/openrc</div><div class="line">### 测试deployments是否可用</div><div class="line">(rally)[root@control01 deployments]# openstack image list</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">| ID                                   | Name                              | Status |</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">| 83dc79c8-c6df-4e23-808c-0209778be1b2 | 123                               | active |</div><div class="line">| 9d4cc662-bdfb-46cb-996d-3b773ee161d5 | a1                                | active |</div><div class="line">| 255cc63c-f635-4bbb-850c-e319d2e4c17d | cenos-raw                         | active |</div><div class="line">| 63c5d475-e96a-4c1f-985b-12685aa2a95b | centos6.5                         | active |</div><div class="line">| 15ed4618-4b3b-4cc3-a9ef-6967e3a3091d | centos7                           | active |</div><div class="line">| 15f04241-38cc-482d-b6a3-42ba9d29f47a | cirros                            | active |</div><div class="line">| 6491747b-2fea-4d7c-b034-b3fe5089df2c | d1                                | active |</div><div class="line">| 4f99d882-04af-47bc-9e2d-a12aaecbf753 | s_rally_e4dbf0c1_LdpjrVlZ-shelved | active |</div><div class="line">| 6a45e590-08fc-471f-b4d8-9a6195e88d07 | s_rally_e4dbf0c1_f3TP5nP4-shelved | active |</div><div class="line">| a166585b-fb88-4c0a-a0c9-47443e9ca8be | s_rally_e4dbf0c1_lEthjCi9-shelved | active |</div><div class="line">| fa680415-4448-4564-9b22-bdf2b86b6cd2 | s_rally_e4dbf0c1_nuqTKzuQ-shelved | active |</div><div class="line">| 6eec3597-ee52-436c-9970-ec11415cbb4e | sdf1                              | active |</div><div class="line">| 1e84937a-a700-447b-8ffc-3f162127300d | snap1                             | active |</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">(rally)[root@control01 deployments]# rally deployment list</div><div class="line">+--------------------------------------+---------------------+-----------------+-------------------+--------+</div><div class="line">| uuid                                 | created_at          | name            | status            | active |</div><div class="line">+--------------------------------------+---------------------+-----------------+-------------------+--------+</div><div class="line">| af993ae9-363e-4701-b343-626063eaf715 | 2017-04-26 07:13:50 | existing        | cleanup-&gt;finished |        |</div><div class="line">| 6682d272-5d99-400b-9de9-c4d46a705ba6 | 2017-05-08 03:21:46 | regiOne-99cloud | deploy-&gt;finished  | *      |</div><div class="line">+--------------------------------------+---------------------+-----------------+-------------------+--------+</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/07/14/openshift/openshift-iso/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/openshift/openshift-iso/" itemprop="url">openshift iso 制作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T12:37:00+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openshift/" itemprop="url" rel="index">
                    <span itemprop="name">openshift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/14/openshift/openshift-iso/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/07/14/openshift/openshift-iso/" class="cy_cmt_count" data-xid="2017/07/14/openshift/openshift-iso/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="制作iso过程文档"><a href="#制作iso过程文档" class="headerlink" title="制作iso过程文档"></a>制作iso过程文档</h2><h3 id="制作openshift-iso"><a href="#制作openshift-iso" class="headerlink" title="制作openshift iso"></a>制作openshift iso</h3><p>Fedora发行版制作的工具主要有revisor和pungi两种；<br>revisor是一个图形化的工具，也可用命令行，但是经常会有bug，而且比较臃肿，感觉是给初级用户用的；<br>pungi是Fedora官方制作（或叫spin）发行版的工具，命令行，总共也就4、5个Python文件；<br>下面是使用 pungi来制作的iso</p>
<h3 id="安装pungi"><a href="#安装pungi" class="headerlink" title="安装pungi"></a>安装pungi</h3><p>以下都是环境都是基于centos7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">## 安装epel repo</div><div class="line">yum install -y epel-release</div><div class="line"></div><div class="line">## 安装elrepo</div><div class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</div><div class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</div><div class="line"></div><div class="line">## 安装 pungi</div><div class="line">yum install -y pungi hfsplus-tools kmod-hfs kmod-hfsplus docker</div></pre></td></tr></table></figure>
<h3 id="使用pungi-build-iso"><a href="#使用pungi-build-iso" class="headerlink" title="使用pungi build iso"></a>使用pungi build iso</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@localhost kolla-iso]# git clone http://gitlab.sh.99cloud.net/zhubingbing/openshift-iso.git</div><div class="line">[root@localhost kolla-iso]# cd openshif-iso</div><div class="line">[root@localhost kolla-iso]# ls</div><div class="line">build.sh  cobbler  grub.cfg  isolinux.cfg  ks.cfg  openshift  os_ks.cfg  README.md</div><div class="line">## 这些包自己预先准备好，因为过大就没放在github上面，路径是存在 openshif-iso/openshift/目录下面，如果没有这个目录自己建立</div><div class="line">[root@localhost kolla-iso]# ls openshift/</div><div class="line">centos-openshift-origin.tar  docker-registry.tar  openshift-ansible.tar.gz  openshift-package.tar  registry.tar</div><div class="line">[root@localhost openshift]# du -h openshift/</div><div class="line">1.8G	.</div><div class="line">[root@localhost kolla-iso]# ./build.sh cobbler</div><div class="line">Sending build context to Docker daemon 34.43 MB</div><div class="line">Step 1 : FROM centos</div><div class="line"> ---&gt; 36540f359ca3</div><div class="line">Step 2 : RUN yum install -y epel-release</div><div class="line"></div><div class="line">[root@localhost kolla-iso] ./build   //等待10几分钟iso就build好了</div><div class="line">ls /root/kolla-iso/Ocata/x86_64/iso/CentOS-DVD-x86_64-Ocata.iso</div></pre></td></tr></table></figure>
<h3 id="build-sh代码"><a href="#build-sh代码" class="headerlink" title="build.sh代码"></a>build.sh代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash -e</div><div class="line">case $1 in</div><div class="line">    &apos;&apos;)</div><div class="line">pungi --name=CentOS --ver=Ocata -c ks.cfg --isfinal --nosource --nodebuginfo --force -G -C -B</div><div class="line">rsync -a isolinux.cfg Ocata/x86_64/os/isolinux/</div><div class="line">rsync -a os_ks.cfg Ocata/x86_64/os/images/ks.cfg</div><div class="line">mount Ocata/x86_64/os/images/efiboot.img /mnt</div><div class="line">rsync -a grub.cfg /mnt/EFI/BOOT/</div><div class="line">rsync -a grub.cfg Ocata/x86_64/os/EFI/BOOT/</div><div class="line">umount /mnt</div><div class="line">rm -f Ocata/x86_64/os/images/macboot.img</div><div class="line">mkdir Ocata/x86_64/os/extras</div><div class="line">rsync -a cobbler/init.sh Ocata/x86_64/os/extras</div><div class="line">rsync -a cobbler/cobbler.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/registry.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/docker-registry.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/openshift-ansible.tar.gz Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/openshift-package.tar Ocata/x86_64/os/extras</div><div class="line"></div><div class="line">pungi --name=CentOS --ver=Ocata -c ks.cfg --isfinal --nosource --nodebuginfo --force -I</div><div class="line">        ;;</div><div class="line">    &quot;cobbler&quot; )</div><div class="line">docker build -t cobbler cobbler/build/; docker save cobbler &gt; cobbler/cobbler.tar</div><div class="line">        ;;</div><div class="line">    &quot;clean&quot;)</div><div class="line">rm -rf  centos centos-extras docker epel logs ourtree work ocata Ocata cobbler/cobbler.tar</div><div class="line">        ;;</div><div class="line">esac</div></pre></td></tr></table></figure>
<h2 id="测试ISO"><a href="#测试ISO" class="headerlink" title="测试ISO"></a>测试ISO</h2><h3 id="使用openshift-iso安装部署节点"><a href="#使用openshift-iso安装部署节点" class="headerlink" title="使用openshift iso安装部署节点"></a>使用openshift iso安装部署节点</h3><h4 id="设置virtualbox虚拟机从光盘启动"><a href="#设置virtualbox虚拟机从光盘启动" class="headerlink" title="设置virtualbox虚拟机从光盘启动"></a>设置virtualbox虚拟机从光盘启动</h4><p>虚拟机配置：2c 4g 40g</p>
<img title="openshift-install01" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/openshift/openshift-install01.png">
<img title="openshift-install02" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/openshift/openshift-install02.png">
<h4 id="使用iso安装openshit部署节点"><a href="#使用iso安装openshit部署节点" class="headerlink" title="使用iso安装openshit部署节点"></a>使用iso安装openshit部署节点</h4><p>使用上下键选择安装openshift， 按下table键设置ip地址，确认（enter）开始安装</p>
<img title="openshift-install03" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/openshift/openshift-install03.png">
<p>安装完成确认3件事</p>
<ol>
<li><p>registry 是否正常启动</p>
</li>
<li><p>cobbler 是否正常</p>
</li>
<li><p>openshift yum源是否正常</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line">### cobbler 容器和registry容器正常启动</div><div class="line">[root@control01 ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</div><div class="line">e01bced0a610        registry:2          &quot;/entrypoint.sh /etc/&quot;   28 seconds ago      Up 26 seconds       0.0.0.0:4000-&gt;5000/tcp   registry</div><div class="line">b651bdf9c0c2        cobbler             &quot;/usr/bin/supervisord&quot;   2 minutes ago       Up 2 minutes                                 cobbler</div><div class="line">### 检查registry里面镜像是否正常</div><div class="line">[root@control01 openshift]# pwd</div><div class="line">/registry/docker/registry/v2/repositories/openshift</div><div class="line">[root@control01 openshift]# ls</div><div class="line">cockpit  origin-deployer  origin-docker-registry  origin-haproxy-router  origin-metrics-cassandra  origin-metrics-hawkular-metrics  origin-metrics-heapster  origin-pod</div><div class="line"></div><div class="line">### 检查openshift yum源是否可以用</div><div class="line">[root@control01 openshift]# curl http://192.168.56.100:81/openshift-package/</div><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;&gt;</div><div class="line">&lt;html&gt;</div><div class="line"> &lt;head&gt;</div><div class="line">  &lt;title&gt;Index of /openshift-package&lt;/title&gt;</div><div class="line"> &lt;/head&gt;</div><div class="line"> &lt;body&gt;</div><div class="line">&lt;h1&gt;Index of /openshift-package&lt;/h1&gt;</div><div class="line">  &lt;table&gt;</div><div class="line">   &lt;tr&gt;&lt;th valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/blank.gif&quot; alt=&quot;[ICO]&quot;&gt;&lt;/th&gt;&lt;th&gt;&lt;a href=&quot;?C=N;O=D&quot;&gt;Name&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href=&quot;?C=M;O=A&quot;&gt;Last modified&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href=&quot;?C=S;O=A&quot;&gt;Size&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href=&quot;?C=D;O=A&quot;&gt;Description&lt;/a&gt;&lt;/th&gt;&lt;/tr&gt;</div><div class="line">   &lt;tr&gt;&lt;th colspan=&quot;5&quot;&gt;&lt;hr&gt;&lt;/th&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/back.gif&quot; alt=&quot;[PARENTDIR]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;/&quot;&gt;Parent Directory&lt;/a&gt;       &lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;  - &lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;ansible-2.3.1.0-1.el7.noarch.rpm&quot;&gt;ansible-2.3.1.0-1.el..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;5.7M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;at-3.1.13-22.el7.x86_64.rpm&quot;&gt;at-3.1.13-22.el7.x86..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 51K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;attr-2.4.46-12.el7.x86_64.rpm&quot;&gt;attr-2.4.46-12.el7.x..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 66K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;avahi-libs-0.6.31-17.el7.x86_64.rpm&quot;&gt;avahi-libs-0.6.31-17..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 61K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;bash-completion-2.1-6.el7.noarch.rpm&quot;&gt;bash-completion-2.1-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 85K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;bc-1.06.95-13.el7.x86_64.rpm&quot;&gt;bc-1.06.95-13.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;115K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;bridge-utils-1.5-9.el7.x86_64.rpm&quot;&gt;bridge-utils-1.5-9.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 32K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;ceph-common-0.94.5-1.el7.x86_64.rpm&quot;&gt;ceph-common-0.94.5-1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;6.2M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;conntrack-tools-1.4.4-3.el7_3.x86_64.rpm&quot;&gt;conntrack-tools-1.4...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;186K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;cryptsetup-1.7.2-1.el7.x86_64.rpm&quot;&gt;cryptsetup-1.7.2-1.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;124K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;cups-client-1.6.3-26.el7.x86_64.rpm&quot;&gt;cups-client-1.6.3-26..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;149K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;cups-libs-1.6.3-26.el7.x86_64.rpm&quot;&gt;cups-libs-1.6.3-26.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;356K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;ed-1.9-4.el7.x86_64.rpm&quot;&gt;ed-1.9-4.el7.x86_64.rpm&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 72K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;epel-release-7-9.noarch.rpm&quot;&gt;epel-release-7-9.noa..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 14K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;etcd-3.1.9-1.el7.x86_64.rpm&quot;&gt;etcd-3.1.9-1.el7.x86..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;7.3M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;gdisk-0.8.6-5.el7.x86_64.rpm&quot;&gt;gdisk-0.8.6-5.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;187K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;glusterfs-fuse-3.7.9-12.el7.centos.x86_64.rpm&quot;&gt;glusterfs-fuse-3.7.9..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;109K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;gssproxy-0.4.1-13.el7.x86_64.rpm&quot;&gt;gssproxy-0.4.1-13.el..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 87K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;iptables-services-1.4.21-17.el7.x86_64.rpm&quot;&gt;iptables-services-1...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 50K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;iscsi-initiator-utils-6.2.0.873-35.el7.x86_64.rpm&quot;&gt;iscsi-initiator-util..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;417K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;iscsi-initiator-utils-iscsiuio-6.2.0.873-35.el7.x86_64.rpm&quot;&gt;iscsi-initiator-util..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 85K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;keyutils-1.5.8-3.el7.x86_64.rpm&quot;&gt;keyutils-1.5.8-3.el7..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 54K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libbasicobjects-0.1.1-27.el7.x86_64.rpm&quot;&gt;libbasicobjects-0.1...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 25K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libcollection-0.6.2-27.el7.x86_64.rpm&quot;&gt;libcollection-0.6.2-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 41K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libicu-50.1.2-15.el7.x86_64.rpm&quot;&gt;libicu-50.1.2-15.el7..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;6.9M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libini_config-1.3.0-27.el7.x86_64.rpm&quot;&gt;libini_config-1.3.0-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 63K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libnetfilter_cthelper-1.0.0-9.el7.x86_64.rpm&quot;&gt;libnetfilter_cthelpe..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 18K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libnetfilter_cttimeout-1.0.0-6.el7.x86_64.rpm&quot;&gt;libnetfilter_cttimeo..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 18K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libnetfilter_queue-1.0.2-2.el7.x86_64.rpm&quot;&gt;libnetfilter_queue-1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 23K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libnfsidmap-0.25-15.el7.x86_64.rpm&quot;&gt;libnfsidmap-0.25-15...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 47K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libpath_utils-0.2.1-27.el7.x86_64.rpm&quot;&gt;libpath_utils-0.2.1-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 27K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libref_array-0.1.5-27.el7.x86_64.rpm&quot;&gt;libref_array-0.1.5-2..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 26K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libtalloc-2.1.6-1.el7.x86_64.rpm&quot;&gt;libtalloc-2.1.6-1.el..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 34K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libtevent-0.9.28-1.el7.x86_64.rpm&quot;&gt;libtevent-0.9.28-1.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 34K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libtirpc-0.2.4-0.8.el7_3.x86_64.rpm&quot;&gt;libtirpc-0.2.4-0.8.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 88K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libverto-tevent-0.2.5-4.el7.x86_64.rpm&quot;&gt;libverto-tevent-0.2...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;9.0K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;m4-1.4.16-10.el7.x86_64.rpm&quot;&gt;m4-1.4.16-10.el7.x86..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;256K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;mailx-12.5-12.el7_0.x86_64.rpm&quot;&gt;mailx-12.5-12.el7_0...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;244K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;nfs-utils-1.3.0-0.33.el7_3.x86_64.rpm&quot;&gt;nfs-utils-1.3.0-0.33..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;377K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;openvswitch-2.6.1-3.git20161206.el7.x86_64.rpm&quot;&gt;openvswitch-2.6.1-3...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;4.9M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-1.5.1-1.el7.x..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 35M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-clients-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-clients-1.5.1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 16M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-docker-excluder-1.5.1-1.el7.noarch.rpm&quot;&gt;origin-docker-exclud..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;6.1K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-excluder-1.5.1-1.el7.noarch.rpm&quot;&gt;origin-excluder-1.5...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;6.1K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-master-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-master-1.5.1-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;9.2K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-node-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-node-1.5.1-1...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;7.0K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-sdn-ovs-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-sdn-ovs-1.5.1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;3.1M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;patch-2.7.1-8.el7.x86_64.rpm&quot;&gt;patch-2.7.1-8.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;110K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;psmisc-22.20-11.el7.x86_64.rpm&quot;&gt;psmisc-22.20-11.el7...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;141K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python-keyczar-0.71c-2.el7.noarch.rpm&quot;&gt;python-keyczar-0.71c..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;218K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python-rados-0.94.5-1.el7.x86_64.rpm&quot;&gt;python-rados-0.94.5-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 38K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python-rbd-0.94.5-1.el7.x86_64.rpm&quot;&gt;python-rbd-0.94.5-1...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 28K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python2-ecdsa-0.13-4.el7.noarch.rpm&quot;&gt;python2-ecdsa-0.13-4..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 83K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python2-paramiko-1.16.1-2.el7.noarch.rpm&quot;&gt;python2-paramiko-1.1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;258K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python2-pyasn1-0.1.9-7.el7.noarch.rpm&quot;&gt;python2-pyasn1-0.1.9..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;100K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;quota-4.01-14.el7.x86_64.rpm&quot;&gt;quota-4.01-14.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;179K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;quota-nls-4.01-14.el7.noarch.rpm&quot;&gt;quota-nls-4.01-14.el..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 90K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;redhat-lsb-core-4.1-27.el7.centos.1.x86_64.rpm&quot;&gt;redhat-lsb-core-4.1-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 38K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;redhat-lsb-submod-security-4.1-27.el7.centos.1.x86_64.rpm&quot;&gt;redhat-lsb-submod-se..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 15K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/folder.gif&quot; alt=&quot;[DIR]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;repodata/&quot;&gt;repodata/&lt;/a&gt;              &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:24  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;  - &lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;rpcbind-0.2.0-38.el7_3.1.x86_64.rpm&quot;&gt;rpcbind-0.2.0-38.el7..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 59K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;socat-1.7.2.2-5.el7.x86_64.rpm&quot;&gt;socat-1.7.2.2-5.el7...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;255K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;spax-1.5.2-13.el7.x86_64.rpm&quot;&gt;spax-1.5.2-13.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;260K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;tcp_wrappers-7.6-77.el7.x86_64.rpm&quot;&gt;tcp_wrappers-7.6-77...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 78K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;time-1.7-45.el7.x86_64.rpm&quot;&gt;time-1.7-45.el7.x86_..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 30K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;tuned-profiles-origin-node-1.5.1-1.el7.x86_64.rpm&quot;&gt;tuned-profiles-origi..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 11K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">   &lt;tr&gt;&lt;th colspan=&quot;5&quot;&gt;&lt;hr&gt;&lt;/th&gt;&lt;/tr&gt;</div><div class="line">&lt;/table&gt;</div></pre></td></tr></table></figure>
<p>到现在部署节点已经安装完毕；yum 源监听的是<strong>81端口</strong>，registry 监听的是<strong>4000端口</strong></p>
<h3 id="使用cobbler-安装node节点"><a href="#使用cobbler-安装node节点" class="headerlink" title="使用cobbler 安装node节点"></a>使用cobbler 安装node节点</h3><h4 id="设置虚拟机从pxe启动"><a href="#设置虚拟机从pxe启动" class="headerlink" title="设置虚拟机从pxe启动"></a>设置虚拟机从pxe启动</h4><p>在virtulbox要注意的一点是，要<strong>关闭virtulbox自带的dhcp</strong>；<strong>网络模式使用host-only</strong></p>
<img title="openshift-install04" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/openshift/openshift-install04.png">
<img title="openshift-install05" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/openshift/openshift-install05.png">
<img title="openshift-install06" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/openshift/openshift-install06.png">
<h4 id="开始安装node节点"><a href="#开始安装node节点" class="headerlink" title="开始安装node节点"></a>开始安装node节点</h4><p>使用上下键选择安装centos7， 按下table键设置ip地址，确认（enter）开始安装</p>
<img title="openshift-install07" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/openshift/openshift-install07.png">
<h2 id="安装openshift"><a href="#安装openshift" class="headerlink" title="安装openshift"></a>安装openshift</h2><h3 id="修改host文件"><a href="#修改host文件" class="headerlink" title="修改host文件"></a>修改host文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@control01 byo]# vim /etc/hosts</div><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">192.168.56.100 control01</div><div class="line">192.168.56.101 control02</div></pre></td></tr></table></figure>
<h3 id="设置inventory"><a href="#设置inventory" class="headerlink" title="设置inventory"></a>设置inventory</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">[root@control01 byo]# vim /root/openshift-ansible/inventory/byo/hosts.simple</div><div class="line">[OSEv3:children]</div><div class="line">masters</div><div class="line">nodes</div><div class="line">etcd</div><div class="line"></div><div class="line">[OSEv3:vars]</div><div class="line">ansible_ssh_user=root</div><div class="line">openshift_deployment_type=origin</div><div class="line">openshift_master_cluster_hostname=control02</div><div class="line">openshif_release=v1.5</div><div class="line">#### 注意这个all-in-one本来不该设置的，但是oepeshift内部使用域名访问</div><div class="line">openshift_master_cluster_method=native</div><div class="line">openshift_master_cluster_public_hostname=192.168.56.101</div><div class="line">openshift_docker_options=&quot;-l warn --ipv6=false&quot;</div><div class="line">openshift_master_identity_providers=[&#123;&apos;name&apos;: &apos;htpasswd_auth&apos;, &apos;login&apos;: &apos;true&apos;, &apos;challenge&apos;: &apos;true&apos;, &apos;kind&apos;: &apos;HTPasswdPasswordIdentityProvider&apos;, &apos;filename&apos;: &apos;/etc/origin/master/htpasswd&apos;&#125;]</div><div class="line">openshift_additional_repos=[&#123;&apos;id&apos;: &apos;openshift-origin-local&apos;, &apos;name&apos;: &apos;OpenShift Origin&apos;, &apos;baseurl&apos;: &apos;http://192.168.56.100:81/openshift-package&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;]</div><div class="line">openshift_docker_additional_registries=192.168.56.100:4000</div><div class="line">openshift_docker_insecure_registries=0.0.0.0/0</div><div class="line">openshift_examples_modify_imagestreams=true</div><div class="line">openshift_cockpit_deployer_prefix=192.168.56.100:4000/openshift/</div><div class="line">openshift_cockpit=192.168.56.100:4000/openshift/cockpit/kubernetes</div><div class="line">openshift_disable_check=memory_availability,disk_availability,package_version,package_availability,package_update,docker_image_availability,docker_storage_driver,docker_storage</div><div class="line"></div><div class="line">[masters]</div><div class="line">control02</div><div class="line"></div><div class="line">[etcd]</div><div class="line">control02</div><div class="line"></div><div class="line">[nodes]</div><div class="line">control02 openshift_schedulable=true  openshift_node_labels=&quot;&#123;&apos;region&apos;: &apos;infra&apos;, &apos;zone&apos;: &apos;default&apos;&#125;&quot;</div><div class="line"></div><div class="line">### 测试ansible是否ok</div><div class="line">[root@control01 byo]# ansible -i hosts.simple all -m ping</div><div class="line">control02 | SUCCESS =&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">### 安装</div><div class="line">[root@control01 ~]# ansible-playbook ~/openshift-ansible/playbooks/byo/config.yml -i  /root/openshift-ansible/inventory/byo/hosts.simple</div><div class="line"></div><div class="line">PLAY [Create initial host groups for localhost] ***************************************************************************************************************************************************************</div><div class="line"></div><div class="line">TASK [include_vars] *******************************************************************************************************************************************************************************************</div><div class="line">ok: [localhost]</div><div class="line"></div><div class="line">PLAY [Populate config host groups] ****************************************************************************************************************************************************************************</div><div class="line"></div><div class="line">TASK [Evaluate groups - g_etcd_hosts required] ****************************************************************************************************************************************************************</div><div class="line">skipping: [localhost]</div><div class="line"></div><div class="line">TASK [Evaluate groups - g_master_hosts or g_new_master_hosts required] ****************************************************************************************************************************************</div><div class="line">skipping: [localhost]</div><div class="line"></div><div class="line"></div><div class="line">TASK [openshift_excluder : Enable openshift excluder] *********************************************************************************************************************************************************</div><div class="line">changed: [control02]</div><div class="line"></div><div class="line">PLAY RECAP ****************************************************************************************************************************************************************************************************</div><div class="line">control02                  : ok=598  changed=160  unreachable=0    failed=0</div><div class="line">localhost                  : ok=12   changed=0    unreachable=0    failed=0</div><div class="line"></div><div class="line">[root@control01 ~]#</div><div class="line">[root@control01 ~]#</div><div class="line">[root@control01 ~]#</div><div class="line">[root@control01 ~]# ssh control02</div><div class="line">Warning: Permanently added &apos;control02,192.168.56.101&apos; (ECDSA) to the list of known hosts.</div><div class="line">Last login: Sun Jul 30 08:12:54 2017 from 192.168.56.100</div><div class="line">[root@control02 ~]# kubectl get nodes</div><div class="line">NAME        STATUS    AGE</div><div class="line">control02   Ready     8m</div><div class="line">[root@control02 ~]# kubectl get pods</div><div class="line">NAME                       READY     STATUS    RESTARTS   AGE</div><div class="line">docker-registry-1-2p331    1/1       Running   0          2m</div><div class="line">registry-console-1-1rvtj   1/1       Running   0          1m</div><div class="line">router-1-fhf1x             1/1       Running   0          3m</div></pre></td></tr></table></figure>
<p>安装结束，默认会安装registry、console、router</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/07/14/openshift/openshfit-iso/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/openshift/openshfit-iso/" itemprop="url">制作 openshift iso</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T12:30:00+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openshift/" itemprop="url" rel="index">
                    <span itemprop="name">openshift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/14/openshift/openshfit-iso/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/07/14/openshift/openshfit-iso/" class="cy_cmt_count" data-xid="2017/07/14/openshift/openshfit-iso/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###制作iso过程文档</p>
<h3 id="制作openshift-iso"><a href="#制作openshift-iso" class="headerlink" title="制作openshift iso"></a>制作openshift iso</h3><p>Fedora发行版制作的工具主要有revisor和pungi两种；<br>revisor是一个图形化的工具，也可用命令行，但是经常会有bug，而且比较臃肿，感觉是给初级用户用的；<br>pungi是Fedora官方制作（或叫spin）发行版的工具，命令行，总共也就4、5个Python文件；<br>下面是使用 pungi来制作的iso</p>
<h3 id="安装pungi"><a href="#安装pungi" class="headerlink" title="安装pungi"></a>安装pungi</h3><p>以下都是环境都是基于centos7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">## 安装epel repo</div><div class="line">yum install -y epel-release</div><div class="line"></div><div class="line">## 安装elrepo</div><div class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</div><div class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</div><div class="line"></div><div class="line">## 安装 pungi</div><div class="line">yum install -y pungi hfsplus-tools kmod-hfs kmod-hfsplus docker</div></pre></td></tr></table></figure>
<h3 id="使用pungi-build-iso"><a href="#使用pungi-build-iso" class="headerlink" title="使用pungi build iso"></a>使用pungi build iso</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">git clone http://gitlab.sh.99cloud.net/zhubingbing/openshift-iso.git</div><div class="line">cd openshif-iso</div><div class="line"></div><div class="line">./build cobbler  //先build cobbler tar包</div><div class="line">./build   //等待10几分钟iso就build好了</div><div class="line">ls /root/kolla-iso/Ocata/x86_64/iso/CentOS-DVD-x86_64-Ocata.iso</div></pre></td></tr></table></figure>
<h3 id="build-sh代码"><a href="#build-sh代码" class="headerlink" title="build.sh代码"></a>build.sh代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash -e</div><div class="line">case $1 in</div><div class="line">    &apos;&apos;)</div><div class="line">pungi --name=CentOS --ver=Ocata -c ks.cfg --isfinal --nosource --nodebuginfo --force -G -C -B</div><div class="line">rsync -a isolinux.cfg Ocata/x86_64/os/isolinux/</div><div class="line">rsync -a os_ks.cfg Ocata/x86_64/os/images/ks.cfg</div><div class="line">mount Ocata/x86_64/os/images/efiboot.img /mnt</div><div class="line">rsync -a grub.cfg /mnt/EFI/BOOT/</div><div class="line">rsync -a grub.cfg Ocata/x86_64/os/EFI/BOOT/</div><div class="line">umount /mnt</div><div class="line">rm -f Ocata/x86_64/os/images/macboot.img</div><div class="line">mkdir Ocata/x86_64/os/extras</div><div class="line">rsync -a cobbler/init.sh Ocata/x86_64/os/extras</div><div class="line">rsync -a cobbler/cobbler.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/registry.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/docker-registry.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/openshift-ansible.tar.gz Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/openshift-package.tar Ocata/x86_64/os/extras</div><div class="line"></div><div class="line">pungi --name=CentOS --ver=Ocata -c ks.cfg --isfinal --nosource --nodebuginfo --force -I</div><div class="line">        ;;</div><div class="line">    &quot;cobbler&quot; )</div><div class="line">docker build -t cobbler cobbler/build/; docker save cobbler &gt; cobbler/cobbler.tar</div><div class="line">        ;;</div><div class="line">    &quot;clean&quot;)</div><div class="line">rm -rf  centos centos-extras docker epel logs ourtree work ocata Ocata cobbler/cobbler.tar</div><div class="line">        ;;</div><div class="line">esac</div></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">## 这些包自己预先准备好，因为过大就没放在github上面，路径是存在 openshif-iso/openshift/目录下面，如果没有这个目录自己建立</div><div class="line">[root@localhost openshift]# ls</div><div class="line">centos-openshift-origin.tar  docker-registry.tar  openshift-ansible.tar.gz  openshift-package.tar  registry.tar</div><div class="line">[root@localhost openshift]# du -h</div><div class="line">1.8G	.</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2017/07/14/openshift/09-27-openshift-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/openshift/09-27-openshift-03/" itemprop="url">openshift v3.6 多节点安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T12:30:00+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openshift/" itemprop="url" rel="index">
                    <span itemprop="name">openshift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/14/openshift/09-27-openshift-03/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://yoursite.com/child/2017/07/14/openshift/09-27-openshift-03/" class="cy_cmt_count" data-xid="2017/07/14/openshift/09-27-openshift-03/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="设置ssh-无密码登陆"><a href="#设置ssh-无密码登陆" class="headerlink" title="设置ssh 无密码登陆"></a>设置ssh 无密码登陆</h3><p>默认在 ~/.ssh目录生成两个文件：<br> id_rsa      ：私钥<br> id_rsa.pub  ：公钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa</div></pre></td></tr></table></figure>
<p>导入本机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</div></pre></td></tr></table></figure></p>
<p>导入要免密码登录的服务器,首先将公钥复制到服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp ~/.ssh/id_rsa.pub xxx@host:/home/xxx/id_rsa.pub</div></pre></td></tr></table></figure></p>
<p>在服务器上更改pub文件权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod 700 ~/.ssh</div><div class="line">chmod 600 ~/.ssh/authorized_keys</div></pre></td></tr></table></figure></p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>通过yum 安装 ansible<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install ansible</div></pre></td></tr></table></figure></p>
<p>修改/etc/ansible/hosts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">openshift-lb</div><div class="line">openshift-master-1</div><div class="line">openshift-master-2</div><div class="line">openshift-master-3</div><div class="line">openshift-node-1</div><div class="line">openshift-node-2</div><div class="line">openshift-node-3</div></pre></td></tr></table></figure></p>
<p>测试ansible 是否可用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[root@openshift-lb ansible]# ansible all -m ping</div><div class="line">openshift-node-2 | SUCCESS =&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div><div class="line">openshift-master-1 | SUCCESS =&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div><div class="line">openshift-master-2 | SUCCESS =&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div><div class="line">openshift-master-3 | SUCCESS =&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div><div class="line">openshift-node-1 | SUCCESS =&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div><div class="line">openshift-node-3 | SUCCESS =&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用ansible 修改hosts文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible all -m copy -a &quot;src=/etc/hosts dest=/etc/hosts&quot;</div></pre></td></tr></table></figure></p>
<h2 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">error: %preun(tuned-profiles-origin-node-3.6.0-1.0.c4dd4cf.x86_64) scriptlet failed, exit status 1</div><div class="line">Error in PREUN scriptlet in rpm package tuned-profiles-origin-node-3.6.0-1.0.c4dd4cf.x86_64</div><div class="line">  Verifying  : tuned-profiles-origin-node-3.6.0-1.0.c4dd4cf.x86_64                                                                                                                                         1/1</div><div class="line"></div><div class="line">Failed:</div><div class="line">  tuned-profiles-origin-node.x86_64 0:3.6.0-1.0.c4dd4cf</div><div class="line"></div><div class="line">解决方案</div><div class="line">rpm -e --noscripts --allmatches tuned-profiles-origin-node.x86_64</div></pre></td></tr></table></figure>
<h3 id="安装openshift"><a href="#安装openshift" class="headerlink" title="安装openshift"></a>安装openshift</h3><p>下载openshift-ansible<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/openshift/openshift-ansible.git</div></pre></td></tr></table></figure></p>
<p>修改/etc/ansible/host文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="zhubingbing" />
          <p class="site-author-name" itemprop="name">zhubingbing</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhubingbing" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/zhubingbing" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/zhubingbing" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/zhubingbing" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  豆瓣
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/zhubingbing" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhubingbing</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  




  
    <script id="cy_cmt_num" src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cyt7hBR7h"></script>
  



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
