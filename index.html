<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Rotobo Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Zhubingbing" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Zhubingbing">
<meta property="og:url" content="http://zhubingbing.net/index.html">
<meta property="og:site_name" content="Zhubingbing">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zhubingbing">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhubingbing.net/"/>





  <title>Zhubingbing</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zhubingbing</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhubingbing.net/2017/08/01/openstack/Openshift 多节点测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/01/openstack/Openshift 多节点测试/" itemprop="url">Openshift-02</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-01T12:30:00+08:00">
                2017-08-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Openshift/" itemprop="url" rel="index">
                    <span itemprop="name">Openshift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/08/01/openstack/Openshift 多节点测试/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://zhubingbing.net/2017/08/01/openstack/Openshift 多节点测试/" class="cy_cmt_count" data-xid="2017/08/01/openstack/Openshift 多节点测试/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Openshift-多节点测试"><a href="#Openshift-多节点测试" class="headerlink" title="Openshift 多节点测试"></a>Openshift 多节点测试</h3><h4 id="部署设置inventory"><a href="#部署设置inventory" class="headerlink" title="部署设置inventory"></a>部署设置inventory</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">vim mul-inventory</div><div class="line"></div><div class="line">[OSEv3:children]</div><div class="line">masters</div><div class="line">nodes</div><div class="line">etcd</div><div class="line"></div><div class="line">[OSEv3:vars]</div><div class="line">ansible_ssh_user=root</div><div class="line">openshift_deployment_type=origin</div><div class="line">openshif_release=v1.5</div><div class="line">openshift_master_identity_providers=[&#123;&apos;name&apos;: &apos;keystone_provider&apos;, &apos;login&apos;: &apos;true&apos;, &apos;challenge&apos;: &apos;true&apos;, &apos;kind&apos;: &apos;KeystonePasswordIdentityProvider&apos;, &apos;domainName&apos;: &apos;default&apos;, &apos;url&apos;: &apos;http://172.16.130.214:5000&apos; &#125;]</div><div class="line">openshift_docker_options=&quot;-l warn --ipv6=false&quot;</div><div class="line">openshift_master_cluster_method=native</div><div class="line">openshift_master_cluster_hostname=node1.99cloud.com</div><div class="line">openshift_master_cluster_public_hostname=172.16.50.43</div><div class="line">openshift_additional_repos=[&#123;&apos;id&apos;: &apos;openshift-origin-local&apos;, &apos;name&apos;: &apos;OpenShift Origin&apos;, &apos;baseurl&apos;: &apos;http://172.16.50.43:8040/centos-openshift-origin&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;,&#123;&apos;id&apos;: &apos;openshift-bse-local&apos;, &apos;name&apos;: &apos;OpenShift Base&apos;, &apos;baseurl&apos;: &apos;http://172.16.50.43:8040/base&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;]</div><div class="line">openshift_docker_additional_registries=172.16.50.43:5000</div><div class="line">openshift_docker_insecure_registries=0.0.0.0/0</div><div class="line">openshift_examples_modify_imagestreams=true</div><div class="line">openshift_cockpit_deployer_prefix=172.16.50.43:5000/openshift/</div><div class="line">openshift_cockpit=172.16.50.43:5000/openshift/cockpit/kubernetes</div><div class="line">openshift_disable_check=memory_availability,disk_availability,package_availability,package_update,docker_image_availability,docker_storage_driver,docker_storage</div><div class="line"></div><div class="line">[masters]</div><div class="line">openshif-2</div><div class="line"></div><div class="line"></div><div class="line">[etcd]</div><div class="line">openshif-2</div><div class="line">openshif-3</div><div class="line">openshif-4</div><div class="line"></div><div class="line"></div><div class="line">[nodes]</div><div class="line">openshif-3 openshift_schedulable=true openshift_node_labels=&quot;&#123;&apos;region&apos;: &apos;infra&apos;, &apos;zone&apos;: &apos;default&apos;&#125;&quot;</div><div class="line">openshif-2 openshift_schedulable=true</div><div class="line">openshif-4 openshift_schedulable=true</div></pre></td></tr></table></figure>
<p>执行部署命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@openshif-2 ~]# ansible-playbook ~/zhu/openshift-ansible/playbooks/byo/config.yml -i mul-inventory</div><div class="line">[root@openshif-2 ~]# kubectl get node</div><div class="line">NAME           STATUS    AGE</div><div class="line">172.16.50.33   Ready     16h</div><div class="line">172.16.50.37   Ready     16h</div><div class="line">172.16.50.54   Ready     16h</div></pre></td></tr></table></figure>
<h3 id="部署Openshift-ha多节点测试"><a href="#部署Openshift-ha多节点测试" class="headerlink" title="部署Openshift ha多节点测试"></a>部署Openshift ha多节点测试</h3><p>默认master节点负载均衡是haproxy，编写inventory</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">vim ha-inventory</div><div class="line"></div><div class="line">[OSEv3:children]</div><div class="line">masters</div><div class="line">nodes</div><div class="line">etcd</div><div class="line">lb</div><div class="line"></div><div class="line">[OSEv3:vars]</div><div class="line">ansible_ssh_user=root</div><div class="line">openshift_deployment_type=origin</div><div class="line">openshif_release=v1.5</div><div class="line">openshift_master_identity_providers=[&#123;&apos;name&apos;: &apos;keystone_provider&apos;, &apos;login&apos;: &apos;true&apos;, &apos;challenge&apos;: &apos;true&apos;, &apos;kind&apos;: &apos;KeystonePasswordIdentityProvider&apos;, &apos;domainName&apos;: &apos;default&apos;, &apos;url&apos;: &apos;http://172.16.130.214:5000&apos; &#125;]</div><div class="line">openshift_docker_options=&quot;-l warn --ipv6=false&quot;</div><div class="line">### ha要打开native这个选项</div><div class="line">openshift_master_cluster_method=native</div><div class="line">openshift_master_cluster_hostname=node1.99cloud.com</div><div class="line">openshift_master_cluster_public_hostname=172.16.50.43</div><div class="line">openshift_additional_repos=[&#123;&apos;id&apos;: &apos;openshift-origin-local&apos;, &apos;name&apos;: &apos;OpenShift Origin&apos;, &apos;baseurl&apos;: &apos;http://172.16.50.43:8040/centos-openshift-origin&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;,&#123;&apos;id&apos;: &apos;openshift-bse-local&apos;, &apos;name&apos;: &apos;OpenShift Base&apos;, &apos;baseurl&apos;: &apos;http://172.16.50.43:8040/base&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;]</div><div class="line">openshift_docker_additional_registries=172.16.50.43:5000</div><div class="line">openshift_docker_insecure_registries=0.0.0.0/0</div><div class="line">openshift_examples_modify_imagestreams=true</div><div class="line">openshift_cockpit_deployer_prefix=172.16.50.43:5000/openshift/</div><div class="line">openshift_cockpit=172.16.50.43:5000/openshift/cockpit/kubernetes</div><div class="line">openshift_disable_check=memory_availability,disk_availability,package_availability,package_update,docker_image_availability,docker_storage_driver,docker_storage</div><div class="line"></div><div class="line">[etcd]</div><div class="line">openshif-2</div><div class="line">openshif-3</div><div class="line">openshif-4</div><div class="line"></div><div class="line">[lb]</div><div class="line">openshif-1</div><div class="line"></div><div class="line">[nodes]</div><div class="line">openshif-3 openshift_schedulable=true openshift_node_labels=&quot;&#123;&apos;region&apos;: &apos;infra&apos;, &apos;zone&apos;: &apos;default&apos;&#125;&quot;</div><div class="line">openshif-2 openshift_schedulable=true</div><div class="line">openshif-4 openshift_schedulable=true</div></pre></td></tr></table></figure>
<p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@openshif-2 ~]# ansible-playbook ~/zhu/openshift-ansible/playbooks/byo/config.yml -i mul-inventory</div><div class="line">[root@openshif-2 ~]# kubectl get node</div><div class="line">NAME           STATUS    AGE</div><div class="line">172.16.50.33   Ready     16h</div><div class="line">172.16.50.37   Ready     16h</div><div class="line">172.16.50.54   Ready     16h</div></pre></td></tr></table></figure>
<p><strong>参考文档</strong>：<a href="https://docs.openshift.org/latest/install_config/install/advanced_install.html" target="_blank" rel="external">https://docs.openshift.org/latest/install_config/install/advanced_install.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhubingbing.net/2017/07/17/openstack/openshift 部署之前环境准备/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/17/openstack/openshift 部署之前环境准备/" itemprop="url">openshift部署之前环境准备</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-17T06:30:00+08:00">
                2017-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Openshift/" itemprop="url" rel="index">
                    <span itemprop="name">Openshift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/17/openstack/openshift 部署之前环境准备/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://zhubingbing.net/2017/07/17/openstack/openshift 部署之前环境准备/" class="cy_cmt_count" data-xid="2017/07/17/openstack/openshift 部署之前环境准备/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="openshift部署之前环境准备"><a href="#openshift部署之前环境准备" class="headerlink" title="openshift部署之前环境准备"></a>openshift部署之前环境准备</h3><h4 id="准备工作-Prerequisites"><a href="#准备工作-Prerequisites" class="headerlink" title="准备工作(Prerequisites)"></a>准备工作(Prerequisites)</h4><h5 id="Install-stand-alone-registry"><a href="#Install-stand-alone-registry" class="headerlink" title="Install stand-alone registry"></a>Install stand-alone registry</h5><p> To install OpenShift Origin as a stand-alone registry, see Installing a <a href="https://docs.openshift.org/latest/install_config/install/stand_alone_registry.html#install-config-installing-stand-alone-registry" target="_blank" rel="external">Stand-alone Registry</a>.</p>
<h5 id="System-Requirements"><a href="#System-Requirements" class="headerlink" title="System Requirements"></a>System Requirements</h5><blockquote>
<p>Master</p>
</blockquote>
<pre><code>1. base os: Fedora 21, CentOS 7.3, or RHEL 7.3 with the &quot;Minimal&quot; installation option and the latest packages from the Extras channel, or RHEL Atomic Host 7.3.2 or later. RHEL 7.2 is also supported using Docker 1.12 and its dependencies.

2. 2vcpu

3. Minimum 16 GB RAM

4. Minimum 40 GB hard disk space for the file system containing /var/.
</code></pre><blockquote>
<p>Nodes</p>
</blockquote>
<pre><code>1. Physical or virtual system, or an instance running on a public or private IaaS.

2. Base OS: Fedora 21, CentOS 7.3, or RHEL 7.3 or later with &quot;Minimal&quot; installation option, or RHEL Atomic Host 7.3.2 or later. RHEL 7.2 is also supported using Docker 1.12 and its dependencies.

3. NetworkManager 1.0 or later.

4. 1 vCPU.

5. Minimum 8 GB RAM.

6. Minimum 15 GB hard disk space for the file system containing /var/.

7. An additional minimum 15 GB unallocated space to be used for Docker’s storage back end; see Configuring Docker Storage.
</code></pre><blockquote>
<p>External etcd Nodes</p>
</blockquote>
<pre><code>1. Minimum 20 GB hard disk space for etcd data.

2. Consult Hardware Recommendations to properly size your etcd nodes.

3. Currently, OpenShift Origin stores image, build, and deployment metadata in etcd. You must periodically prune old resources. If you are planning to leverage a large number of images/builds/deployments, place etcd on machines with large amounts of memory and fast SSD drives.
</code></pre><h5 id="openshift设置缓存"><a href="#openshift设置缓存" class="headerlink" title="openshift设置缓存"></a>openshift设置缓存</h5><p>openshift master 主机节点高速缓存目的是为了缓解CPU负载。然而，在小于1000pod的较小集群中，该缓存可能会浪费大量内存，从而忽略CPU负载的降低。</p>
<p>默认缓存大小为50000个条目，根据资源大小，可以增加到1到2Gb的内存。可以使用／etc/origin/master/master-config.yaml中的以下设置来减少此缓存大小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">kubernetesMasterConfig:</div><div class="line">  apiServerArguments:</div><div class="line">    deserialization-cache-size:</div><div class="line">    - &quot;1000&quot;</div></pre></td></tr></table></figure>
<h5 id="设置core使用"><a href="#设置core使用" class="headerlink" title="设置core使用"></a>设置core使用</h5><p>默认情况下，openshift origin master和node节点使用他们运行系统中的所有内核，你可以通过设置GOMAXPROCS环境变量来选择</p>
<p>我们所希望openshfit使用的内核数；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># openshift使用1个内核</div><div class="line">export GOMAXPROCS=1</div></pre></td></tr></table></figure></p>
<h5 id="SELinux"><a href="#SELinux" class="headerlink" title="SELinux"></a>SELinux</h5><p>Security-Enhanced Linux (SELinux)在安装openshit之前必须在所以节点打开（这点好怪，其他的例如openstack要关闭）不然会安装失败。<br>在 /etc/selinux/config 文件中配置SELINUXTYPE=targeted</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># This file controls the state of SELinux on the system.</div><div class="line"># SELINUX= can take one of these three values:</div><div class="line">#     enforcing - SELinux security policy is enforced.</div><div class="line">#     permissive - SELinux prints warnings instead of enforcing.</div><div class="line">#     disabled - No SELinux policy is loaded.</div><div class="line">SELINUX=enforcing</div><div class="line"># SELINUXTYPE= can take one of these three values:</div><div class="line">#     targeted - Targeted processes are protected,</div><div class="line">#     minimum - Modification of targeted policy. Only selected processes are protected.</div><div class="line">#     mls - Multi Level Security protection.</div><div class="line">SELINUXTYPE=targeted</div></pre></td></tr></table></figure>
<h5 id="NTP"><a href="#NTP" class="headerlink" title="NTP"></a>NTP</h5><p>时间同步不用多说，设置openshift_clock_enabled to true打开<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openshift_clock_enabled to true</div></pre></td></tr></table></figure></p>
<h5 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h5><p>OpenShift Origin在环境中需要一个功能齐全的DNS服务器。 这是理想的运行DNS软件的独立主机，可以为在平台上运行的主机和容器提供名称解析。</p>
<ul>
<li><ol>
<li>默认情况下，容器从主机收到dns配置文件进行解析(/etc/reslov.conf) <a href="https://docs.docker.com/engine/userguide/networking/default_network/configure-dns/" target="_blank" rel="external">contaier dns</a></li>
</ol>
</li>
<li><ol>
<li>openshift origin 将dns值插入到pods（节点的命名空间里面），这个值在/etc/orgin/node/node-config.yaml文件中由<br>dnsIP参数定义，dnsIP参数默认设置为主机节点的地址，因为主机使用dnsmasq.</li>
</ol>
</li>
<li><ol>
<li>如果在node-config.yaml文件中忽略dnpIP这个参数，就会默认为kubernetes service ip， 它是该pod的/etc/resolv.conf文件中的第一个名称服务器。</li>
</ol>
</li>
</ul>
<p>从OpenShift origin 1.2开始， dnsmasq自动配置到所以主节点（master）和节点（node）上。pod使用节点作为它的dns，然后节点接受所有转发请求。<br>默认情况下，dnsmasq在节点上进行配置监听 53端口， 所以节点不能运行其他的类型的dns应用程序。</p>
<p>节点上需要NetworkManager才能使用DNS IP地址填充dnsmasq.</p>
<p>下面是一个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">master    A   10.64.33.100</div><div class="line">node1     A   10.64.33.101</div><div class="line">node2     A   10.64.33.102</div></pre></td></tr></table></figure>
<p>如果你没有正常运行dns缓解，你下面的操作可能会失败：</p>
<ul>
<li>通过ansible脚本去安装产品</li>
<li>基础设施容器的部署（registry， routers）</li>
<li>访问OpenShif Origin Web 控制台， 因为它不能通过ip地址单独访问。</li>
</ul>
<h5 id="配置hosts使用dns"><a href="#配置hosts使用dns" class="headerlink" title="配置hosts使用dns"></a>配置hosts使用dns</h5><blockquote>
<p>确保您的环境中的每个主机都配置为从DNS服务器解析主机名。主机DNS解析的配置取决于是否启用DHCP。</p>
</blockquote>
<ul>
<li><p>如果dhcp服务器是禁用的， 应该将您的网络接口配置为静态，并将DNS名称服务器添加到NetworkManager。</p>
</li>
<li><p>如果dhcp服务器是启用的，NetworkManager调度脚本将根据DHCP配置自动配置DNS。或者，您可以在node-config.yaml文件中的dnsIP中添加一个值，以将pod的resolv.conf文件添加到前面。然后，第二个名称服务器由主机的第一个名称服务器定义。默认情况下，这将是节点主机的IP地址。</p>
</li>
</ul>
<p>对于大多数配置，请勿在OpenShift Origin（使用Ansible）高级安装期间设置openshift_dns_ip选项，因为此选项将覆盖由dnsIP设置的默认IP地址。</p>
<p>相反，允许安装程序配置每个节点使用dnsmasq并将请求转发给SkyDNS或外部DNS提供程序。如果您设置了openshift_dns_ip选项，则应该使用首先查询SkyDNS的DNS IP或SkyDNS服务或端点IP（Kubernetes服务IP）进行设置。</p>
<p>验证dns 服务器能够解析hosts</p>
<ul>
<li><ol>
<li>检查/etc/resolv.conf内容</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/resolv.conf</div><div class="line"># Generated by NetworkManager</div><div class="line">search example.com</div><div class="line">nameserver 10.64.33.1</div><div class="line"># nameserver updated by /etc/NetworkManager/dispatcher.d/99-origin-dns.sh</div></pre></td></tr></table></figure>
<p>在这个例子中， 10.64.33.1 就是我们的DNS server.</p>
<ul>
<li>2.测试/etc/resolv.conf中列出的DNS服务器是否可以将主机名解析为OpenShift Origin环境中所有主节点和IP节点的IP地址</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># dig &lt;node_hostname&gt; @&lt;IP_address&gt; +short</div><div class="line"></div><div class="line">$ dig master.example.com @10.64.33.1 +short</div><div class="line">10.64.33.100</div><div class="line">$ dig node1.example.com @10.64.33.1 +short</div><div class="line">10.64.33.101</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhubingbing.net/2017/07/14/openstack/kolla介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/openstack/kolla介绍/" itemprop="url">介绍 kolla</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T12:30:00+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Openstack/" itemprop="url" rel="index">
                    <span itemprop="name">Openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/14/openstack/kolla介绍/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://zhubingbing.net/2017/07/14/openstack/kolla介绍/" class="cy_cmt_count" data-xid="2017/07/14/openstack/kolla介绍/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="kolla总结"><a href="#kolla总结" class="headerlink" title="kolla总结"></a>kolla总结</h3><p>在kolla项目下也快1年啦，也该总结下, 文笔不好权当记录。</p>
<h4 id="kolla的定位"><a href="#kolla的定位" class="headerlink" title="kolla的定位"></a>kolla的定位</h4><p>实现生产级别容器化openstack平台，做到开箱即用</p>
<h4 id="kolla的实现"><a href="#kolla的实现" class="headerlink" title="kolla的实现"></a>kolla的实现</h4><p>kolla实现主要以docker和ansible实现的。<br>ansible实现编排和远程推送<br>docker实现openstack服务容器化</p>
<h4 id="kolla的实现带来什么变化"><a href="#kolla的实现带来什么变化" class="headerlink" title="kolla的实现带来什么变化"></a>kolla的实现带来什么变化</h4><p>1.让安装变得更加简单</p>
<p>2.环境一致性</p>
<p>3.让openstack升级不是困难</p>
<p>4.灵活性大大加强</p>
<p>5.openstack服务微服务化</p>
<h4 id="kolla代码目录"><a href="#kolla代码目录" class="headerlink" title="kolla代码目录"></a>kolla代码目录</h4><p><img src="/images/kolla-ansible.png" alt=""></p>
<p>从顶层文件目录结构来看，各个目录所包含的内容为：</p>
<p>ansible</p>
<p>ansible 配置目录里面包含了openstack service ansible role的实现， Kolla - Kolla with ansible!，是kolla-ansible最为重要的一部分。</p>
<p>contrib</p>
<p>示例目录。里面包含了 heat 的编排配置和magnum的一些例子 ；</p>
<p>docs</p>
<p>文档目录。也是非常重要的目录，里面包括开发环境设置、镜像编译、Kolla 环境变量等说明，建议把文档都认真读一遍 ；</p>
<p>LICENSE</p>
<p>LICENSE文件。Apache License Version 2 的 License 文件，没什么好说的。</p>
<p>README.md</p>
<p>说明文件。</p>
<p>specs</p>
<p>spec目录。目前只有一个 spec，说明使用容器安装 OpenStack 的理念和优势。</p>
<p>test-requirements.txt</p>
<p>python 的 requirements 文件。用于说明测试时所需要的 python 包，目前只有一个 PyYAML。</p>
<p>tests</p>
<p>测试目录。这个目录应该包含 Kolla 的测试套件，但目前只有一个 setup_docker.sh 用于安装 docker。</p>
<p>tools</p>
<p>工具脚本目录。目录包含编译 docker 镜像、清理 docker 环境、生成 Kolla 环境变量、Kolla 启动脚本、json/yaml文件检验等脚本。建议把这个目录的脚本都看一遍，需要点 Shell、python的知识。</p>
<p>tox.ini</p>
<p>tox配置文件。tox是一个标准自动化测试工具，python里的。目前这个文件很简单，只包含了 virtualenv 设置和一些简单的检查。</p>
<p>现在 Kolla 还小，不像 nova / neutron 这些庞然大物，因此很值得把 Kolla 的代码认真看看，整理 Kolla 的设计思路，对以后把握 Kolla 的发展很有帮助，也希望大家能参与到 Kolla 的社区中，无论是贡献代码、写写 Blog、找茬，都能帮助到 Kolla </p>
<p>关于kolla方面的文章沙克写的很好，大家可以看看。<br>这个他的博客链接：<a href="http://www.chenshake.com/cloud-computing/" target="_blank" rel="external">http://www.chenshake.com/cloud-computing/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhubingbing.net/2017/07/14/openstack/kolla-reconfigure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/openstack/kolla-reconfigure/" itemprop="url">kolla之reconfigure</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T12:30:00+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Openstack/" itemprop="url" rel="index">
                    <span itemprop="name">Openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/14/openstack/kolla-reconfigure/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://zhubingbing.net/2017/07/14/openstack/kolla-reconfigure/" class="cy_cmt_count" data-xid="2017/07/14/openstack/kolla-reconfigure/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>今天好好理理kolla reconfigure如何玩的</p>
</blockquote>
<p>kolla的配置管理主要是管理openstack service config文件；<br>主要实现是 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kolla-ansible reconfigure</div></pre></td></tr></table></figure>
<h4 id="reconfigure-使用"><a href="#reconfigure-使用" class="headerlink" title="reconfigure 使用"></a>reconfigure 使用</h4><p>下面以1个例子来演示下</p>
<h5 id="修改nova-conf-重启相关服务"><a href="#修改nova-conf-重启相关服务" class="headerlink" title="修改nova.conf,重启相关服务"></a>修改nova.conf,重启相关服务</h5><ul>
<li>在部署节点 新建／etc/kolla/config/nova/nova.conf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">### 修改rpc_response超时时间</div><div class="line">vim ／etc/kolla/config/nova/nova.conf</div><div class="line">rpc_response_timeout = 350</div><div class="line"></div><div class="line">## 执行reconfigure</div><div class="line">kolla-ansible reconfigure</div></pre></td></tr></table></figure>
<h4 id="reconfigure-代码流程"><a href="#reconfigure-代码流程" class="headerlink" title="reconfigure 代码流程"></a>reconfigure 代码流程</h4><p>kolla-ansible 的核心代码在ansible实现的<br>先介绍下ansible role是什么？如何使用<br>先看看下面nova role的代码目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@control01 ansible]# tree -d</div><div class="line">.</div><div class="line">├── action_plugins</div><div class="line">├── group_vars</div><div class="line">├── inventory</div><div class="line">├── library</div><div class="line">└── roles</div><div class="line">    ├── nova</div><div class="line">    │   ├── defaults</div><div class="line">    │   ├── handlers</div><div class="line">    │   ├── meta</div><div class="line">    │   ├── tasks</div><div class="line">    │   └── templates</div><div class="line">    .  </div><div class="line">    .</div><div class="line">    .</div></pre></td></tr></table></figure>
<h5 id="ansible-role是什么？"><a href="#ansible-role是什么？" class="headerlink" title="ansible role是什么？"></a>ansible role是什么？</h5><p>Ansible Role 是一种分类 &amp; 重用的概念，透过将 vars, tasks, files, templates, handler … 等等根据不同的目的(例如：nova、glance、cinder)，规划后至于独立目录中，后续便可以利用 include 的概念來使用。</p>
<p>若同样是 include 的概念，那 role 跟 include 之间不一样的地方又是在哪里呢? </p>
<p>答案是：role 的 include 机制是自动的!</p>
<p>我們只要事前將 role 的 vars / tasks / files / handler …. 等等事先定义好按照特定的结构(下面會提到)放好，Ansible 就會很聰明的幫我們 include 完成，不需要再自己一个一个指定 include。</p>
<p>透过这样的方式，管理者可以透过設定 role 的方式將所需要安裝設定的功能分门别类，拆成细项來管理并编写相对应的 script，让原本可能很庞大的设定工作可以细分成多个不同的部分來分別设定，不仅仅可以让自己重复利用特定的设定，也可以共享給其他人一同使用。</p>
<p>要设计一個 role，必須先知道怎麼將 files / templates / tasks / handlers / vars …. 等等拆开设定</p>
<p>看看下面kolla-ansible下nova role的代码目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@control01 ansible]# tree -d</div><div class="line">.</div><div class="line">├── action_plugins</div><div class="line">├── group_vars</div><div class="line">├── inventory</div><div class="line">├── library</div><div class="line">└── roles</div><div class="line">    ├── nova</div><div class="line">    │   ├── defaults</div><div class="line">    │   ├── handlers</div><div class="line">    │   ├── meta</div><div class="line">    │   ├── tasks</div><div class="line">    │   └── templates</div><div class="line">    .  </div><div class="line">    .</div><div class="line">    .</div></pre></td></tr></table></figure>
<p>以上就是一个基本完整的一个role结构，当然还有file、vars；我们这里没有使用这个2个；如果没有的部分可以不用。</p>
<p>ansible会针对role（x）进行以下处理：</p>
<ol>
<li>如果role/x／tasks／main.yml存在，则会自动加到playbook中的task list中</li>
<li>如果role/x／handlers／main.yml存在，则会自动加到playbook中的handler list中</li>
<li>如果role/x/vars/mani.yml存在，则会自动加入到playbook中的variables list中</li>
<li>如果role/x/meta/main.yml存在, 任何与指定的role想依赖的其他的role设置都会被自动加入</li>
<li>roles/x/templates/ 目录中的 template tasks，在 playbook 中使用时不需要指定绝对(absolutely) or 相对(relatively)路径</li>
<li>在 roles/x/files/ 目录中的 copy tasks 或是 script tasks，在 playbook 中使用时不需要指定绝对(absolutely) or 相对(relatively)路径</li>
<li>定义在 roles/x/defaults/main.yml 中的变量將会是使用该role时所取得的预设变量</li>
</ol>
<p>再返回来看来 kolla-ansible reconfigure 具体代码就能理解了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@control01 ansible]# kolla-ansible reconfigure</div><div class="line">Reconfigure OpenStack service : ansible-playbook -i /usr/share/kolla-ansible/ansible/inventory/all-in-one -e @/etc/kolla/globals.yml -e @/etc/kolla/passwords.yml -e CONFIG_DIR=/etc/kolla  -e action=reconfigure -e serial=0 /usr/share/kolla-ansible/ansible/site.yml</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">## glance tasks main.yaml</div><div class="line">[root@control01 tasks]# cat /root/kolla-ansible/ansible/roles/glance/tasks/main.yml</div><div class="line">---</div><div class="line">- include: &quot;&#123;&#123; action &#125;&#125;.yml&quot;</div></pre></td></tr></table></figure>
<p>从上面命令就可以看出，tasks是根据action去找相应的操作。那我们去跳到reconfigure.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@control01 tasks]# cat reconfigure.yml</div><div class="line">---</div><div class="line">- include: deploy.yml</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[root@control01 tasks]# cat deploy.yml</div><div class="line">---</div><div class="line">- include: ceph.yml</div><div class="line">  when:</div><div class="line">    - (enable_ceph | bool) and (glance_backend_ceph | bool)</div><div class="line">    - inventory_hostname in groups[&apos;ceph-mon&apos;] or</div><div class="line">      inventory_hostname in groups[&apos;glance-api&apos;] or</div><div class="line">      inventory_hostname in groups[&apos;glance-registry&apos;]</div><div class="line"></div><div class="line">- include: external_ceph.yml</div><div class="line">  when:</div><div class="line">    - (enable_ceph | bool == False) and (glance_backend_ceph | bool)</div><div class="line">    - inventory_hostname in groups[&apos;glance-api&apos;] or</div><div class="line">      inventory_hostname in groups[&apos;glance-registry&apos;]</div><div class="line"></div><div class="line">- include: register.yml</div><div class="line">  when: inventory_hostname in groups[&apos;glance-api&apos;]</div><div class="line"></div><div class="line">- include: config.yml</div><div class="line">  when: inventory_hostname in groups[&apos;glance-api&apos;] or</div><div class="line">        inventory_hostname in groups[&apos;glance-registry&apos;]</div><div class="line"></div><div class="line">- include: bootstrap.yml</div><div class="line">  when: inventory_hostname in groups[&apos;glance-api&apos;]</div><div class="line"></div><div class="line">- name: Flush handlers</div><div class="line">  meta: flush_handlers</div><div class="line"></div><div class="line">- include: check.yml</div><div class="line">  when: inventory_hostname in groups[&apos;glance-api&apos;] or</div><div class="line">        inventory_hostname in groups[&apos;glance-registry&apos;]</div></pre></td></tr></table></figure>
<p>整体的一个脉络流程就是这样；<br>下面我们一个一个去细看他们的实现。</p>
<p>这里我们主要是看config.yml和flush_handlers这个2个的实现</p>
<h4 id="config-yml"><a href="#config-yml" class="headerlink" title="config.yml"></a>config.yml</h4><p>config.yml 是用来生成openstack sevice config文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">[root@control01 tasks]# cat config.yml</div><div class="line">---</div><div class="line">### 生成 node_config_directory（默认是/etc/kolla， 你可以在all.yml中设置）sevice目录</div><div class="line">- name: Ensuring config directories exist</div><div class="line">  file:</div><div class="line">    path: &quot;&#123;&#123; node_config_directory &#125;&#125;/&#123;&#123; item.key &#125;&#125;&quot;</div><div class="line">    state: &quot;directory&quot;</div><div class="line">    recurse: yes</div><div class="line">  when:</div><div class="line">    - inventory_hostname in groups[item.value.group]</div><div class="line">    - item.value.enabled | bool</div><div class="line">  with_dict: &quot;&#123;&#123; glance_services &#125;&#125;&quot;</div><div class="line"></div><div class="line">### copy config.json file 到node_config_directory/service 目录下</div><div class="line">- name: Copying over config.json files for services</div><div class="line">  template:</div><div class="line">    src: &quot;&#123;&#123; item.key &#125;&#125;.json.j2&quot;</div><div class="line">    dest: &quot;&#123;&#123; node_config_directory &#125;&#125;/&#123;&#123; item.key &#125;&#125;/config.json&quot;</div><div class="line">  register: glance_config_jsons</div><div class="line">  when:</div><div class="line">    - item.value.enabled | bool</div><div class="line">    - inventory_hostname in groups[item.value.group]</div><div class="line">  with_dict: &quot;&#123;&#123; glance_services &#125;&#125;&quot;</div><div class="line">  notify:</div><div class="line">    - Restart glance-api container</div><div class="line">    - Restart glance-registry container</div><div class="line"></div><div class="line">- name: Copying over glance-*.conf</div><div class="line">  merge_configs:</div><div class="line">    vars:</div><div class="line">      service_name: &quot;&#123;&#123; item.key &#125;&#125;&quot;</div><div class="line">    sources:</div><div class="line">      - &quot;&#123;&#123; role_path &#125;&#125;/templates/&#123;&#123; item.key &#125;&#125;.conf.j2&quot;</div><div class="line">      - &quot;&#123;&#123; node_custom_config &#125;&#125;/global.conf&quot;</div><div class="line">      - &quot;&#123;&#123; node_custom_config &#125;&#125;/database.conf&quot;</div><div class="line">      - &quot;&#123;&#123; node_custom_config &#125;&#125;/messaging.conf&quot;</div><div class="line">      - &quot;&#123;&#123; node_custom_config &#125;&#125;/glance.conf&quot;</div><div class="line">      - &quot;&#123;&#123; node_custom_config &#125;&#125;/glance/&#123;&#123; item.key &#125;&#125;.conf&quot;</div><div class="line">      - &quot;&#123;&#123; node_custom_config &#125;&#125;/glance/&#123;&#123; inventory_hostname &#125;&#125;/&#123;&#123; item.key &#125;&#125;.conf&quot;</div><div class="line">    dest: &quot;&#123;&#123; node_config_directory &#125;&#125;/&#123;&#123; item.key &#125;&#125;/&#123;&#123; item.key &#125;&#125;.conf&quot;</div><div class="line">  register: glance_confs</div><div class="line">  when:</div><div class="line">    - item.value.enabled | bool</div><div class="line">    - inventory_hostname in groups[item.value.group]</div><div class="line">  with_dict: &quot;&#123;&#123; glance_services &#125;&#125;&quot;</div><div class="line">  notify:</div><div class="line">    - Restart glance-api container</div><div class="line">    - Restart glance-registry container</div><div class="line"></div><div class="line">- name: Check if policies shall be overwritten</div><div class="line">  local_action: stat path=&quot;&#123;&#123; node_custom_config &#125;&#125;/glance/policy.json&quot;</div><div class="line">  register: glance_policy</div><div class="line"></div><div class="line">- name: Copying over existing policy.json</div><div class="line">  template:</div><div class="line">    src: &quot;&#123;&#123; node_custom_config &#125;&#125;/glance/policy.json&quot;</div><div class="line">    dest: &quot;&#123;&#123; node_config_directory &#125;&#125;/&#123;&#123; item.key &#125;&#125;/policy.json&quot;</div><div class="line">  register: glance_policy_jsons</div><div class="line">  when:</div><div class="line">    - glance_policy.stat.exists</div><div class="line">    - inventory_hostname in groups[item.value.group]</div><div class="line">  with_dict: &quot;&#123;&#123; glance_services &#125;&#125;&quot;</div><div class="line">  notify:</div><div class="line">    - Restart glance-api container</div><div class="line">    - Restart glance-registry container</div><div class="line"></div><div class="line">- name: Check glance containers</div><div class="line">  kolla_docker:</div><div class="line">    action: &quot;compare_container&quot;</div><div class="line">    common_options: &quot;&#123;&#123; docker_common_options &#125;&#125;&quot;</div><div class="line">    name: &quot;&#123;&#123; item.value.container_name &#125;&#125;&quot;</div><div class="line">    image: &quot;&#123;&#123; item.value.image &#125;&#125;&quot;</div><div class="line">    volumes: &quot;&#123;&#123; item.value.volumes &#125;&#125;&quot;</div><div class="line">  register: check_glance_containers</div><div class="line">  when:</div><div class="line">    - action != &quot;config&quot;</div><div class="line">    - inventory_hostname in groups[item.value.group]</div><div class="line">    - item.value.enabled | bool</div><div class="line">  with_dict: &quot;&#123;&#123; glance_services &#125;&#125;&quot;</div><div class="line">  notify:</div><div class="line">    - Restart glance-api container</div><div class="line">    - Restart glance-registry container</div></pre></td></tr></table></figure>
<p>这里最核心的实现就是merge_configs。<br>action plugin中在merge_configs.py作用是导入template模板，并且run。代码在/usr/share/kolla-ansible/ansible/action_plugins/merge_configs.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div></pre></td><td class="code"><pre><div class="line">import collections</div><div class="line">import inspect</div><div class="line">import os</div><div class="line"></div><div class="line">from ansible.plugins import action</div><div class="line">from six import StringIO</div><div class="line"></div><div class="line">from oslo_config import iniparser</div><div class="line"></div><div class="line"></div><div class="line">class OverrideConfigParser(iniparser.BaseParser):</div><div class="line"></div><div class="line">    def __init__(self):</div><div class="line">        self._cur_sections = collections.OrderedDict()</div><div class="line">        self._sections = collections.OrderedDict()</div><div class="line">        self._cur_section = None</div><div class="line"></div><div class="line">    def assignment(self, key, value):</div><div class="line">        cur_value = self._cur_section.get(key)</div><div class="line">        if len(value) == 1 and value[0] == &apos;&apos;:</div><div class="line">            value = []</div><div class="line">        if not cur_value:</div><div class="line">            self._cur_section[key] = [value]</div><div class="line">        else:</div><div class="line">            self._cur_section[key].append(value)</div><div class="line"></div><div class="line">    def parse(self, lineiter):</div><div class="line">        self._cur_sections = collections.OrderedDict()</div><div class="line">        super(OverrideConfigParser, self).parse(lineiter)</div><div class="line"></div><div class="line">        # merge _cur_sections into _sections</div><div class="line">        for section, values in self._cur_sections.items():</div><div class="line">            if section not in self._sections:</div><div class="line">                self._sections[section] = collections.OrderedDict()</div><div class="line">            for key, value in values.items():</div><div class="line">                self._sections[section][key] = value</div><div class="line"></div><div class="line">    def new_section(self, section):</div><div class="line">        cur_section = self._cur_sections.get(section)</div><div class="line">        if not cur_section:</div><div class="line">            cur_section = collections.OrderedDict()</div><div class="line">            self._cur_sections[section] = cur_section</div><div class="line">        self._cur_section = cur_section</div><div class="line">        return cur_section</div><div class="line"></div><div class="line">    def write(self, fp):</div><div class="line">        def write_key_value(key, values):</div><div class="line">            for v in values:</div><div class="line">                if not v:</div><div class="line">                    fp.write(&apos;&#123;&#125; =\n&apos;.format(key))</div><div class="line">                for index, value in enumerate(v):</div><div class="line">                    if index == 0:</div><div class="line">                        fp.write(&apos;&#123;&#125; = &#123;&#125;\n&apos;.format(key, value))</div><div class="line">                    else:</div><div class="line">                        fp.write(&apos;&#123;&#125;   &#123;&#125;\n&apos;.format(len(key)*&apos; &apos;, value))</div><div class="line"></div><div class="line">        def write_section(section):</div><div class="line">            for key, values in section.items():</div><div class="line">                write_key_value(key, values)</div><div class="line"></div><div class="line">        for section in self._sections:</div><div class="line">            fp.write(&apos;[&#123;&#125;]\n&apos;.format(section))</div><div class="line">            write_section(self._sections[section])</div><div class="line">            fp.write(&apos;\n&apos;)</div><div class="line"></div><div class="line"></div><div class="line">class ActionModule(action.ActionBase):</div><div class="line"></div><div class="line">    TRANSFERS_FILES = True</div><div class="line"></div><div class="line">    def read_config(self, source, config):</div><div class="line">        # Only use config if present</div><div class="line">        if os.access(source, os.R_OK):</div><div class="line">            with open(source, &apos;r&apos;) as f:</div><div class="line">                template_data = f.read()</div><div class="line">            result = self._templar.template(template_data)</div><div class="line">            fakefile = StringIO(result)</div><div class="line">            config.parse(fakefile)</div><div class="line">            fakefile.close()</div><div class="line"></div><div class="line">    def run(self, tmp=None, task_vars=None):</div><div class="line"></div><div class="line">        if task_vars is None:</div><div class="line">            task_vars = dict()</div><div class="line">        result = super(ActionModule, self).run(tmp, task_vars)</div><div class="line"></div><div class="line">        # NOTE(jeffrey4l): Ansible 2.1 add a remote_user param to the</div><div class="line">        # _make_tmp_path function.  inspect the number of the args here. In</div><div class="line">        # this way, ansible 2.0 and ansible 2.1 are both supported</div><div class="line">        make_tmp_path_args = inspect.getargspec(self._make_tmp_path)[0]</div><div class="line">        if not tmp and len(make_tmp_path_args) == 1:</div><div class="line">            tmp = self._make_tmp_path()</div><div class="line">        if not tmp and len(make_tmp_path_args) == 2:</div><div class="line">            remote_user = (task_vars.get(&apos;ansible_user&apos;)</div><div class="line">                           or self._play_context.remote_user)</div><div class="line">            tmp = self._make_tmp_path(remote_user)</div><div class="line"></div><div class="line">        sources = self._task.args.get(&apos;sources&apos;, None)</div><div class="line">        extra_vars = self._task.args.get(&apos;vars&apos;, list())</div><div class="line"></div><div class="line">        if not isinstance(sources, list):</div><div class="line">            sources = [sources]</div><div class="line"></div><div class="line">        temp_vars = task_vars.copy()</div><div class="line">        temp_vars.update(extra_vars)</div><div class="line"></div><div class="line">        config = OverrideConfigParser()</div><div class="line">        old_vars = self._templar._available_variables</div><div class="line">        self._templar.set_available_variables(temp_vars)</div><div class="line"></div><div class="line">        for source in sources:</div><div class="line">            self.read_config(source, config)</div><div class="line"></div><div class="line">        self._templar.set_available_variables(old_vars)</div><div class="line">        # Dump configparser to string via an emulated file</div><div class="line"></div><div class="line">        fakefile = StringIO()</div><div class="line">        config.write(fakefile)</div><div class="line"></div><div class="line">        remote_path = self._connection._shell.join_path(tmp, &apos;src&apos;)</div><div class="line">        xfered = self._transfer_data(remote_path, fakefile.getvalue())</div><div class="line">        fakefile.close()</div><div class="line"></div><div class="line">        new_module_args = self._task.args.copy()</div><div class="line">        new_module_args.pop(&apos;vars&apos;, None)</div><div class="line">        new_module_args.pop(&apos;sources&apos;, None)</div><div class="line"></div><div class="line">        new_module_args.update(</div><div class="line">            dict(</div><div class="line">                src=xfered</div><div class="line">            )</div><div class="line">        )</div><div class="line"></div><div class="line">        result.update(self._execute_module(module_name=&apos;copy&apos;,</div><div class="line">                                           module_args=new_module_args,</div><div class="line">                                           task_vars=task_vars,</div><div class="line">                                           tmp=tmp))</div><div class="line">        return result</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhubingbing.net/2017/07/14/openstack/制作openshift iso/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/openstack/制作openshift iso/" itemprop="url">openshift iso 制作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T12:30:00+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenShift/" itemprop="url" rel="index">
                    <span itemprop="name">OpenShift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/14/openstack/制作openshift iso/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://zhubingbing.net/2017/07/14/openstack/制作openshift iso/" class="cy_cmt_count" data-xid="2017/07/14/openstack/制作openshift iso/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="制作iso过程文档"><a href="#制作iso过程文档" class="headerlink" title="制作iso过程文档"></a>制作iso过程文档</h2><h3 id="制作openshift-iso"><a href="#制作openshift-iso" class="headerlink" title="制作openshift iso"></a>制作openshift iso</h3><p>Fedora发行版制作的工具主要有revisor和pungi两种；<br>revisor是一个图形化的工具，也可用命令行，但是经常会有bug，而且比较臃肿，感觉是给初级用户用的；<br>pungi是Fedora官方制作（或叫spin）发行版的工具，命令行，总共也就4、5个Python文件；<br>下面是使用 pungi来制作的iso</p>
<h3 id="安装pungi"><a href="#安装pungi" class="headerlink" title="安装pungi"></a>安装pungi</h3><p>以下都是环境都是基于centos7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">## 安装epel repo</div><div class="line">yum install -y epel-release</div><div class="line"></div><div class="line">## 安装elrepo</div><div class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</div><div class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm </div><div class="line"></div><div class="line">## 安装 pungi</div><div class="line">yum install -y pungi hfsplus-tools kmod-hfs kmod-hfsplus docker</div></pre></td></tr></table></figure>
<h3 id="使用pungi-build-iso"><a href="#使用pungi-build-iso" class="headerlink" title="使用pungi build iso"></a>使用pungi build iso</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@localhost kolla-iso]# git clone http://gitlab.sh.99cloud.net/zhubingbing/openshift-iso.git</div><div class="line">[root@localhost kolla-iso]# cd openshif-iso</div><div class="line">[root@localhost kolla-iso]# ls</div><div class="line">build.sh  cobbler  grub.cfg  isolinux.cfg  ks.cfg  openshift  os_ks.cfg  README.md</div><div class="line">## 这些包自己预先准备好，因为过大就没放在github上面，路径是存在 openshif-iso/openshift/目录下面，如果没有这个目录自己建立</div><div class="line">[root@localhost kolla-iso]# ls openshift/</div><div class="line">centos-openshift-origin.tar  docker-registry.tar  openshift-ansible.tar.gz  openshift-package.tar  registry.tar</div><div class="line">[root@localhost openshift]# du -h openshift/</div><div class="line">1.8G	.</div><div class="line">[root@localhost kolla-iso]# ./build.sh cobbler</div><div class="line">Sending build context to Docker daemon 34.43 MB</div><div class="line">Step 1 : FROM centos</div><div class="line"> ---&gt; 36540f359ca3</div><div class="line">Step 2 : RUN yum install -y epel-release</div><div class="line"></div><div class="line">[root@localhost kolla-iso] ./build   //等待10几分钟iso就build好了</div><div class="line">ls /root/kolla-iso/Ocata/x86_64/iso/CentOS-DVD-x86_64-Ocata.iso</div></pre></td></tr></table></figure>
<h3 id="build-sh代码"><a href="#build-sh代码" class="headerlink" title="build.sh代码"></a>build.sh代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash -e</div><div class="line">case $1 in</div><div class="line">    &apos;&apos;)</div><div class="line">pungi --name=CentOS --ver=Ocata -c ks.cfg --isfinal --nosource --nodebuginfo --force -G -C -B</div><div class="line">rsync -a isolinux.cfg Ocata/x86_64/os/isolinux/</div><div class="line">rsync -a os_ks.cfg Ocata/x86_64/os/images/ks.cfg</div><div class="line">mount Ocata/x86_64/os/images/efiboot.img /mnt</div><div class="line">rsync -a grub.cfg /mnt/EFI/BOOT/</div><div class="line">rsync -a grub.cfg Ocata/x86_64/os/EFI/BOOT/</div><div class="line">umount /mnt</div><div class="line">rm -f Ocata/x86_64/os/images/macboot.img</div><div class="line">mkdir Ocata/x86_64/os/extras</div><div class="line">rsync -a cobbler/init.sh Ocata/x86_64/os/extras</div><div class="line">rsync -a cobbler/cobbler.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/registry.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/docker-registry.tar Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/openshift-ansible.tar.gz Ocata/x86_64/os/extras</div><div class="line">rsync -a openshift/openshift-package.tar Ocata/x86_64/os/extras</div><div class="line"></div><div class="line">pungi --name=CentOS --ver=Ocata -c ks.cfg --isfinal --nosource --nodebuginfo --force -I</div><div class="line">        ;;</div><div class="line">    &quot;cobbler&quot; )</div><div class="line">docker build -t cobbler cobbler/build/; docker save cobbler &gt; cobbler/cobbler.tar</div><div class="line">        ;;</div><div class="line">    &quot;clean&quot;)</div><div class="line">rm -rf  centos centos-extras docker epel logs ourtree work ocata Ocata cobbler/cobbler.tar</div><div class="line">        ;;</div><div class="line">esac</div></pre></td></tr></table></figure>
<h2 id="测试ISO"><a href="#测试ISO" class="headerlink" title="测试ISO"></a>测试ISO</h2><h3 id="使用openshift-iso安装部署节点"><a href="#使用openshift-iso安装部署节点" class="headerlink" title="使用openshift iso安装部署节点"></a>使用openshift iso安装部署节点</h3><h4 id="设置virtualbox虚拟机从光盘启动"><a href="#设置virtualbox虚拟机从光盘启动" class="headerlink" title="设置virtualbox虚拟机从光盘启动"></a>设置virtualbox虚拟机从光盘启动</h4><p>虚拟机配置：2c 4g 40g</p>
<p><img src="/images/openshift/openshift-install01.png" alt=""></p>
<p><img src="/images/openshift/openshift-install02.png" alt=""></p>
<h4 id="使用iso安装openshit部署节点"><a href="#使用iso安装openshit部署节点" class="headerlink" title="使用iso安装openshit部署节点"></a>使用iso安装openshit部署节点</h4><p>使用上下键选择安装openshift， 按下table键设置ip地址，确认（enter）开始安装</p>
<p><img src="/images/openshift/openshift-install03.png" alt=""></p>
<p>安装完成确认3件事</p>
<ol>
<li><p>registry 是否正常启动</p>
</li>
<li><p>cobbler 是否正常</p>
</li>
<li><p>openshift yum源是否正常</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line">### cobbler 容器和registry容器正常启动</div><div class="line">[root@control01 ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</div><div class="line">e01bced0a610        registry:2          &quot;/entrypoint.sh /etc/&quot;   28 seconds ago      Up 26 seconds       0.0.0.0:4000-&gt;5000/tcp   registry</div><div class="line">b651bdf9c0c2        cobbler             &quot;/usr/bin/supervisord&quot;   2 minutes ago       Up 2 minutes                                 cobbler</div><div class="line">### 检查registry里面镜像是否正常</div><div class="line">[root@control01 openshift]# pwd</div><div class="line">/registry/docker/registry/v2/repositories/openshift</div><div class="line">[root@control01 openshift]# ls</div><div class="line">cockpit  origin-deployer  origin-docker-registry  origin-haproxy-router  origin-metrics-cassandra  origin-metrics-hawkular-metrics  origin-metrics-heapster  origin-pod</div><div class="line"></div><div class="line">### 检查openshift yum源是否可以用</div><div class="line">[root@control01 openshift]# curl http://192.168.56.100:81/openshift-package/</div><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;&gt;</div><div class="line">&lt;html&gt;</div><div class="line"> &lt;head&gt;</div><div class="line">  &lt;title&gt;Index of /openshift-package&lt;/title&gt;</div><div class="line"> &lt;/head&gt;</div><div class="line"> &lt;body&gt;</div><div class="line">&lt;h1&gt;Index of /openshift-package&lt;/h1&gt;</div><div class="line">  &lt;table&gt;</div><div class="line">   &lt;tr&gt;&lt;th valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/blank.gif&quot; alt=&quot;[ICO]&quot;&gt;&lt;/th&gt;&lt;th&gt;&lt;a href=&quot;?C=N;O=D&quot;&gt;Name&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href=&quot;?C=M;O=A&quot;&gt;Last modified&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href=&quot;?C=S;O=A&quot;&gt;Size&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href=&quot;?C=D;O=A&quot;&gt;Description&lt;/a&gt;&lt;/th&gt;&lt;/tr&gt;</div><div class="line">   &lt;tr&gt;&lt;th colspan=&quot;5&quot;&gt;&lt;hr&gt;&lt;/th&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/back.gif&quot; alt=&quot;[PARENTDIR]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;/&quot;&gt;Parent Directory&lt;/a&gt;       &lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;  - &lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;ansible-2.3.1.0-1.el7.noarch.rpm&quot;&gt;ansible-2.3.1.0-1.el..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;5.7M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;at-3.1.13-22.el7.x86_64.rpm&quot;&gt;at-3.1.13-22.el7.x86..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 51K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;attr-2.4.46-12.el7.x86_64.rpm&quot;&gt;attr-2.4.46-12.el7.x..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 66K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;avahi-libs-0.6.31-17.el7.x86_64.rpm&quot;&gt;avahi-libs-0.6.31-17..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 61K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;bash-completion-2.1-6.el7.noarch.rpm&quot;&gt;bash-completion-2.1-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 85K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;bc-1.06.95-13.el7.x86_64.rpm&quot;&gt;bc-1.06.95-13.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;115K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;bridge-utils-1.5-9.el7.x86_64.rpm&quot;&gt;bridge-utils-1.5-9.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 32K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;ceph-common-0.94.5-1.el7.x86_64.rpm&quot;&gt;ceph-common-0.94.5-1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;6.2M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;conntrack-tools-1.4.4-3.el7_3.x86_64.rpm&quot;&gt;conntrack-tools-1.4...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;186K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;cryptsetup-1.7.2-1.el7.x86_64.rpm&quot;&gt;cryptsetup-1.7.2-1.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;124K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;cups-client-1.6.3-26.el7.x86_64.rpm&quot;&gt;cups-client-1.6.3-26..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;149K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;cups-libs-1.6.3-26.el7.x86_64.rpm&quot;&gt;cups-libs-1.6.3-26.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;356K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;ed-1.9-4.el7.x86_64.rpm&quot;&gt;ed-1.9-4.el7.x86_64.rpm&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 72K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;epel-release-7-9.noarch.rpm&quot;&gt;epel-release-7-9.noa..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 14K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;etcd-3.1.9-1.el7.x86_64.rpm&quot;&gt;etcd-3.1.9-1.el7.x86..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;7.3M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;gdisk-0.8.6-5.el7.x86_64.rpm&quot;&gt;gdisk-0.8.6-5.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;187K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;glusterfs-fuse-3.7.9-12.el7.centos.x86_64.rpm&quot;&gt;glusterfs-fuse-3.7.9..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;109K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;gssproxy-0.4.1-13.el7.x86_64.rpm&quot;&gt;gssproxy-0.4.1-13.el..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 87K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;iptables-services-1.4.21-17.el7.x86_64.rpm&quot;&gt;iptables-services-1...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 50K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;iscsi-initiator-utils-6.2.0.873-35.el7.x86_64.rpm&quot;&gt;iscsi-initiator-util..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;417K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;iscsi-initiator-utils-iscsiuio-6.2.0.873-35.el7.x86_64.rpm&quot;&gt;iscsi-initiator-util..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 85K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;keyutils-1.5.8-3.el7.x86_64.rpm&quot;&gt;keyutils-1.5.8-3.el7..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 54K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libbasicobjects-0.1.1-27.el7.x86_64.rpm&quot;&gt;libbasicobjects-0.1...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 25K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libcollection-0.6.2-27.el7.x86_64.rpm&quot;&gt;libcollection-0.6.2-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 41K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libicu-50.1.2-15.el7.x86_64.rpm&quot;&gt;libicu-50.1.2-15.el7..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;6.9M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libini_config-1.3.0-27.el7.x86_64.rpm&quot;&gt;libini_config-1.3.0-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 63K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libnetfilter_cthelper-1.0.0-9.el7.x86_64.rpm&quot;&gt;libnetfilter_cthelpe..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 18K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libnetfilter_cttimeout-1.0.0-6.el7.x86_64.rpm&quot;&gt;libnetfilter_cttimeo..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 18K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libnetfilter_queue-1.0.2-2.el7.x86_64.rpm&quot;&gt;libnetfilter_queue-1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 23K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libnfsidmap-0.25-15.el7.x86_64.rpm&quot;&gt;libnfsidmap-0.25-15...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 47K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libpath_utils-0.2.1-27.el7.x86_64.rpm&quot;&gt;libpath_utils-0.2.1-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 27K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libref_array-0.1.5-27.el7.x86_64.rpm&quot;&gt;libref_array-0.1.5-2..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 26K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libtalloc-2.1.6-1.el7.x86_64.rpm&quot;&gt;libtalloc-2.1.6-1.el..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 34K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libtevent-0.9.28-1.el7.x86_64.rpm&quot;&gt;libtevent-0.9.28-1.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 34K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libtirpc-0.2.4-0.8.el7_3.x86_64.rpm&quot;&gt;libtirpc-0.2.4-0.8.e..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 88K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;libverto-tevent-0.2.5-4.el7.x86_64.rpm&quot;&gt;libverto-tevent-0.2...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;9.0K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;m4-1.4.16-10.el7.x86_64.rpm&quot;&gt;m4-1.4.16-10.el7.x86..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;256K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;mailx-12.5-12.el7_0.x86_64.rpm&quot;&gt;mailx-12.5-12.el7_0...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;244K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;nfs-utils-1.3.0-0.33.el7_3.x86_64.rpm&quot;&gt;nfs-utils-1.3.0-0.33..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;377K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;openvswitch-2.6.1-3.git20161206.el7.x86_64.rpm&quot;&gt;openvswitch-2.6.1-3...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;4.9M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-1.5.1-1.el7.x..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 35M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-clients-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-clients-1.5.1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 16M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-docker-excluder-1.5.1-1.el7.noarch.rpm&quot;&gt;origin-docker-exclud..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;6.1K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-excluder-1.5.1-1.el7.noarch.rpm&quot;&gt;origin-excluder-1.5...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;6.1K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-master-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-master-1.5.1-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;9.2K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-node-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-node-1.5.1-1...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;7.0K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;origin-sdn-ovs-1.5.1-1.el7.x86_64.rpm&quot;&gt;origin-sdn-ovs-1.5.1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;3.1M&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;patch-2.7.1-8.el7.x86_64.rpm&quot;&gt;patch-2.7.1-8.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;110K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;psmisc-22.20-11.el7.x86_64.rpm&quot;&gt;psmisc-22.20-11.el7...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;141K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python-keyczar-0.71c-2.el7.noarch.rpm&quot;&gt;python-keyczar-0.71c..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;218K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python-rados-0.94.5-1.el7.x86_64.rpm&quot;&gt;python-rados-0.94.5-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 38K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python-rbd-0.94.5-1.el7.x86_64.rpm&quot;&gt;python-rbd-0.94.5-1...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 28K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python2-ecdsa-0.13-4.el7.noarch.rpm&quot;&gt;python2-ecdsa-0.13-4..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 83K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python2-paramiko-1.16.1-2.el7.noarch.rpm&quot;&gt;python2-paramiko-1.1..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;258K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;python2-pyasn1-0.1.9-7.el7.noarch.rpm&quot;&gt;python2-pyasn1-0.1.9..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:19  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;100K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;quota-4.01-14.el7.x86_64.rpm&quot;&gt;quota-4.01-14.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;179K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;quota-nls-4.01-14.el7.noarch.rpm&quot;&gt;quota-nls-4.01-14.el..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 90K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;redhat-lsb-core-4.1-27.el7.centos.1.x86_64.rpm&quot;&gt;redhat-lsb-core-4.1-..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 38K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;redhat-lsb-submod-security-4.1-27.el7.centos.1.x86_64.rpm&quot;&gt;redhat-lsb-submod-se..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 15K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/folder.gif&quot; alt=&quot;[DIR]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;repodata/&quot;&gt;repodata/&lt;/a&gt;              &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 14:24  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;  - &lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;rpcbind-0.2.0-38.el7_3.1.x86_64.rpm&quot;&gt;rpcbind-0.2.0-38.el7..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 59K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;socat-1.7.2.2-5.el7.x86_64.rpm&quot;&gt;socat-1.7.2.2-5.el7...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;255K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;spax-1.5.2-13.el7.x86_64.rpm&quot;&gt;spax-1.5.2-13.el7.x8..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt;260K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;tcp_wrappers-7.6-77.el7.x86_64.rpm&quot;&gt;tcp_wrappers-7.6-77...&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 78K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;time-1.7-45.el7.x86_64.rpm&quot;&gt;time-1.7-45.el7.x86_..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 30K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;img src=&quot;/icons/unknown.gif&quot; alt=&quot;[   ]&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;tuned-profiles-origin-node-1.5.1-1.el7.x86_64.rpm&quot;&gt;tuned-profiles-origi..&amp;gt;&lt;/a&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;2017-07-23 10:05  &lt;/td&gt;&lt;td align=&quot;right&quot;&gt; 11K&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</div><div class="line">   &lt;tr&gt;&lt;th colspan=&quot;5&quot;&gt;&lt;hr&gt;&lt;/th&gt;&lt;/tr&gt;</div><div class="line">&lt;/table&gt;</div></pre></td></tr></table></figure>
<p>到现在部署节点已经安装完毕；yum 源监听的是<strong>81端口</strong>，registry 监听的是<strong>4000端口</strong></p>
<h3 id="使用cobbler-安装node节点"><a href="#使用cobbler-安装node节点" class="headerlink" title="使用cobbler 安装node节点"></a>使用cobbler 安装node节点</h3><h4 id="设置虚拟机从pxe启动"><a href="#设置虚拟机从pxe启动" class="headerlink" title="设置虚拟机从pxe启动"></a>设置虚拟机从pxe启动</h4><p>在virtulbox要注意的一点是，要<strong>关闭virtulbox自带的dhcp</strong>；<strong>网络模式使用host-only</strong></p>
<p><img src="/images/openshift/openshift-install04.png" alt=""></p>
<p><img src="/images/openshift/openshift-install05.png" alt=""></p>
<p><img src="/images/openshift/openshift-install06.png" alt=""></p>
<h4 id="开始安装node节点"><a href="#开始安装node节点" class="headerlink" title="开始安装node节点"></a>开始安装node节点</h4><p>使用上下键选择安装centos7， 按下table键设置ip地址，确认（enter）开始安装</p>
<p><img src="/images/openshift/openshift-install07.png" alt=""></p>
<h2 id="安装openshift"><a href="#安装openshift" class="headerlink" title="安装openshift"></a>安装openshift</h2><h3 id="修改host文件"><a href="#修改host文件" class="headerlink" title="修改host文件"></a>修改host文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@control01 byo]# vim /etc/hosts</div><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">192.168.56.100 control01</div><div class="line">192.168.56.101 control02</div></pre></td></tr></table></figure>
<h3 id="设置inventory"><a href="#设置inventory" class="headerlink" title="设置inventory"></a>设置inventory</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">[root@control01 byo]# vim /root/openshift-ansible/inventory/byo/hosts.simple</div><div class="line">[OSEv3:children]</div><div class="line">masters</div><div class="line">nodes</div><div class="line">etcd</div><div class="line"></div><div class="line">[OSEv3:vars]</div><div class="line">ansible_ssh_user=root</div><div class="line">openshift_deployment_type=origin</div><div class="line">openshift_master_cluster_hostname=control02</div><div class="line">openshif_release=v1.5</div><div class="line">#### 注意这个all-in-one本来不该设置的，但是oepeshift内部使用域名访问</div><div class="line">openshift_master_cluster_method=native</div><div class="line">openshift_master_cluster_public_hostname=192.168.56.101</div><div class="line">openshift_docker_options=&quot;-l warn --ipv6=false&quot;</div><div class="line">openshift_master_identity_providers=[&#123;&apos;name&apos;: &apos;htpasswd_auth&apos;, &apos;login&apos;: &apos;true&apos;, &apos;challenge&apos;: &apos;true&apos;, &apos;kind&apos;: &apos;HTPasswdPasswordIdentityProvider&apos;, &apos;filename&apos;: &apos;/etc/origin/master/htpasswd&apos;&#125;]</div><div class="line">openshift_additional_repos=[&#123;&apos;id&apos;: &apos;openshift-origin-local&apos;, &apos;name&apos;: &apos;OpenShift Origin&apos;, &apos;baseurl&apos;: &apos;http://192.168.56.100:81/openshift-package&apos;, &apos;enabled&apos;: 1, &apos;gpgcheck&apos;: 0&#125;]</div><div class="line">openshift_docker_additional_registries=192.168.56.100:4000</div><div class="line">openshift_docker_insecure_registries=0.0.0.0/0</div><div class="line">openshift_examples_modify_imagestreams=true</div><div class="line">openshift_cockpit_deployer_prefix=192.168.56.100:4000/openshift/</div><div class="line">openshift_cockpit=192.168.56.100:4000/openshift/cockpit/kubernetes</div><div class="line">openshift_disable_check=memory_availability,disk_availability,package_version,package_availability,package_update,docker_image_availability,docker_storage_driver,docker_storage</div><div class="line"></div><div class="line">[masters]</div><div class="line">control02</div><div class="line"></div><div class="line">[etcd]</div><div class="line">control02</div><div class="line"></div><div class="line">[nodes]</div><div class="line">control02 openshift_schedulable=true  openshift_node_labels=&quot;&#123;&apos;region&apos;: &apos;infra&apos;, &apos;zone&apos;: &apos;default&apos;&#125;&quot;</div><div class="line"></div><div class="line">### 测试ansible是否ok</div><div class="line">[root@control01 byo]# ansible -i hosts.simple all -m ping</div><div class="line">control02 | SUCCESS =&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">### 安装</div><div class="line">[root@control01 ~]# ansible-playbook ~/openshift-ansible/playbooks/byo/config.yml -i  /root/openshift-ansible/inventory/byo/hosts.simple</div><div class="line"></div><div class="line">PLAY [Create initial host groups for localhost] ***************************************************************************************************************************************************************</div><div class="line"></div><div class="line">TASK [include_vars] *******************************************************************************************************************************************************************************************</div><div class="line">ok: [localhost]</div><div class="line"></div><div class="line">PLAY [Populate config host groups] ****************************************************************************************************************************************************************************</div><div class="line"></div><div class="line">TASK [Evaluate groups - g_etcd_hosts required] ****************************************************************************************************************************************************************</div><div class="line">skipping: [localhost]</div><div class="line"></div><div class="line">TASK [Evaluate groups - g_master_hosts or g_new_master_hosts required] ****************************************************************************************************************************************</div><div class="line">skipping: [localhost]</div><div class="line"></div><div class="line"></div><div class="line">TASK [openshift_excluder : Enable openshift excluder] *********************************************************************************************************************************************************</div><div class="line">changed: [control02]</div><div class="line"></div><div class="line">PLAY RECAP ****************************************************************************************************************************************************************************************************</div><div class="line">control02                  : ok=598  changed=160  unreachable=0    failed=0</div><div class="line">localhost                  : ok=12   changed=0    unreachable=0    failed=0</div><div class="line"></div><div class="line">[root@control01 ~]#</div><div class="line">[root@control01 ~]#</div><div class="line">[root@control01 ~]#</div><div class="line">[root@control01 ~]# ssh control02</div><div class="line">Warning: Permanently added &apos;control02,192.168.56.101&apos; (ECDSA) to the list of known hosts.</div><div class="line">Last login: Sun Jul 30 08:12:54 2017 from 192.168.56.100</div><div class="line">[root@control02 ~]# kubectl get nodes</div><div class="line">NAME        STATUS    AGE</div><div class="line">control02   Ready     8m</div><div class="line">[root@control02 ~]# kubectl get pods</div><div class="line">NAME                       READY     STATUS    RESTARTS   AGE</div><div class="line">docker-registry-1-2p331    1/1       Running   0          2m</div><div class="line">registry-console-1-1rvtj   1/1       Running   0          1m</div><div class="line">router-1-fhf1x             1/1       Running   0          3m</div></pre></td></tr></table></figure>
<p>安装结束，默认会安装registry、console、router</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhubingbing.net/2017/07/14/openstack/openshift介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/openstack/openshift介绍/" itemprop="url">Openshift-01</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T12:30:00+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Openstack/" itemprop="url" rel="index">
                    <span itemprop="name">Openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/14/openstack/openshift介绍/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://zhubingbing.net/2017/07/14/openstack/openshift介绍/" class="cy_cmt_count" data-xid="2017/07/14/openstack/openshift介绍/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="openshift-架构"><a href="#openshift-架构" class="headerlink" title="openshift 架构"></a>openshift 架构</h3><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>OpenShift是一个私有的PaaS（Platform-as-a-Service）解决方案，主要用来在容器中搭建、部署以及运行应用程序。它是基于Apache 2.0许可的开源软件， 并且发行了两个版本， 一个是社区版， 一个是企业版，由红帽主导。</p>
<h3 id="OpenShift-Origin"><a href="#OpenShift-Origin" class="headerlink" title="OpenShift Origin"></a>OpenShift Origin</h3><p>从2014年7月开始，OpenShift就己经着力于研究一个非常出色的项目，该项目是将技术架构和与Docker、Kubernetes整合到一起（现在这是一件很常见的事）。</p>
<p>一年前启动这个项目对于OpenShift来说是一个大胆而且充满风险的的决策。确实如此，当时云平台的竞争处于白热化的巅峰时期，而此时OpenShift就决定冒着风险启动这样一个非常重要的重建项目，这个风险主要来自于他们需要停止新特性的开发并妥协旧版本之间的兼容性问题。但是现在，我们相信他们作了一个正确的决定。</p>
<p>到目前为止，社区版本联合了86名GitHub上（GitHub是红帽上10个最活跃项目之一）的开发志愿者。在12个月中己经进行了16次的迭代，并且刚刚发行了第一版。</p>
<p>尽管这个方案主要是由红帽在推动，但它非常依赖Kubernetes（来源于Google）。由此引发了到底由谁来支配和主导的问题，该问题依赖于两个公司之间的协作和版本基准，Google开发出新特性后会发生什么？他们会关注Kubernetes还是OpenShift？很显然，这个问题还没有答案。</p>
<p>但是，Google的技术支持部门己经确认，由两家公司同时主导只会给OpenShift带来更多益处。它将成为比Docker企业版更具竟争力的产品（机器、组建和群）。</p>
<h3 id="OpenShift-技术堆栈"><a href="#OpenShift-技术堆栈" class="headerlink" title="OpenShift 技术堆栈"></a>OpenShift 技术堆栈</h3><img title="标题" alt="注释" src="http://owmc1r5wc.bkt.clouddn.com/static/images/test.png">
<p>从技术堆栈的角度分析，作为一个容器云，OpenShift自底而上包含了以下几个层次：基础架构层、容器引擎层、容器编排层、PaaS服务层、界面及工具层<br><img src="/images/openshif技术堆栈.png" alt=""></p>
<h4 id="基础架构层"><a href="#基础架构层" class="headerlink" title="基础架构层"></a>基础架构层</h4><p>基础架构层为OpenShift平台的运行提供了基础的运行环境。OpenShift支持运行在物理机、虚拟机、基础架构云（如OpenStack、Amazon Web Service、Microsoft Azure等）或混合云上。在操作系统层面，OpenShift支持多种不同的Linux操作系统，如企业级的Red Hat Enterprise Linux、社区的CentOS。</p>
<h4 id="容器引擎层"><a href="#容器引擎层" class="headerlink" title="容器引擎层"></a>容器引擎层</h4><p>OpenShift目前以Docker作为平台的容器引擎。Docker是当前主流的容器引擎，已经在社区及许多企业的环境中进行了检验。事实证明Docker有能力为应用提供安全、稳定及高性能的运行环境。OpenShift运行的所有容器应用最终落到最底层的实现，其实就是一个个Docker容器实例。OpenShift对Docker整合是开放式的。OpenShift并没有修改Docker的任何代码，完全基于原生的Docker。熟悉Docker的用户对OpenShift能快速上手。同时，Docker现有的庞大的镜像资源都可以无缝地接入OpenShift平台。</p>
<h4 id="容器编排层"><a href="#容器编排层" class="headerlink" title="容器编排层"></a>容器编排层</h4><p>目前大家对容器编排的讨论已经成为容器相关话题中的一个热点。Kubernetes是Google在内部多年容器使用经验基础上的一次总结。Kubernetes设计的目的是满足在大规模集群环境下对容器的调度和部署的需求。Kubernetes是OpenShift的重要组件，OpenShift平台上的许多对象和概念都是衍生自Kubernetes，如Pod、Namespace、Replication Controller等。与对Docker的集成一样，OpenShift并没有尝试从代码上定制Kubernetes，OpenShift对Kubernetes<br>的整合是叠加式的，在OpenShift集群上仍然可以通过Kubernetes的原生命令来操作Kubernetes的原生对象</p>
<h4 id="Pass服务层"><a href="#Pass服务层" class="headerlink" title="Pass服务层"></a>Pass服务层</h4><p>Docker和Kubernetes为OpenShift提供了一个良好的基础，但是只有容器引擎和容器编排工具并不能大幅度提高生产效率，形成真正的生产力。正如Kubernetes在其主页上自我介绍所描述的那样，Kubernetes关注的核心是容器应用的编排和部署，它并不是一个完整的PaaS解决方案。容器平台最终的目的是向上层应用服务提供支持，加速应用开发、部署和运维的速度和效率。OpenShift在PaaS服务层默认提供了丰富的开发语言、开发框架、数据库及中间件的支持。用户可以在OpenShift这个平台上快速部署和获取一个数据库、分布式缓存或者业务规则引擎的服务。除了Docker Hub上的社区镜像外，OpenShift还有一个重要的服务提供方：Red Hat。Red Hat旗下的JBoss中间件系列几乎全线的产品都已经容器化。JBoss中间件包含了开发框架、开发工具、应用服务器、消息中间件、SOA套件、业务流程平台（BPM）、单点登录、应用监控、应用性能管理（APM）、分布式缓存及数据虚拟化等产品。这些中间件可以直接通过OpenShift容器云对用户提供服务。通过OpenShift，可以快速搭建一个Database as a Service，即DBaaS，一个BPMaaS，或者Redis-aaS等。</p>
<h4 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h4><p>云平台一个很重要的特点是强调用户的自助服务，从而降低运维成本，提高服务效率。界面和工具是容器云平台上的最后一公里接入，好的界面和工具集合能帮助用户更高效地完成相关的任务。OpenShift提供了自动化流程Source to Image，即S2I，帮助用户容器化用各种编程语言开发的应用源代码。用户可以直接使用S2I或者把现有的流程与S2I整合，从而实现开发流程的持续集成和持续交付。提升开发、测试和部署的自动化程度，最终提高开发、测试及部署的效率，缩短上市时间。OpenShift提供了多种用户的接入渠道：Web控制台、命令行、IDE集成及RESTful编程接口。这些都是一个完善的企业级平台必不可少的组件。<br>针对容器应用的运维及集群的运维，OpenShift提供了性能度量采集、日志聚合模块及运维管理套件，帮助运维用户完成日常的应用及集群运维任务</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhubingbing.net/2017/07/06/openstack/tempest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/06/openstack/tempest/" itemprop="url">How to use tempest in kolla</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-06T12:30:00+08:00">
                2017-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Openstack/" itemprop="url" rel="index">
                    <span itemprop="name">Openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/06/openstack/tempest/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://zhubingbing.net/2017/07/06/openstack/tempest/" class="cy_cmt_count" data-xid="2017/07/06/openstack/tempest/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Tempest-介绍"><a href="#Tempest-介绍" class="headerlink" title="Tempest 介绍"></a>Tempest 介绍</h3><p>在接触tempest之前我们应该有如下疑问。</p>
<p><img src="/images/tempest.png" alt=""></p>
<h4 id="Tempest是什么"><a href="#Tempest是什么" class="headerlink" title="Tempest是什么"></a>Tempest是什么</h4><p>Tempest为OpenStack的功能测试、集成测试项目，它被设计为可在各种不同项目中使用。在OpenStack核心项目中的单元测试代码中经常可以看到它的身影，在一些孵化项目中也会使用Tempest去测试。它可以验证代码的正确性，已经成为OpenStack项目中不可或缺的组成部分.</p>
<h4 id="主要用于什么测试？"><a href="#主要用于什么测试？" class="headerlink" title="主要用于什么测试？"></a>主要用于什么测试？</h4><p>（1）API接口测试</p>
<p>（2）复杂场景测试</p>
<p>（3）单元测试</p>
<h3 id="使用kolla部署tempest"><a href="#使用kolla部署tempest" class="headerlink" title="使用kolla部署tempest"></a>使用kolla部署tempest</h3><ol>
<li><p>在/etc/kolla/globals.yml开启tempest同时设置tempest相应的配置参数（image_id等）</p>
<p><strong>注: 我是使用cirros镜像进行测试，按照实际情况替换相应参数</strong></p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# vim /etc/kolla/globals.yml</div><div class="line">enable_tempest: &quot;yes&quot; </div><div class="line">tempest_image_id: &quot;570cab5e-4609-43cc-8c1e-3f7d7217ed30&quot;</div><div class="line">tempest_flavor_ref_id: &quot;1&quot;</div><div class="line">tempest_public_network_id: &quot;4c5928f2-6ade-498f-a692-98a775a7183a&quot;</div><div class="line">tempest_floating_network_name: &quot;public1&quot;</div></pre></td></tr></table></figure>
<p>参数以如下命令获得</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"># image id</div><div class="line">[root@control01 ~]# openstack image show cirros -c id -f value</div><div class="line">570cab5e-4609-43cc-8c1e-3f7d7217ed30</div><div class="line"></div><div class="line"># flavor_ref_id</div><div class="line">[root@control01 ~]# nova flavor-list</div><div class="line">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</div><div class="line">| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |</div><div class="line">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</div><div class="line">| 1  | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |</div><div class="line">| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |</div><div class="line">| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |</div><div class="line">| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |</div><div class="line">| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True</div><div class="line"></div><div class="line"># public_network_id</div><div class="line">[root@control01 ~]# openstack network show public1 -c id -f value</div><div class="line">4c5928f2-6ade-498f-a692-98a775a7183a</div><div class="line"></div><div class="line"># floating_network_name</div><div class="line">[root@control01 ~]# openstack network list</div><div class="line">+--------------------------------------+----------+--------------------------------------+</div><div class="line">| ID                                   | Name     | Subnets                              |</div><div class="line">+--------------------------------------+----------+--------------------------------------+</div><div class="line">| 0474116d-0fbd-41a3-ab0c-2c2d11545937 | demo-net | 7366e03d-027b-4a44-b270-d0478584f3e8 |</div><div class="line">| 4c5928f2-6ade-498f-a692-98a775a7183a | public1  | 2c47f34c-f55a-4739-a677-2cbfa56b6312 |</div><div class="line">+--------------------------------------+----------+--------------------------------------+</div></pre></td></tr></table></figure>
<ol>
<li>使用kolla-ansible deploy部署tempest</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">root@control01 ~]# kolla-ansible deploy -t tempest</div><div class="line">## 看到tempest容器运行部署就算成功</div><div class="line">root@control01 ~]# docker ps | grep tempest</div><div class="line">95b57e77b006        kolla/centos-source-tempest:5.0.0                     &quot;kolla_start&quot;            46 hours ago        Up 21 hours</div></pre></td></tr></table></figure>
<h3 id="Tempest使用"><a href="#Tempest使用" class="headerlink" title="Tempest使用"></a>Tempest使用</h3><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><h5 id="了解tempest-cmd基本使用"><a href="#了解tempest-cmd基本使用" class="headerlink" title="了解tempest cmd基本使用"></a>了解tempest cmd基本使用</h5><p><a href="https://specs.openstack.org/openstack/qa-specs/specs/tempest/tempest-run-cmd.html" target="_blank" rel="external">官网文档</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# tempest --help</div><div class="line">usage: tempest [--version] [-v | -q] [--log-file LOG_FILE] [-h] [--debug]</div><div class="line"></div><div class="line">Tempest cli application</div><div class="line"></div><div class="line">optional arguments:</div><div class="line">  --version            show program&apos;s version number and exit</div><div class="line">  -v, --verbose        Increase verbosity of output. Can be repeated.</div><div class="line">  -q, --quiet          Suppress output except warnings and errors.</div><div class="line">  --log-file LOG_FILE  Specify a file to log output. Disabled by default.</div><div class="line">  -h, --help           Show help message and exit.</div><div class="line">  --debug              Show tracebacks on errors.</div><div class="line"></div><div class="line">Commands:</div><div class="line">  account-generator  Create accounts.yaml file for concurrent test runs.</div><div class="line">  cleanup        Cleanup after tempest run</div><div class="line">  complete       print bash completion command</div><div class="line">  help           print detailed help for another command</div><div class="line">  init           Setup a local working environment for running tempest</div><div class="line">  list-plugins   List all tempest plugins</div><div class="line">  run            Run tempest</div><div class="line">  verify-config  Verify your current tempest configuration</div><div class="line">  workspace list  Outputs the name and path of all known tempest workspaces</div><div class="line">  workspace move  Changes the path of a given tempest workspace --name to --path</div><div class="line">  workspace register  Registers a new tempest workspace via a given --name and --path</div><div class="line">  workspace remove  Deletes the entry for a given tempest workspace --name</div><div class="line">  workspace rename  Renames a tempest workspace from --old-name to --new-name</div></pre></td></tr></table></figure>
<p>常用的命令有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 为tempest初始化working environment</div><div class="line">tempest init</div><div class="line"></div><div class="line"># 验证配置是否正确</div><div class="line">tempest verify-config</div><div class="line"></div><div class="line"># 执行tempest测试</div><div class="line">tempest run</div></pre></td></tr></table></figure>
<h5 id="配置tempest-conf"><a href="#配置tempest-conf" class="headerlink" title="配置tempest.conf"></a>配置tempest.conf</h5><p>下面是kolla tempest.conf的模版</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">[DEFAULT]</div><div class="line">debug = &#123;&#123; openstack_logging_debug &#125;&#125;</div><div class="line">log_file = tempest.log</div><div class="line">use_stderr = False</div><div class="line">log_dir = /var/log/kolla/tempest/</div><div class="line"></div><div class="line">[auth]</div><div class="line">admin_username = &#123;&#123; openstack_auth.username &#125;&#125;</div><div class="line">admin_password = &#123;&#123; keystone_admin_password &#125;&#125;</div><div class="line">admin_project_name = &#123;&#123; openstack_auth.project_name &#125;&#125;</div><div class="line">admin_domain_name = &#123;&#123; openstack_auth.domain_name &#125;&#125;</div><div class="line"></div><div class="line"></div><div class="line">[dashboard]</div><div class="line">dashboard_url = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;</div><div class="line">login_url = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;/auth/login/</div><div class="line"></div><div class="line">[service_available]</div><div class="line">cinder = &#123;&#123; enable_cinder &#125;&#125;</div><div class="line">neutron = &#123;&#123; enable_neutron &#125;&#125;</div><div class="line">glance = &#123;&#123; enable_glance &#125;&#125;</div><div class="line">swift = &#123;&#123; enable_swift &#125;&#125;</div><div class="line">nova = &#123;&#123; enable_nova &#125;&#125;</div><div class="line">heat = &#123;&#123; enable_heat &#125;&#125;</div><div class="line">horizon = &#123;&#123; enable_horizon &#125;&#125;</div><div class="line">ceilometer = &#123;&#123; enable_ceilometer &#125;&#125;</div><div class="line"></div><div class="line">[compute]</div><div class="line">max_microversion = latest</div><div class="line">image_ref = &#123;&#123; tempest_image_id &#125;&#125;</div><div class="line">image_ref_alt = &#123;&#123; tempest_image_alt_id &#125;&#125;</div><div class="line">flavor_ref = &#123;&#123; tempest_flavor_ref_id &#125;&#125;</div><div class="line">flavor_ref_alt = &#123;&#123; tempest_flavor_ref_alt_id &#125;&#125;</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line"></div><div class="line">[dashboard]</div><div class="line">dashboard_url = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;/</div><div class="line">login_url = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;/auth/login</div><div class="line"></div><div class="line">[identity]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line">auth_version = v3</div><div class="line">uri = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;:&#123;&#123; keystone_admin_port &#125;&#125;/v2.0</div><div class="line">uri_v3 = &#123;&#123; internal_protocol &#125;&#125;://&#123;&#123; kolla_internal_fqdn &#125;&#125;:&#123;&#123; keystone_admin_port &#125;&#125;/v3</div><div class="line"></div><div class="line">[image]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line">http_image = &#123;&#123; image_url &#125;&#125;</div><div class="line"></div><div class="line">[network]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line">public_network_id =  &#123;&#123; tempest_public_network_id &#125;&#125;</div><div class="line">floating_network_name = &#123;&#123; tempest_floating_network_name &#125;&#125;</div><div class="line">project_networks_reachable = false</div><div class="line"></div><div class="line">[network-feature-enabled]</div><div class="line">ipv6 = false</div><div class="line"></div><div class="line">[object-storage]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line"></div><div class="line">[orchestration]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line"></div><div class="line">[volume]</div><div class="line">region = &#123;&#123; openstack_region_name &#125;&#125;</div><div class="line"></div><div class="line">[volume-feature-enabled]</div><div class="line">api_v1 = False</div><div class="line"></div><div class="line">[validation]</div><div class="line">image_ssh_user = &#123;&#123; tempest_image_ssh_user &#125;&#125;</div><div class="line">image_ssh_password = &#123;&#123; tempest_image_ssh_password &#125;&#125;</div></pre></td></tr></table></figure>
<h4 id="使用tempest测试api接口"><a href="#使用tempest测试api接口" class="headerlink" title="使用tempest测试api接口"></a>使用tempest测试api接口</h4><p><strong><em>明确需求</em></strong>：</p>
<ul>
<li>指定某些api进行测试；例如我只想测试 compute的相关api</li>
<li>执行所有的测试</li>
<li>单项api测试</li>
<li>去掉某些我不想测试的api</li>
</ul>
<h5 id="执行所有测试"><a href="#执行所有测试" class="headerlink" title="执行所有测试"></a>执行所有测试</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 验证你的配置是否正确</div><div class="line">tempest verify-config</div><div class="line"></div><div class="line"># 执行所有测试</div><div class="line">tempest run --subunit &gt; result.subunit </div><div class="line"></div><div class="line"># 生成测试报告result.html</div><div class="line">subunit2html result.subunit</div></pre></td></tr></table></figure>
<h5 id="黑名单–blacklist-file的使用"><a href="#黑名单–blacklist-file的使用" class="headerlink" title="黑名单–blacklist-file的使用"></a>黑名单–blacklist-file的使用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">--blacklist-file &lt;file name&gt;</div><div class="line">  Sample regex file:</div><div class="line"></div><div class="line">      (^tempest\.api) # Comments about this regex</div><div class="line">      tempest.scenario.test_server_basic_ops # Matches this test explicitly</div></pre></td></tr></table></figure>
<p>例如除了tempest.scenario不测，其他的都测</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# cat blacklist</div><div class="line">tempest.scenario.*</div><div class="line"></div><div class="line">tempest run --blacklist-file blacklist</div></pre></td></tr></table></figure>
<h5 id="白名单–whitelist-file的使用"><a href="#白名单–whitelist-file的使用" class="headerlink" title="白名单–whitelist-file的使用"></a>白名单–whitelist-file的使用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># 只测试tempest.api.compute </div><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# cat whitefile</div><div class="line">tempest.api.compute.*</div><div class="line"></div><div class="line">tempest run --whitelist-file whitefile</div><div class="line"></div><div class="line"># 测试一个api接口</div><div class="line"></div><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# cat one_whitefile</div><div class="line">tempest.api.compute.images.test_list_image_filters.ListImageFiltersTestJSON.test_list_images_filter_by_changes_since</div><div class="line"></div><div class="line">tempest run --whitelist-file one_whitefile</div></pre></td></tr></table></figure>
<h5 id="使用ipdb调试tempest-api"><a href="#使用ipdb调试tempest-api" class="headerlink" title="使用ipdb调试tempest api"></a>使用ipdb调试tempest api</h5><p>安装ipdb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install ipdb</div></pre></td></tr></table></figure>
<p>在程序需要中断的地方插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import ipdb; ipdb.set_trace()</div></pre></td></tr></table></figure>
<p>运行程序后, 会在执行到set_trace()的时候中断程序 并出现提示符</p>
<p>(ipdb) …</p>
<p>这时输入help即可看到ipdb下常用的命令啦</p>
<p>比较常用的是看看当前的变量 a 以及下一步 n</p>
<p>还有就是 dir() 方法 可以查看一个对象有那些方法可以调用</p>
<p>ipdb比pdb的强大在于 他包含啦 ipython 特性. 可以支持tab补全</p>
<p>下面ipdb调试tempest api接口的一个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">vim tempest/api/compute/images/test_list_image_filters.py</div><div class="line">    @decorators.idempotent_id(&apos;a3f5b513-aeb3-42a9-b18e-f091ef73254d&apos;)</div><div class="line">    def test_list_images_filter_by_status(self):</div><div class="line">        # The list of images should contain only images with the</div><div class="line">        # provided status</div><div class="line">        import ipdb; ipdb.set_trace()</div><div class="line">        params = &#123;&apos;status&apos;: &apos;ACTIVE&apos;&#125;</div><div class="line">        images = self.client.list_images(**params)[&apos;images&apos;]</div><div class="line"></div><div class="line">        self.assertNotEmpty([i for i in images if i[&apos;id&apos;] == self.image1_id])</div><div class="line">        self.assertNotEmpty([i for i in images if i[&apos;id&apos;] == self.image2_id])</div><div class="line">        self.assertNotEmpty([i for i in images if i[&apos;id&apos;] == self.image3_id])</div><div class="line"></div><div class="line">## 进行调试</div><div class="line">(tempest)[root@control01 tempest-16.0.1.dev380]# python -m testtools.run tempest.api.compute.images.test_list_image_filters.ListImageFiltersTestJSON.test_list_images_filter_by_changes_since</div><div class="line">Tests running...</div><div class="line">/var/lib/kolla/venv/lib/python2.7/site-packages/IPython/core/debugger.py:243: DeprecationWarning: The `color_scheme` argument is deprecated since version 5.1</div><div class="line">  DeprecationWarning)</div><div class="line">&gt; /tempest-source/tempest-16.0.1.dev380/tempest/api/compute/images/test_list_image_filters.py(100)resource_setup()</div><div class="line">     99         # Create instances and snapshots via nova</div><div class="line">--&gt; 100         cls.server1 = cls.create_test_server()</div><div class="line">    101</div><div class="line"></div><div class="line">ipdb&gt;</div></pre></td></tr></table></figure>
<h5 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h5><p>下面是一个简单的测试脚本，测试基本都是通过的，在控制节点执行这个脚本就ok；</p>
<p>报告生成在 ／tmp/tempest目录下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">[root@control01 kolla-test]# cat run_tempest.sh</div><div class="line">#!bin/bash</div><div class="line"></div><div class="line">TEMPEST_PATH=&quot;/tmp/tempest&quot;</div><div class="line">TEMPEST_FILE=&quot;/tmp/tempest/results.html&quot;</div><div class="line"></div><div class="line">if [ ! -d &quot;$TEMPEST_PATH&quot; ]; then</div><div class="line">  mkdir &quot;$TEMPEST_PATH&quot;</div><div class="line">fi</div><div class="line"></div><div class="line">if [ -f &quot;$TEMPEST_FILE&quot; ]; then</div><div class="line">  rm -f  &quot;$TEMPEST_FILE&quot;</div><div class="line">fi</div><div class="line"></div><div class="line">cat &lt;&lt; EOF &gt; &quot;blacklist&quot;</div><div class="line">tempest.api.compute.images.test_list_image_filters.ListImageFiltersTestJSON</div><div class="line">tempest.api.network.admin.test_metering_extensions.MeteringTestJSON</div><div class="line">tempest.api.network.test_extensions.ExtensionsTestJSON</div><div class="line">tempest.api.volume.test_volume_delete_cascade.VolumesDeleteCascade</div><div class="line">tempest.api.compute.admin.test_auto_allocate_network.AutoAllocateNetworkTest</div><div class="line">tempest.api.compute.servers.test_list_server_filters.ListServerFiltersTestJSON</div><div class="line">tempest.api.compute.admin.test_server_diagnostics.ServerDiagnosticsV248Test</div><div class="line">tempest.api.compute.images.test_images.ImagesTestJSON</div><div class="line">tempest.api.compute.servers.test_delete_server.DeleteServersTestJSON</div><div class="line">tempest.api.compute.volumes.test_attach_volume.AttachVolumeShelveTestJSON</div><div class="line">tempest.api.compute.images.test_images_oneserver.ImagesOneServerTestJSON</div><div class="line">tempest.api.compute.servers.test_server_actions.ServerActionsTestJSON</div><div class="line">tempest.api.compute.servers.test_servers_negative.ServersNegativeTestJSON</div><div class="line">tempest.api.volume.admin.test_volume_types.VolumeTypesTest</div><div class="line">tempest.api.volume.admin.test_volumes_backup.VolumesBackupsAdminTest</div><div class="line">tempest.api.volume.test_volume_delete_cascade.VolumesDeleteCascade</div><div class="line">tempest.api.volume.test_volumes_backup.VolumesBackupsTest</div><div class="line">tempest.api.volume.test_volumes_snapshots.VolumesSnapshotTestJSON</div><div class="line">tempest.scenario.test_minimum_basic.TestMinimumBasicScenario</div><div class="line">tempest.scenario.test_shelve_instance.TestShelveInstance</div><div class="line">tempest.scenario.test_snapshot_pattern.TestSnapshotPattern</div><div class="line">tempest.scenario.test_volume_boot_pattern.TestVolumeBootPattern</div><div class="line">tempest.scenario.test_security_groups_basic_ops.TestSecurityGroupsBasicOps</div><div class="line">tempest.scenario.test_encrypted_cinder_volumes.TestEncryptedCinderVolumes</div><div class="line">EOF</div><div class="line"></div><div class="line">docker cp blacklist tempest:/tempest/blacklist</div><div class="line">docker exec tempest bash -c &apos;tempest run --config-file /etc/tempest/tempest.conf --blacklist-file /tempest/blacklist --subunit &gt; /tmp/results.subunit&apos;</div><div class="line">docker exec tempest bash -c &apos;subunit2html /tmp/results.subunit /tmp/results.html&apos;</div><div class="line">docker cp tempest:/tmp/results.html  $TEMPEST_FIL</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhubingbing.net/2017/07/06/openstack/rally/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhubingbing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhubingbing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/06/openstack/rally/" itemprop="url">rally-first</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-06T12:30:00+08:00">
                2017-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Openstack/" itemprop="url" rel="index">
                    <span itemprop="name">Openstack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/07/06/openstack/rally/#SOHUCS" itemprop="discussionUrl">
                  <span id="url::http://zhubingbing.net/2017/07/06/openstack/rally/" class="cy_cmt_count" data-xid="2017/07/06/openstack/rally/" itemprop="commentsCount" ></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="openstack-测试介绍"><a href="#openstack-测试介绍" class="headerlink" title="openstack 测试介绍"></a>openstack 测试介绍</h3><h3 id="Rally-介绍"><a href="#Rally-介绍" class="headerlink" title="Rally 介绍"></a>Rally 介绍</h3><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>贴图：<br>文字介绍</p>
<h3 id="使用kolla部署rally"><a href="#使用kolla部署rally" class="headerlink" title="使用kolla部署rally"></a>使用kolla部署rally</h3><h3 id="rally的功能介绍"><a href="#rally的功能介绍" class="headerlink" title="rally的功能介绍"></a>rally的功能介绍</h3><h3 id="rally的基本使用"><a href="#rally的基本使用" class="headerlink" title="rally的基本使用"></a>rally的基本使用</h3><h3 id="rally调用tempest"><a href="#rally调用tempest" class="headerlink" title="rally调用tempest"></a>rally调用tempest</h3><h3 id="rally的局限性"><a href="#rally的局限性" class="headerlink" title="rally的局限性"></a>rally的局限性</h3><p>OpenStack，毫无疑问是各种服务联合的一个庞大的生态系统。</p>
<p>Rally 作为一个标准测试工具，回答了 “OpenStack 如何大规模运作？” 的问题。</p>
<p>为了使其成为可能，Rally 自动化并统一了多个节点的 OpenStack 部署、云的验证、标准测试和分析。Rally 使用一个通用的方法，使得我们能够检查 OpenStack 是否正常运作，也即，在高负荷下 1K 服务器的安装是否成功。因此，它可以作为 OpenStack CI/CD 系统的基本工具来使用，可以持续改进其 SLA、运作和稳定性。</p>
<p>Rally 的操作如下图所示：<br><a href="http://coffeechou.github.io/public/imgs/rally_actions.png" target="_blank" rel="external">http://coffeechou.github.io/public/imgs/rally_actions.png</a></p>
<h3 id="在kolla中使用rally"><a href="#在kolla中使用rally" class="headerlink" title="在kolla中使用rally"></a>在kolla中使用rally</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#在配置文件打开rally</div><div class="line">vim /etc/kolla/globals.yml</div><div class="line"></div><div class="line">enable_rally: &quot;yes&quot;</div><div class="line"></div><div class="line">#部署环境</div><div class="line">kolla-ansible deploy</div><div class="line"></div><div class="line">#生成openrc环境变量</div><div class="line">kolla-ansible post-deploy</div></pre></td></tr></table></figure>
<h3 id="初始化rally"><a href="#初始化rally" class="headerlink" title="初始化rally"></a>初始化rally</h3><h4 id="Registering-an-OpenStack-deployment-in-Rally"><a href="#Registering-an-OpenStack-deployment-in-Rally" class="headerlink" title="Registering an OpenStack deployment in Rally"></a>Registering an OpenStack deployment in Rally</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line"># 进入rally 容器</div><div class="line">[root@control01 ~]# docker exec -it -u root rally bash</div><div class="line">(rally)[root@control01 /]#</div><div class="line"></div><div class="line">(rally)[root@control01 deployments]# vim existing-keystone-v3.json</div><div class="line">&#123;</div><div class="line">    &quot;type&quot;: &quot;ExistingCloud&quot;,</div><div class="line">    &quot;auth_url&quot;: &quot;http://172.16.130.210:5000/v3&quot;,</div><div class="line">    &quot;region_name&quot;: &quot;RegionOne&quot;,</div><div class="line">    &quot;endpoint_type&quot;: &quot;public&quot;,</div><div class="line">    &quot;admin&quot;: &#123;</div><div class="line">        &quot;username&quot;: &quot;admin&quot;,</div><div class="line">        &quot;password&quot;: &quot;99cloud&quot;,</div><div class="line">        &quot;user_domain_name&quot;: &quot;deault&quot;,</div><div class="line">        &quot;project_name&quot;: &quot;admin&quot;,</div><div class="line">        &quot;project_domain_name&quot;: &quot;deault&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;https_insecure&quot;: false,</div><div class="line">    &quot;https_cacert&quot;: &quot;&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#123;% qnimg test/test.png title:test alt:test %&#125;</div><div class="line"></div><div class="line">### 创建deployments</div><div class="line">(rally)[root@control01 deployments]#rally deployment create --file existing-keystone-v3.json --name 99cloud-regionOne</div><div class="line">+--------------------------------------+---------------------+-------------------+------------------+--------+</div><div class="line">| uuid                                 | created_at          | name              | status           | active |</div><div class="line">+--------------------------------------+---------------------+-------------------+------------------+--------+</div><div class="line">| e36d802c-2211-4bac-a8ea-2f3b967568b9 | 2017-05-08 03:07:46 | 99cloud-regionOne | deploy-&gt;finished |        |</div><div class="line">+--------------------------------------+---------------------+-------------------+------------------+--------+</div><div class="line">Using deployment: e36d802c-2211-4bac-a8ea-2f3b967568b9</div><div class="line">~/.rally/openrc was updated</div><div class="line"></div><div class="line">HINTS:</div><div class="line"></div><div class="line">* To use standard OpenStack clients, set up your env by running:</div><div class="line">	source ~/.rally/openrc</div><div class="line">  OpenStack clients are now configured, e.g run:</div><div class="line">	openstack image list</div><div class="line">(rally)[root@control01 deployments]# rally deployment list</div><div class="line">+--------------------------------------+---------------------+-------------------+-------------------+--------+</div><div class="line">| uuid                                 | created_at          | name              | status            | active |</div><div class="line">+--------------------------------------+---------------------+-------------------+-------------------+--------+</div><div class="line">| af993ae9-363e-4701-b343-626063eaf715 | 2017-04-26 07:13:50 | existing          | cleanup-&gt;finished |        |</div><div class="line">| e36d802c-2211-4bac-a8ea-2f3b967568b9 | 2017-05-08 03:07:46 | 99cloud-regionOne | deploy-&gt;finished  | *      |</div><div class="line">+--------------------------------------+---------------------+-------------------+-------------------+--</div><div class="line">### 还有一种创建方法，就是使用环境变量去创建</div><div class="line">### 我们先删除之前创建的</div><div class="line">(rally)[root@control01 deployments]# rally deployment destroy 99cloud-regionOne</div><div class="line">(rally)[root@control01 deployments]# rally deployment list</div><div class="line">+--------------------------------------+---------------------+----------+-------------------+--------+</div><div class="line">| uuid                                 | created_at          | name     | status            | active |</div><div class="line">+--------------------------------------+---------------------+----------+-------------------+--------+</div><div class="line">| af993ae9-363e-4701-b343-626063eaf715 | 2017-04-26 07:13:50 | existing | cleanup-&gt;finished |        |</div><div class="line">+--------------------------------------+---------------------+----------+-------------------+--------+</div><div class="line">### (rally)[root@control01 /]# cat openrc</div><div class="line">export OS_REGION_NAME=RegionOne</div><div class="line">export OS_PROJECT_DOMAIN_NAME=default</div><div class="line">export OS_USER_DOMAIN_NAME=default</div><div class="line">export OS_PROJECT_NAME=admin</div><div class="line">export OS_TENANT_NAME=admin</div><div class="line">export OS_USERNAME=admin</div><div class="line">export OS_PASSWORD=99cloud</div><div class="line">export OS_AUTH_URL=http://172.16.130.210:35357/v3</div><div class="line">export OS_INTERFACE=internal</div><div class="line">export OS_IDENTITY_API_VERSION=3</div><div class="line"></div><div class="line">(rally)[root@control01 /]# source openrc</div><div class="line">## 测试下环境变量是否可用</div><div class="line">(rally)[root@control01 deployments]# openstack image list</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">| ID                                   | Name                              | Status |</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">| 83dc79c8-c6df-4e23-808c-0209778be1b2 | 123                               | active |</div><div class="line">| 9d4cc662-bdfb-46cb-996d-3b773ee161d5 | a1                                | active |</div><div class="line">| 255cc63c-f635-4bbb-850c-e319d2e4c17d | cenos-raw                         | active |</div><div class="line">| 63c5d475-e96a-4c1f-985b-12685aa2a95b | centos6.5                         | active |</div><div class="line">| 15ed4618-4b3b-4cc3-a9ef-6967e3a3091d | centos7                           | active |</div><div class="line">| 15f04241-38cc-482d-b6a3-42ba9d29f47a | cirros                            | active |</div><div class="line">| 6491747b-2fea-4d7c-b034-b3fe5089df2c | d1                                | active |</div><div class="line">| 4f99d882-04af-47bc-9e2d-a12aaecbf753 | s_rally_e4dbf0c1_LdpjrVlZ-shelved | active |</div><div class="line">| 6a45e590-08fc-471f-b4d8-9a6195e88d07 | s_rally_e4dbf0c1_f3TP5nP4-shelved | active |</div><div class="line">| a166585b-fb88-4c0a-a0c9-47443e9ca8be | s_rally_e4dbf0c1_lEthjCi9-shelved | active |</div><div class="line">| fa680415-4448-4564-9b22-bdf2b86b6cd2 | s_rally_e4dbf0c1_nuqTKzuQ-shelved | active |</div><div class="line">| 6eec3597-ee52-436c-9970-ec11415cbb4e | sdf1                              | active |</div><div class="line">| 1e84937a-a700-447b-8ffc-3f162127300d | snap1                             | active |</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">(rally)[root@control01 deployments]# rally deployment create --fromenv --name regiOne-99cloud</div><div class="line">+--------------------------------------+---------------------+-----------------+------------------+--------+</div><div class="line">| uuid                                 | created_at          | name            | status           | active |</div><div class="line">+--------------------------------------+---------------------+-----------------+------------------+--------+</div><div class="line">| 6682d272-5d99-400b-9de9-c4d46a705ba6 | 2017-05-08 03:21:46 | regiOne-99cloud | deploy-&gt;finished |        |</div><div class="line">+--------------------------------------+---------------------+-----------------+------------------+--------+</div><div class="line">Using deployment: 6682d272-5d99-400b-9de9-c4d46a705ba6</div><div class="line">~/.rally/openrc was updated</div><div class="line"></div><div class="line">HINTS:</div><div class="line"></div><div class="line">* To use standard OpenStack clients, set up your env by running:</div><div class="line">	source ~/.rally/openrc</div><div class="line">  OpenStack clients are now configured, e.g run:</div><div class="line">	openstack image list</div><div class="line">(rally)[root@control01 deployments]# source ~/.rally/openrc</div><div class="line">### 测试deployments是否可用</div><div class="line">(rally)[root@control01 deployments]# openstack image list</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">| ID                                   | Name                              | Status |</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">| 83dc79c8-c6df-4e23-808c-0209778be1b2 | 123                               | active |</div><div class="line">| 9d4cc662-bdfb-46cb-996d-3b773ee161d5 | a1                                | active |</div><div class="line">| 255cc63c-f635-4bbb-850c-e319d2e4c17d | cenos-raw                         | active |</div><div class="line">| 63c5d475-e96a-4c1f-985b-12685aa2a95b | centos6.5                         | active |</div><div class="line">| 15ed4618-4b3b-4cc3-a9ef-6967e3a3091d | centos7                           | active |</div><div class="line">| 15f04241-38cc-482d-b6a3-42ba9d29f47a | cirros                            | active |</div><div class="line">| 6491747b-2fea-4d7c-b034-b3fe5089df2c | d1                                | active |</div><div class="line">| 4f99d882-04af-47bc-9e2d-a12aaecbf753 | s_rally_e4dbf0c1_LdpjrVlZ-shelved | active |</div><div class="line">| 6a45e590-08fc-471f-b4d8-9a6195e88d07 | s_rally_e4dbf0c1_f3TP5nP4-shelved | active |</div><div class="line">| a166585b-fb88-4c0a-a0c9-47443e9ca8be | s_rally_e4dbf0c1_lEthjCi9-shelved | active |</div><div class="line">| fa680415-4448-4564-9b22-bdf2b86b6cd2 | s_rally_e4dbf0c1_nuqTKzuQ-shelved | active |</div><div class="line">| 6eec3597-ee52-436c-9970-ec11415cbb4e | sdf1                              | active |</div><div class="line">| 1e84937a-a700-447b-8ffc-3f162127300d | snap1                             | active |</div><div class="line">+--------------------------------------+-----------------------------------+--------+</div><div class="line">(rally)[root@control01 deployments]# rally deployment list</div><div class="line">+--------------------------------------+---------------------+-----------------+-------------------+--------+</div><div class="line">| uuid                                 | created_at          | name            | status            | active |</div><div class="line">+--------------------------------------+---------------------+-----------------+-------------------+--------+</div><div class="line">| af993ae9-363e-4701-b343-626063eaf715 | 2017-04-26 07:13:50 | existing        | cleanup-&gt;finished |        |</div><div class="line">| 6682d272-5d99-400b-9de9-c4d46a705ba6 | 2017-05-08 03:21:46 | regiOne-99cloud | deploy-&gt;finished  | *      |</div><div class="line">+--------------------------------------+---------------------+-----------------+-------------------+--------+</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="zhubingbing" />
          <p class="site-author-name" itemprop="name">zhubingbing</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhubingbing" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/zhubingbing" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/zhubingbing" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/zhubingbing" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  豆瓣
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/zhubingbing" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhubingbing</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  




  
    <script id="cy_cmt_num" src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cyt7hBR7h"></script>
  



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
